{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Hi there \ud83d\udc4b \u4ea4\u6d41\u4f20\u9001\u94fe","title":"\u9996\u9875"},{"location":"index.html#hi-there","text":"\u4ea4\u6d41\u4f20\u9001\u94fe","title":"Hi there \ud83d\udc4b"},{"location":"review.html","text":"\u65e5\u671f \u540d\u79f0 \u5907\u6ce8 20220420 tensordot C ++ \u770b\u4e0d\u592a\u61c2\u2026\u2026\u8981\u52a0\u5f3a 20220420 Tensor.type 20220421 tensor pin memory 20220424 nn.utils.spectral_norm 20220505 Add nn_functor Check 20220506 Aligned tensor.add method 20220518 Add exception check for nn grad functor 20220520 Add SliceBoxingFunctor exception 20220520 Add Tensor Index exception 20220520 Add function_library.h Exception 20220520 Dev linalg inv 20220531 Add repeat interleave op 20220620 add oneflow.mm op 20220628 ErrorMsgRefine 20220628 Modify add_n_op.cpp and add test_add_n_op.py 20220629 add tensor dot api and delete useless api in tensor.py 20220629 Modify /user/ops/arg_sort_op.cpp , supplement the error information 20220629 Refine error msg: core/autograd/gradient_funcs 20220629 arange api support input scalar type 20220630 Modify bias_add_op.cpp,delete unnecessary checks and improve the error message 20220630 Modify batch_gather_op.cpp and improve the error message 20220701 refine error msg: add NOLINT for defensive code in autograd 20220701 refine error msg for some autograd code 20220704 Modify some file and add test 20220704 fix diag 0size tensr shape infer bug 20220705 modify some file and improve the error message 20220706 Fix set_acc_grad and backward wrong value 20220706 Fill GetSbp bug and consistent test bug 20220706 add module releated container docs 20220707 modify some file and improve error message 20220707 refine error msg for some user ops 20220708 Add full_like api 20220708 Add randint like 20220712 Fix zeros like and ones_like api 20220719 fix gelu nn.Module bug and support tanh mode. 20220719 Fix bug of Tensor.type 20220722 impl of reflection_pad1d and replication_pad1d 20220725 Add RMSLayerNorm Module 20220726 fix randn default device","title":"Review"},{"location":"works.html","text":"\u65e5\u671f \u540d\u79f0 \u5907\u6ce8 20220308 functor 20220322 AI Writer Model AI Writer Web 20220401 torch2flow 20220407 - Vision\u6a21\u578b\u517c\u5bb9\u6027\u6d4b\u8bd5 \uff0cPyTorch \u65e0 regionvit 20220407 add tensor half 20220408 Add functional conv transpose 20220412 Add nn init orthogonal 20220418 Add flow amin 20220419 Add tensor byte 20220420 Modify reference info 20220422 Modify reduce ops 20220428 Add array functor exception 20220506 Fix upsample shape infer bug continue 20220516 Fix instanceNorm 20220523 Fix fill_ Fill GetSbp bug and consistent test bug 20220620 Add mv op TODO 20220628 Fix randn 20220630 Add flow norm 20220704 Fix doc and ops template auto gen TODO(docs == init ?) 20220706 Add addcdiv 20220708 Add logspace 20220711 Add hann_window 20220712 Fix norm TODO(linalg.norm) 20220714 Fix nn doc 20220715 Add nn functional fold 20220728 Fix doc of examples 20220531 begin 20220719 Fix tensor type doc 20220719 rm doc of tensor.gelu 20220720 Add functional binary cross entropy 20220722 Dev support replication pad1d 20220725 Fix masked_fill graph grad 20220727 Dev wkv","title":"PR"},{"location":"engineering/20220406-22%20core%20dumped.html","text":"22 core dumped \u5728 22 \u673a\u5668\u4e0a\u5f00\u53d1\u9047\u5230 core dumped \u95ee\u9898\u3002\u66f4\u65b0\u89c1 22 core dumped \u00b7 Issue #1282 \u3002 \u73af\u5883 \u5b89\u88c5 Anaconda \uff08Anaconda3-2021.11-Linux-x86_64.sh\uff09\u540e\uff0c\u5728 base \u73af\u5883\u4e0b\uff08Python 3.9.7\uff0ctorch 1.11.0+cu102\uff09\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\u5b8c\u6210\u9879\u76ee\u7f16\u8bd1 git clone git@github.com:Oneflow-Inc/oneflow.git cd oneflow mkdir build cd build cmake -DCUDNN_ROOT_DIR=/usr/local/cudnn -DCMAKE_BUILD_TYPE=Release -DTHIRD_PARTY_MIRROR=aliyun -DUSE_CLANG_FORMAT=ON -C ../cmake/caches/cn/fast/cuda-75.cmake .. && ninja \u9519\u8bef \u5728 22 \u4e0a\u76f4\u63a5\u8fd0\u884c oneflow/python/oneflow/test/expensive \u4e0b\u7684 test_compatibility.py \uff0c\u62a5\u5982\u4e0b\u9519 Aborted (core dumped) \u901a\u8fc7\u8c03\u4f4e batch_size \u4e0e image_size \u4e4b\u540e\u4ecd\u7136\u62a5\u76f8\u540c\u7684\u9519\u8bef\u3002 \u524a\u51cf test_compatibility.py \u4e2d\u7684 TestApiCompatibility \uff0c\u53ea\u4fdd\u7559\u5982\u4e0b\u4ee3\u7801\uff0c\u4ecd\u7136\u62a5\u76f8\u540c\u7684\u9519\u8bef\uff0c0 \u5e76\u6ca1\u6709 print \u51fa\uff0c\u8bf4\u660e test_alexnet_compatibility() \u51fd\u6570\u524d\u4e5f\u5373\u6d4b\u8bd5\u7c7b\u521d\u59cb\u5316\u5373\u51fa\u73b0\u4e86\u9519\u8bef\u3002 @flow.unittest.skip_unless_1n1d() @unittest.skipIf(os.getenv(\"ONEFLOW_TEST_CPU_ONLY\"), \"only test gpu cases\") class TestApiCompatibility(flow.unittest.TestCase): def test_alexnet_compatibility(test_case): print(0) do_test_train_loss_oneflow_pytorch( test_case, \"pytorch_alexnet.py\", \"alexnet\", \"cuda\", 1, 8 ) \u901a\u8fc7 gdb \u6307\u4ee4\u8fd0\u884c\u6587\u4ef6 gdb --args python ./oneflow/python/oneflow/test/expensive/test_compatibility.py run \u5f97\u5230\u5982\u4e0b\u4fe1\u606f --Type <RET> for more, q to quit, c to continue without paging-- Thread 1 \"python\" received signal SIGABRT, Aborted. __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50 50 ../sysdeps/unix/sysv/linux/raise.c: No such file or directory. (gdb) up #1 0x00007ffff7c5d859 in __GI_abort () at abort.c:79 79 abort.c: No such file or directory. (gdb) up #2 0x00007fffde17f6c1 in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #3 0x00007fffde18cbef in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #4 0x00007fffde18d5aa in _Unwind_Resume () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #5 0x00007ffec14a3424 in throw_ft_error(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int) () from /home/zhongshanshan/anaconda3/lib/python3.9/site-packages/matplotlib/ft2font.cpython-39-x86_64-linux-gnu.so (gdb) up #6 0x00007ffec14a5c1a in PyFT2Font_init(PyFT2Font*, _object*, _object*) () from /home/zhongshanshan/anaconda3/lib/python3.9/site-packages/matplotlib/ft2font.cpython-39-x86_64-linux-gnu.so (gdb) up #7 0x00005555556989bb in type_call (kwds=0x0, args=0x7ffec1010dc0, type=<optimized out>) at /tmp/build/80754af9/python-split_1631797238431/work/Objects/typeobject.c:1026 1026 /tmp/build/80754af9/python-split_1631797238431/work/Objects/typeobject.c: No such file or directory. (gdb) \u8003\u8651\u5230 OneFlow \u4e0e PyTorch \u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff1a concat \u7684\u6d4b\u8bd5\u4ee3\u7801 ./oneflow/python/oneflow/test/modules/test_concat.py \u4ee3\u7801\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd0\u884c pytorch_alexnet.py \u4e2d\u8c03\u7528\u7684 conv2d \u7684\u6d4b\u8bd5\u4ee3\u7801 ./oneflow/python/oneflow/test/modules/test_conv2d.py \uff0c\u62a5\u9519\u3002 \u81ea\u5b9a\u4e49\u590d\u73b0\u811a\u672c\uff0c\u67e5\u770b\u662f\u5426\u662f OneFlow \u4e0e PyTorch \u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u81ea\u5b9a\u4e49\u811a\u672c\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u81ea\u5b9a\u4e49\u811a\u672c\u5982\u4e0b import oneflow as torch import oneflow.nn as nn # With square kernels and equal stride m = nn.Conv2d(16, 33, 3, stride=2) # non-square kernels and unequal stride and with padding m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2)) # non-square kernels and unequal stride and with padding and dilation m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1)) m.to(\"cuda\") input = torch.randn(20, 16, 50, 100).to(\"cuda\") output = m(input) import torch import torch.nn as nn # With square kernels and equal stride m = nn.Conv2d(16, 33, 3, stride=2) # non-square kernels and unequal stride and with padding m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2)) # non-square kernels and unequal stride and with padding and dilation m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1)) m.to(\"cuda\") input = torch.randn(20, 16, 50, 100).to(\"cuda\") output = m(input) \u5f53\u524d\u89e3\u51b3\u65b9\u6848 \u6362\u53f0\u673a\u5b50\u3002","title":"22 core dumped"},{"location":"engineering/20220406-22%20core%20dumped.html#22-core-dumped","text":"\u5728 22 \u673a\u5668\u4e0a\u5f00\u53d1\u9047\u5230 core dumped \u95ee\u9898\u3002\u66f4\u65b0\u89c1 22 core dumped \u00b7 Issue #1282 \u3002","title":"22 core dumped"},{"location":"engineering/20220406-22%20core%20dumped.html#_1","text":"\u5b89\u88c5 Anaconda \uff08Anaconda3-2021.11-Linux-x86_64.sh\uff09\u540e\uff0c\u5728 base \u73af\u5883\u4e0b\uff08Python 3.9.7\uff0ctorch 1.11.0+cu102\uff09\u901a\u8fc7\u5982\u4e0b\u6307\u4ee4\u5b8c\u6210\u9879\u76ee\u7f16\u8bd1 git clone git@github.com:Oneflow-Inc/oneflow.git cd oneflow mkdir build cd build cmake -DCUDNN_ROOT_DIR=/usr/local/cudnn -DCMAKE_BUILD_TYPE=Release -DTHIRD_PARTY_MIRROR=aliyun -DUSE_CLANG_FORMAT=ON -C ../cmake/caches/cn/fast/cuda-75.cmake .. && ninja","title":"\u73af\u5883"},{"location":"engineering/20220406-22%20core%20dumped.html#_2","text":"\u5728 22 \u4e0a\u76f4\u63a5\u8fd0\u884c oneflow/python/oneflow/test/expensive \u4e0b\u7684 test_compatibility.py \uff0c\u62a5\u5982\u4e0b\u9519 Aborted (core dumped) \u901a\u8fc7\u8c03\u4f4e batch_size \u4e0e image_size \u4e4b\u540e\u4ecd\u7136\u62a5\u76f8\u540c\u7684\u9519\u8bef\u3002 \u524a\u51cf test_compatibility.py \u4e2d\u7684 TestApiCompatibility \uff0c\u53ea\u4fdd\u7559\u5982\u4e0b\u4ee3\u7801\uff0c\u4ecd\u7136\u62a5\u76f8\u540c\u7684\u9519\u8bef\uff0c0 \u5e76\u6ca1\u6709 print \u51fa\uff0c\u8bf4\u660e test_alexnet_compatibility() \u51fd\u6570\u524d\u4e5f\u5373\u6d4b\u8bd5\u7c7b\u521d\u59cb\u5316\u5373\u51fa\u73b0\u4e86\u9519\u8bef\u3002 @flow.unittest.skip_unless_1n1d() @unittest.skipIf(os.getenv(\"ONEFLOW_TEST_CPU_ONLY\"), \"only test gpu cases\") class TestApiCompatibility(flow.unittest.TestCase): def test_alexnet_compatibility(test_case): print(0) do_test_train_loss_oneflow_pytorch( test_case, \"pytorch_alexnet.py\", \"alexnet\", \"cuda\", 1, 8 ) \u901a\u8fc7 gdb \u6307\u4ee4\u8fd0\u884c\u6587\u4ef6 gdb --args python ./oneflow/python/oneflow/test/expensive/test_compatibility.py run \u5f97\u5230\u5982\u4e0b\u4fe1\u606f --Type <RET> for more, q to quit, c to continue without paging-- Thread 1 \"python\" received signal SIGABRT, Aborted. __GI_raise (sig=sig@entry=6) at ../sysdeps/unix/sysv/linux/raise.c:50 50 ../sysdeps/unix/sysv/linux/raise.c: No such file or directory. (gdb) up #1 0x00007ffff7c5d859 in __GI_abort () at abort.c:79 79 abort.c: No such file or directory. (gdb) up #2 0x00007fffde17f6c1 in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #3 0x00007fffde18cbef in ?? () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #4 0x00007fffde18d5aa in _Unwind_Resume () from /lib/x86_64-linux-gnu/libgcc_s.so.1 (gdb) up #5 0x00007ffec14a3424 in throw_ft_error(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, int) () from /home/zhongshanshan/anaconda3/lib/python3.9/site-packages/matplotlib/ft2font.cpython-39-x86_64-linux-gnu.so (gdb) up #6 0x00007ffec14a5c1a in PyFT2Font_init(PyFT2Font*, _object*, _object*) () from /home/zhongshanshan/anaconda3/lib/python3.9/site-packages/matplotlib/ft2font.cpython-39-x86_64-linux-gnu.so (gdb) up #7 0x00005555556989bb in type_call (kwds=0x0, args=0x7ffec1010dc0, type=<optimized out>) at /tmp/build/80754af9/python-split_1631797238431/work/Objects/typeobject.c:1026 1026 /tmp/build/80754af9/python-split_1631797238431/work/Objects/typeobject.c: No such file or directory. (gdb) \u8003\u8651\u5230 OneFlow \u4e0e PyTorch \u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff1a concat \u7684\u6d4b\u8bd5\u4ee3\u7801 ./oneflow/python/oneflow/test/modules/test_concat.py \u4ee3\u7801\u6b63\u5e38\u8fd0\u884c\u3002 \u8fd0\u884c pytorch_alexnet.py \u4e2d\u8c03\u7528\u7684 conv2d \u7684\u6d4b\u8bd5\u4ee3\u7801 ./oneflow/python/oneflow/test/modules/test_conv2d.py \uff0c\u62a5\u9519\u3002 \u81ea\u5b9a\u4e49\u590d\u73b0\u811a\u672c\uff0c\u67e5\u770b\u662f\u5426\u662f OneFlow \u4e0e PyTorch \u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u81ea\u5b9a\u4e49\u811a\u672c\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002\u81ea\u5b9a\u4e49\u811a\u672c\u5982\u4e0b import oneflow as torch import oneflow.nn as nn # With square kernels and equal stride m = nn.Conv2d(16, 33, 3, stride=2) # non-square kernels and unequal stride and with padding m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2)) # non-square kernels and unequal stride and with padding and dilation m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1)) m.to(\"cuda\") input = torch.randn(20, 16, 50, 100).to(\"cuda\") output = m(input) import torch import torch.nn as nn # With square kernels and equal stride m = nn.Conv2d(16, 33, 3, stride=2) # non-square kernels and unequal stride and with padding m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2)) # non-square kernels and unequal stride and with padding and dilation m = nn.Conv2d(16, 33, (3, 5), stride=(2, 1), padding=(4, 2), dilation=(3, 1)) m.to(\"cuda\") input = torch.randn(20, 16, 50, 100).to(\"cuda\") output = m(input)","title":"\u9519\u8bef"},{"location":"engineering/20220406-22%20core%20dumped.html#_3","text":"\u6362\u53f0\u673a\u5b50\u3002","title":"\u5f53\u524d\u89e3\u51b3\u65b9\u6848"},{"location":"engineering/20220407-%E6%B7%BB%E5%8A%A0half.html","text":"\u6dfb\u52a0 Tensor.half \u6d41\u7a0b \u4fee\u6539 ./python/oneflow/framework/tensor.py\uff0c\u6dfb\u52a0 def _half(self): return flow._C.to(self, flow.float16) \u540c\u65f6\u5728\u672c\u6587\u4ef6 def RegisterMethods(): \u6dfb\u52a0 Tensor.half = _half \u4fee\u6539 ./python/oneflow/framework/docstr/tensor.py\uff0c\u6dfb\u52a0 add_docstr( oneflow.Tensor.half, \"\"\" self.half() is equivalent to self.to(torch.float16). See :func:`oneflow.Tensor.to` \"\"\", ) \u4fee\u6539 ./docs/source/tensor.rst\uff0c\u5728member \u4e0b\u6dfb\u52a0 half\u3002 ModuleNotFoundError \u8fdb\u5165 ./docs\uff0c\u6267\u884c\u6307\u4ee4 make html\uff0c\u62a5\u5982\u4e0b\u9519\u8bef Running Sphinx v4.1.2 Configuration error: There is a programmable error in your configuration file: Traceback (most recent call last): File \"/usr/local/lib/python3.8/dist-packages/sphinx/config.py\", line 327, in eval_config_file exec(code, namespace) File \"/home/zhongshanshan/workspace/f/docs/source/conf.py\", line 17, in <module> import oneflow File \"/home/zhongshanshan/workspace/f/python/oneflow/__init__.py\", line 21, in <module> import oneflow._oneflow_internal ModuleNotFoundError: No module named 'oneflow._oneflow_internal' make: *** [Makefile:20: html] Error 2 \u8fdb\u5165 python \u547d\u4ee4\u884c\uff0c\u6267\u884c import oneflow\uff0c\u4e00\u5207\u6b63\u5e38\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u5230\uff0c\u8c03\u7528\u4e86\u7cfb\u7edf\u7684sphinx\uff0c\u8fd9\u662f\u56e0\u4e3a \u6ca1\u88c5\u5305\u5bfc\u81f4\u5230\u7cfb\u7edf\u73af\u5883\u4e2d\u627e sphinx\uff0c\u8fdb\u800c\u5bfc\u81f4\u5bfb\u627e\u4e0d\u5230 oneflow\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a make html \u524d install docs \u4e0b\u7684 requirements\u3002","title":"\u6dfb\u52a0 half"},{"location":"engineering/20220407-%E6%B7%BB%E5%8A%A0half.html#tensorhalf","text":"","title":"\u6dfb\u52a0 Tensor.half"},{"location":"engineering/20220407-%E6%B7%BB%E5%8A%A0half.html#_1","text":"\u4fee\u6539 ./python/oneflow/framework/tensor.py\uff0c\u6dfb\u52a0 def _half(self): return flow._C.to(self, flow.float16) \u540c\u65f6\u5728\u672c\u6587\u4ef6 def RegisterMethods(): \u6dfb\u52a0 Tensor.half = _half \u4fee\u6539 ./python/oneflow/framework/docstr/tensor.py\uff0c\u6dfb\u52a0 add_docstr( oneflow.Tensor.half, \"\"\" self.half() is equivalent to self.to(torch.float16). See :func:`oneflow.Tensor.to` \"\"\", ) \u4fee\u6539 ./docs/source/tensor.rst\uff0c\u5728member \u4e0b\u6dfb\u52a0 half\u3002","title":"\u6d41\u7a0b"},{"location":"engineering/20220407-%E6%B7%BB%E5%8A%A0half.html#modulenotfounderror","text":"\u8fdb\u5165 ./docs\uff0c\u6267\u884c\u6307\u4ee4 make html\uff0c\u62a5\u5982\u4e0b\u9519\u8bef Running Sphinx v4.1.2 Configuration error: There is a programmable error in your configuration file: Traceback (most recent call last): File \"/usr/local/lib/python3.8/dist-packages/sphinx/config.py\", line 327, in eval_config_file exec(code, namespace) File \"/home/zhongshanshan/workspace/f/docs/source/conf.py\", line 17, in <module> import oneflow File \"/home/zhongshanshan/workspace/f/python/oneflow/__init__.py\", line 21, in <module> import oneflow._oneflow_internal ModuleNotFoundError: No module named 'oneflow._oneflow_internal' make: *** [Makefile:20: html] Error 2 \u8fdb\u5165 python \u547d\u4ee4\u884c\uff0c\u6267\u884c import oneflow\uff0c\u4e00\u5207\u6b63\u5e38\u3002\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u5230\uff0c\u8c03\u7528\u4e86\u7cfb\u7edf\u7684sphinx\uff0c\u8fd9\u662f\u56e0\u4e3a \u6ca1\u88c5\u5305\u5bfc\u81f4\u5230\u7cfb\u7edf\u73af\u5883\u4e2d\u627e sphinx\uff0c\u8fdb\u800c\u5bfc\u81f4\u5bfb\u627e\u4e0d\u5230 oneflow\u3002 \u89e3\u51b3\u65b9\u6cd5\uff1a make html \u524d install docs \u4e0b\u7684 requirements\u3002","title":"ModuleNotFoundError"},{"location":"engineering/20220408-23%20ninja%20build%20stopped.html","text":"23 ninja: build stopped: subcommand failed debug log\uff1a \u66f4\u6539 miniconda \u4e3a anaconda\uff0c\u540c\u6837\u62a5\u9519 \u6309\u7167 https://github.com/Oneflow-Inc/conda-env \u914d\u7f6e\u73af\u5883\uff0c\u540c\u6837\u62a5\u9519 \u91cd\u65b0 git clone git@github.com:Oneflow-Inc/oneflow.git\uff0c\u540c\u6837\u62a5\u9519 \u8003\u8651\u5230 cuda \u4f9d\u8d56\u5305\u7b49\u95ee\u9898\uff0c\u5b89\u88c5 PyTorch\uff0c\u540c\u6837\u62a5\u9519 \u8003\u8651\u5230\u4e0d\u7ba1\u548b\u641e black \u7248\u672c\u62a5\u9519\u90fd\u5b58\u5728\uff0c\u56e0\u6b64\u65b0\u5efa\u4e00\u4e2a\u5e72\u51c0\u7684\u73af\u5883\uff0c\u66f4\u6362python\u7248\u672c\uff0c\u540c\u6837\u62a5\u9519 \u5c06 click \u4ece 8.1 \u7248\u672c\u66f4\u6362\u6210 8.0 \u7248\u672c\uff0c\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\uff0c\u53c2\u8003 https://github.com/psf/black/issues/2964 \u62a5\u9519\u5982\u4e0b [226/1835] Performing build step for 'lz4' make[1]: Entering directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' compiling static library make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' make[1]: Entering directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' compiling dynamic library 1.9.2 creating versioned links make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' [234/1835] cd /home/zhongshanshan/workspace/tmp/oneflow/...workspace/tmp/oneflow/tools/oneflow-tblgen --fix --quiet FAILED: CMakeFiles/of_format /home/zhongshanshan/workspace/tmp/oneflow/build/CMakeFiles/of_format cd /home/zhongshanshan/workspace/tmp/oneflow/build && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_license_format.py -i /home/zhongshanshan/workspace/tmp/oneflow/oneflow --fix && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_license_format.py -i /home/zhongshanshan/workspace/tmp/oneflow/python --fix --exclude=\"oneflow/include\" --exclude=\"oneflow/core\" && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_clang_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/oneflow --fix --quiet && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_py_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/python --fix && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_clang_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/tools/oneflow-tblgen --fix --quiet [files] 2473 [files] 730 clang-format version 10.0.0-4ubuntu1 clang-format version 11.0.0 2458 files checked Traceback (most recent call last): File \"/home/zhongshanshan/anaconda3/envs/py38/lib/python3.8/runpy.py\", line 192, in _run_module_as_main return _run_code(code, main_globals, None, File \"/home/zhongshanshan/anaconda3/envs/py38/lib/python3.8/runpy.py\", line 85, in _run_code exec(code, run_globals) File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4139, in <module> patched_main() File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4134, in patched_main patch_click() File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4123, in patch_click from click import _unicodefun # type: ignore ImportError: cannot import name '_unicodefun' from 'click' (/home/zhongshanshan/.local/lib/python3.8/site-packages/click/__init__.py) Please install black 19.10b0. For instance, run 'python3 -m pip install black==19.10b0 --user' [295/1835] Performing configure step for 'opencv' loading initial cache file /home/zhongshanshan/workspace/tmp/oneflow/build/opencv/tmp/opencv-cache-Release.cmake -- The CXX compiler identification is GNU 9.4.0 \u6700\u7ec8\u7684\u62a5\u9519 a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_u64.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f16.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f32.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f64.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_bf16.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Archiving objects > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/colldevice.a make[2]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src/collectives/device' Linking libnccl.so.2.11.4 > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/lib/libnccl.so.2.11.4 Archiving libnccl_static.a > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/lib/libnccl_static.a /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src' ninja: build stopped: subcommand failed.","title":"23 ninja build stopped"},{"location":"engineering/20220408-23%20ninja%20build%20stopped.html#23-ninja-build-stopped-subcommand-failed","text":"debug log\uff1a \u66f4\u6539 miniconda \u4e3a anaconda\uff0c\u540c\u6837\u62a5\u9519 \u6309\u7167 https://github.com/Oneflow-Inc/conda-env \u914d\u7f6e\u73af\u5883\uff0c\u540c\u6837\u62a5\u9519 \u91cd\u65b0 git clone git@github.com:Oneflow-Inc/oneflow.git\uff0c\u540c\u6837\u62a5\u9519 \u8003\u8651\u5230 cuda \u4f9d\u8d56\u5305\u7b49\u95ee\u9898\uff0c\u5b89\u88c5 PyTorch\uff0c\u540c\u6837\u62a5\u9519 \u8003\u8651\u5230\u4e0d\u7ba1\u548b\u641e black \u7248\u672c\u62a5\u9519\u90fd\u5b58\u5728\uff0c\u56e0\u6b64\u65b0\u5efa\u4e00\u4e2a\u5e72\u51c0\u7684\u73af\u5883\uff0c\u66f4\u6362python\u7248\u672c\uff0c\u540c\u6837\u62a5\u9519 \u5c06 click \u4ece 8.1 \u7248\u672c\u66f4\u6362\u6210 8.0 \u7248\u672c\uff0c\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\uff0c\u53c2\u8003 https://github.com/psf/black/issues/2964 \u62a5\u9519\u5982\u4e0b [226/1835] Performing build step for 'lz4' make[1]: Entering directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' compiling static library make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' make[1]: Entering directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' compiling dynamic library 1.9.2 creating versioned links make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/lz4/src/lz4/lib' [234/1835] cd /home/zhongshanshan/workspace/tmp/oneflow/...workspace/tmp/oneflow/tools/oneflow-tblgen --fix --quiet FAILED: CMakeFiles/of_format /home/zhongshanshan/workspace/tmp/oneflow/build/CMakeFiles/of_format cd /home/zhongshanshan/workspace/tmp/oneflow/build && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_license_format.py -i /home/zhongshanshan/workspace/tmp/oneflow/oneflow --fix && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_license_format.py -i /home/zhongshanshan/workspace/tmp/oneflow/python --fix --exclude=\"oneflow/include\" --exclude=\"oneflow/core\" && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_clang_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/oneflow --fix --quiet && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_py_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/python --fix && /home/zhongshanshan/anaconda3/envs/py38/bin/python3 /home/zhongshanshan/workspace/tmp/oneflow/ci/check/run_clang_format.py --source_dir /home/zhongshanshan/workspace/tmp/oneflow/tools/oneflow-tblgen --fix --quiet [files] 2473 [files] 730 clang-format version 10.0.0-4ubuntu1 clang-format version 11.0.0 2458 files checked Traceback (most recent call last): File \"/home/zhongshanshan/anaconda3/envs/py38/lib/python3.8/runpy.py\", line 192, in _run_module_as_main return _run_code(code, main_globals, None, File \"/home/zhongshanshan/anaconda3/envs/py38/lib/python3.8/runpy.py\", line 85, in _run_code exec(code, run_globals) File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4139, in <module> patched_main() File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4134, in patched_main patch_click() File \"/home/zhongshanshan/.local/lib/python3.8/site-packages/black.py\", line 4123, in patch_click from click import _unicodefun # type: ignore ImportError: cannot import name '_unicodefun' from 'click' (/home/zhongshanshan/.local/lib/python3.8/site-packages/click/__init__.py) Please install black 19.10b0. For instance, run 'python3 -m pip install black==19.10b0 --user' [295/1835] Performing configure step for 'opencv' loading initial cache file /home/zhongshanshan/workspace/tmp/oneflow/build/opencv/tmp/opencv-cache-Release.cmake -- The CXX compiler identification is GNU 9.4.0 \u6700\u7ec8\u7684\u62a5\u9519 a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_u64.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f16.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f32.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_f64.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Compiling broadcast.cu > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/broadcast_sumpostdiv_bf16.o nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). nvcc warning : The 'compute_35', 'compute_37', 'compute_50', 'sm_35', 'sm_37' and 'sm_50' architectures are deprecated, and may be removed in a future release (Use -Wno-deprecated-gpu-targets to suppress warning). Archiving objects > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/obj/collectives/device/colldevice.a make[2]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src/collectives/device' Linking libnccl.so.2.11.4 > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/lib/libnccl.so.2.11.4 Archiving libnccl_static.a > /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/build/lib/libnccl_static.a /home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src make[1]: Leaving directory '/home/zhongshanshan/workspace/tmp/oneflow/build/nccl/src/nccl/src' ninja: build stopped: subcommand failed.","title":"23 ninja: build stopped: subcommand failed"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html","text":"\u6dfb\u52a0 deconv \u9700\u6c42\uff1a \u6dfb\u52a0 oneflow.nn.functional.conv_transpose* \u53bb\u9664\u591a\u4f59\u7684\u53c2\u6570 \u6d41\u7a0b cpp c++ \u529f\u80fd\u51fd\u6570 ./oneflow/core/functional/impl/nn_functor.cpp yaml \u6ce8\u518c python \u4e0e c++ \u7684\u63a5\u53e3 ./oneflow/core/functional/functional_api.yaml \u6ce8\uff1aPyTorch \u6ca1\u6709\u7684\u53c2\u6570\u79fb\u5230\u6700\u540e py-\u4f20\u53c2\u65b9\u5f0f python \u63a5\u53e3 ./python/oneflow/nn/modules/conv.py \u5bfc\u5165\u63a5\u53e3 ./python/oneflow/nn/functional/__init__.py test ./python/oneflow/test/expensive/test_convtranspose.py doc \u6dfb\u52a0 ./python/oneflow/framework/docstr/deconv.py \u5c06 deconv.py \u6dfb\u52a0\u5230 ./python/oneflow/framework/docstr/__init__.py \u4fee\u6539 ./docs/source/functional.rst \u6d4b\u8bd5\u95ee\u9898 \u6d4b\u8bd5\u4ee3\u7801\u5185\u7f6e\u5728 class TestConvTranspose(flow.unittest.TestCase) import unittest from collections import OrderedDict import numpy as np from oneflow.test_utils.test_util import GenArgList from oneflow.test_utils.automated_test_util import * import oneflow as flow import oneflow.nn as nn import oneflow.unittest import oneflow.nn.functional as F class TestConvTranspose(flow.unittest.TestCase): def test_functional_conv_transpose3d(test_case): inputs = torch.randn(20, 16, 50, 10, 20) weights = torch.randn(16, 33, 3, 3, 3) outputs = F.conv_transpose3d(inputs, weights) return outputs if __name__ == \"__main__\": unittest.main() \u9519\u8bef\u63cf\u8ff0 \u51fa\u73b0\u9519\u8bef Traceback (most recent call last): File \"/home/zhongshanshan/workspace/f/python/oneflow/test/expensive/test_convtranspose.py\", line 387, in test_functional_conv_transpose3d outputs = F.conv_transpose3d(inputs, weights) oneflow._oneflow_internal.exception.Exception: File \"/home/zhongshanshan/workspace/f/oneflow/api/python/functional/py_function.cpp\", line 98, in ParseArgs TypeError: deconv3d(): argument 'x' must be tensor, not <class 'unused_2568'> \u5c06 import oneflow.nn.functional as F \u6539\u4e3a import torch.nn.functional as F \uff0c\u62a5\u9519\u53d8\u66f4\u4e3a Traceback (most recent call last): File \"/home/zhongshanshan/workspace/f/python/oneflow/test/expensive/test_convtranspose.py\", line 387, in test_functional_conv_transpose3d outputs = F.conv_transpose3d(inputs, weights) File \"/home/zhongshanshan/workspace/f/python/oneflow/test_utils/automated_test_util/torch_flow_dual_object.py\", line 656, in dual_method oneflow_method = getattr(oneflow, method_name) AttributeError: 'oneflow._oneflow_internal.Tensor' object has no attribute '__torch_function__' \u89e3\u51b3\u65b9\u6cd5 \u5c06 F.conv_transpose3d \u6539\u4e3a torch.nn.functional.conv_transpose3d \u3002\u539f\u56e0\u53c2\u8003 \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1\uff1f \u3002\u6b64\u5916\uff0c\u9700\u8981\u5c06 torch.randn \u6539\u4e3a torch.ones \u3002\u8fd9\u91cc\u4e0d\u80fd\u7528randn\uff0c\u56e0\u4e3a\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u91cc\u4f1a\u7528pytorch\u548coneflow\u5206\u522b\u4ea7\u751f\u4e00\u6b21\u968f\u673atensor\uff0c\u90a3\u5f88\u53ef\u80fd\u8f93\u5165\u662f\u4e0d\u76f8\u7b49\u7684\uff0c\u8fd9\u6837\u5f97\u5230\u7684\u7ed3\u679c\u6570\u503c\u68c0\u67e5\u5c31\u4f1a\u5931\u8d25\u3002 \u8e29\u5751\u53f2 yaml \u4e2d list \u7684\u521d\u59cb\u5316\u9700\u8981\u6839\u636e \u7ef4\u5ea6 \u800c\u5b9a\uff0c\u5982 Int32List[3] dilation=1 \u5bf9\u4e8e 3d\uff0c Int32List[2] dilation=1 \u5bf9\u4e8e 2d \u67e5\u770b\u6587\u6863\uff0c\u5982\u67e5\u770b nn.functional.conv2d \u7684\u6587\u6863\uff0c\u53ef\u4ee5\u901a\u8fc7 nn.functional.conv2d.__doc__ \u6d4b\u8bd5\u6837\u4f8b\u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3aci\u4f1a\u591a\u8fdb\u7a0b\u8dd1\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u6837\u4f8b\u7684\u5185\u5b58\u4e0d\u80fd\u592a\u5927\uff0c\u4e0d\u7136\u53ef\u80fd\u5c31oom\u4e86","title":"\u6dfb\u52a0 deconv"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#deconv","text":"\u9700\u6c42\uff1a \u6dfb\u52a0 oneflow.nn.functional.conv_transpose* \u53bb\u9664\u591a\u4f59\u7684\u53c2\u6570","title":"\u6dfb\u52a0 deconv"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_1","text":"","title":"\u6d41\u7a0b"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#cpp","text":"c++ \u529f\u80fd\u51fd\u6570 ./oneflow/core/functional/impl/nn_functor.cpp","title":"cpp"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#yaml","text":"\u6ce8\u518c python \u4e0e c++ \u7684\u63a5\u53e3 ./oneflow/core/functional/functional_api.yaml \u6ce8\uff1aPyTorch \u6ca1\u6709\u7684\u53c2\u6570\u79fb\u5230\u6700\u540e","title":"yaml"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#py-","text":"python \u63a5\u53e3 ./python/oneflow/nn/modules/conv.py","title":"py-\u4f20\u53c2\u65b9\u5f0f"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_2","text":"./python/oneflow/nn/functional/__init__.py","title":"\u5bfc\u5165\u63a5\u53e3"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#test","text":"./python/oneflow/test/expensive/test_convtranspose.py","title":"test"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#doc","text":"\u6dfb\u52a0 ./python/oneflow/framework/docstr/deconv.py \u5c06 deconv.py \u6dfb\u52a0\u5230 ./python/oneflow/framework/docstr/__init__.py \u4fee\u6539 ./docs/source/functional.rst","title":"doc"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_3","text":"\u6d4b\u8bd5\u4ee3\u7801\u5185\u7f6e\u5728 class TestConvTranspose(flow.unittest.TestCase) import unittest from collections import OrderedDict import numpy as np from oneflow.test_utils.test_util import GenArgList from oneflow.test_utils.automated_test_util import * import oneflow as flow import oneflow.nn as nn import oneflow.unittest import oneflow.nn.functional as F class TestConvTranspose(flow.unittest.TestCase): def test_functional_conv_transpose3d(test_case): inputs = torch.randn(20, 16, 50, 10, 20) weights = torch.randn(16, 33, 3, 3, 3) outputs = F.conv_transpose3d(inputs, weights) return outputs if __name__ == \"__main__\": unittest.main()","title":"\u6d4b\u8bd5\u95ee\u9898"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_4","text":"\u51fa\u73b0\u9519\u8bef Traceback (most recent call last): File \"/home/zhongshanshan/workspace/f/python/oneflow/test/expensive/test_convtranspose.py\", line 387, in test_functional_conv_transpose3d outputs = F.conv_transpose3d(inputs, weights) oneflow._oneflow_internal.exception.Exception: File \"/home/zhongshanshan/workspace/f/oneflow/api/python/functional/py_function.cpp\", line 98, in ParseArgs TypeError: deconv3d(): argument 'x' must be tensor, not <class 'unused_2568'> \u5c06 import oneflow.nn.functional as F \u6539\u4e3a import torch.nn.functional as F \uff0c\u62a5\u9519\u53d8\u66f4\u4e3a Traceback (most recent call last): File \"/home/zhongshanshan/workspace/f/python/oneflow/test/expensive/test_convtranspose.py\", line 387, in test_functional_conv_transpose3d outputs = F.conv_transpose3d(inputs, weights) File \"/home/zhongshanshan/workspace/f/python/oneflow/test_utils/automated_test_util/torch_flow_dual_object.py\", line 656, in dual_method oneflow_method = getattr(oneflow, method_name) AttributeError: 'oneflow._oneflow_internal.Tensor' object has no attribute '__torch_function__'","title":"\u9519\u8bef\u63cf\u8ff0"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_5","text":"\u5c06 F.conv_transpose3d \u6539\u4e3a torch.nn.functional.conv_transpose3d \u3002\u539f\u56e0\u53c2\u8003 \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1\uff1f \u3002\u6b64\u5916\uff0c\u9700\u8981\u5c06 torch.randn \u6539\u4e3a torch.ones \u3002\u8fd9\u91cc\u4e0d\u80fd\u7528randn\uff0c\u56e0\u4e3a\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u91cc\u4f1a\u7528pytorch\u548coneflow\u5206\u522b\u4ea7\u751f\u4e00\u6b21\u968f\u673atensor\uff0c\u90a3\u5f88\u53ef\u80fd\u8f93\u5165\u662f\u4e0d\u76f8\u7b49\u7684\uff0c\u8fd9\u6837\u5f97\u5230\u7684\u7ed3\u679c\u6570\u503c\u68c0\u67e5\u5c31\u4f1a\u5931\u8d25\u3002","title":"\u89e3\u51b3\u65b9\u6cd5"},{"location":"engineering/20220408-%E6%B7%BB%E5%8A%A0deconv.html#_6","text":"yaml \u4e2d list \u7684\u521d\u59cb\u5316\u9700\u8981\u6839\u636e \u7ef4\u5ea6 \u800c\u5b9a\uff0c\u5982 Int32List[3] dilation=1 \u5bf9\u4e8e 3d\uff0c Int32List[2] dilation=1 \u5bf9\u4e8e 2d \u67e5\u770b\u6587\u6863\uff0c\u5982\u67e5\u770b nn.functional.conv2d \u7684\u6587\u6863\uff0c\u53ef\u4ee5\u901a\u8fc7 nn.functional.conv2d.__doc__ \u6d4b\u8bd5\u6837\u4f8b\u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3aci\u4f1a\u591a\u8fdb\u7a0b\u8dd1\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u6837\u4f8b\u7684\u5185\u5b58\u4e0d\u80fd\u592a\u5927\uff0c\u4e0d\u7136\u53ef\u80fd\u5c31oom\u4e86","title":"\u8e29\u5751\u53f2"},{"location":"engineering/20220411-autotest.html","text":"AutoTest \u672c\u7bc7\u4e3aAutoTest\u5feb\u901f\u4e0a\u624b\u548c\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879\uff0c\u6e90\u7801\u903b\u8f91\u4e0edebug\u89c1\uff1a \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1 \u7b80\u4ecb AutoTest\u6846\u67b6\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2ahigh level\u7684PyTorch\uff0c\u5b83\u7684\u63a5\u53e3\u548cPyTorch\u4e00\u6837\uff0c\u4f46\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u8f93\u5165\u4f1a\u5206\u522b\u7528OneFlow\u548cPyTorch\u8fd0\u884c\u4e00\u904d\uff0c\u8bb0\u5f55\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7684\u6bcf\u4e2atensor\u4ee5\u53ca\u5bf9\u5e94\u68af\u5ea6tensor\u7684\u503c\uff0c\u518d\u5bf9\u8fd9\u4e9bOneFlow\u548cPyTorch\u5206\u522b\u4ea7\u751f\u7684tensor\u68c0\u67e5\u4e00\u904d\u6570\u503c\u5f62\u72b6\u662f\u5426\u5b8c\u5168\u76f8\u540c\uff0c\u4ee5\u5b8c\u6210\u81ea\u52a8\u6d4b\u8bd5\u5de5\u4f5c\u3002 \u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u4e3b\u8981\u5b8c\u6210\uff1a \u81ea\u52a8\u968f\u673a\u51fa\u5404\u79cd\u5408\u6cd5\u53c2\u6570\u7ec4\u5408\u6210\u7684Op \u57fa\u4e8e\u6570\u503c\u548c\u7c7b\u578b\u5b8c\u5168\u76f8\u540c\u7684\u8f93\u5165Tensor\uff08PyTorch\u548cOneFlow\u5404\u6709\u4e00\u4efd\uff09\u5206\u522b\u8fd0\u884cPyTorch\u548cOneFlow\u7684\u4ee3\u7801 \u68c0\u67e5\u4e24\u4efd\u6570\u503c\u7ed3\u679c\u5f62\u72b6\u662f\u5426\u5b8c\u5168\u76f8\u540c \u4f7f\u7528 random \u9700\u8981\u5b9a\u4e49 random \u6a21\u5757\u7684\u539f\u56e0\u5728\u4e8e\u9700\u8981\u505a\u5230 Pytorch \u548c OneFlow \u8f93\u5165\u7edf\u4e00\u7684\u524d\u63d0\u4e0b\u968f\u673a\u751f\u6210\u8f93\u5165\u3002 k = random(1, 6) x = random_pytorch_tensor(ndim=2, dim1=k) y = random_pytorch_tensor(ndim=2, dim0=k) print(x.value()) x = random(1, 4).to(int) x.eval() # int \u6307\u5b9a k \u5c06\u4f1a\u5728 [1, 4) \u8fd9\u4e2a\u533a\u95f4\u8fdb\u884c\u53d6\u503c \u57fa\u4e8e random_pytorch_tensor \u65b9\u6cd5\u6784\u9020\u4e86\u4e24\u4e2a2\u7ef4\u968f\u673atensor x \u548c y \uff0c\u5b83\u4eec\u7684\u7ef4\u5ea6\u5206\u522b\u662f [m, k] \u548c [k, n] \uff0c\u8fd9\u4e9b\u7ef4\u5ea6\u7684\u503c\u90fd\u662f\u968f\u673a\u751f\u6210\u7684\u3002 def random_pytorch_tensor( ndim=None, # \u7ef4\u5ea6 dim0=1, # \u4e00\u7ef4\u5927\u5c0f dim1=None, # \u4e8c\u7ef4\u5927\u5c0f dim2=None, # \u2026\u2026 dim3=None, dim4=None, low=0, high=1, dtype=float, requires_grad=True, ): \u53ef\u4ee5\u7c97\u7565\u7406\u89e3 random_pytorch_tensor \u8fd4\u56de\u7684\u662f PyTorch \u4e0e Oneflow \u4e24\u4e2a\u7248\u672c\u7684tensor\uff0c random_tensor \u8fd4\u56de\u7684\u662f Pytorch \u7248\u672c\u7684 tensor\uff0c\u4e8c\u8005\u7684\u53c2\u6570\u662f\u4e00\u6837\u7684 @ autotest def autotest( n=20, # \u6d4b\u8bd5\u6b21\u6570 auto_backward=True, # \u662f\u5426\u6d4b\u8bd5\u68af\u5ea6\u56de\u4f20 rtol=0.0001, # \u642d\u914d check_allclose \u4f7f\u7528\uff0c\u5bf9\u5e94 np.allclose atol=1e-05, # \u642d\u914d check_allclose \u4f7f\u7528\uff0c\u5bf9\u5e94 np.allclose check_graph=True, check_allclose=True, ): verbose = os.getenv(\"ONEFLOW_TEST_VERBOSE\") is not None def deco(f): @functools.wraps(f) def new_f(test_case): nonlocal n loop_limit = n * 20 loop = 0 while n > 0: clear_note_fake_program() if loop > loop_limit: raise ValueError(\"autotest stuck in an endless loop!\") dual_modules_to_test.clear() dual_objects_to_test.clear() try: global testing testing = True global testing_graph if check_graph: testing_graph = True res = f(test_case) # \u5728\u7ed9\u5b9a\u8f93\u5165\u7684\u60c5\u51b5\u4e0b\u53bb\u5206\u522b\u8fd0\u884cPyTorch\u548cOneFlow\u7684\u7a0b\u5e8f\u83b7\u5f97\u6240\u6709\u4e2d\u95f4\u7684\u8f93\u51fatensor\uff0c\u5305\u62ectensor\u7684\u68af\u5ea6\uff0c\u5e76\u5c06\u5b83\u4eec\u8bb0\u5f55\u5230dual_modules_to_test\u8fd9\u4e2a\u5217\u8868 testing = False testing_graph = False except (PyTorchDoesNotSupportError, BothDoNotSupportError) as e: if verbose: print(f\"{f.__name__}\") print(e) loop += 1 continue if res is not None: if not isinstance(res, collections.abc.Sequence): res = [res] func_outputs = res for x in res: if auto_backward: if isinstance(x.pytorch, torch_original.Tensor): call_tensor_id.append(id(x.pytorch)) x.sum().backward() dual_objects_to_test.append(x) for x in dual_modules_to_test: for key in x.pytorch.state_dict().keys(): if key not in x.oneflow.state_dict().keys(): warnings.warn(f\"oneflow module don't have `{key}`\") continue vis_parameters[key] = x.pytorch.state_dict()[key] dual_objects_to_test.append( GetDualObject( \"unused\", getattr(x.pytorch, key), getattr(x.oneflow, key), ) ) call_tensor_id.append(id(getattr(x.pytorch, key))) dual_objects_to_test.append( GetDualObject( \"unused\", getattr(x.pytorch, key).grad, getattr(x.oneflow, key).grad, ) ) call_tensor_id.append(id(getattr(x.pytorch, key).grad)) for x in dual_objects_to_test: if ( isinstance(x.pytorch, torch_original.Tensor) and id(x.pytorch) not in call_tensor_id ): vis_tensor.append(x.pytorch) # check eager for x in dual_objects_to_test: if check_allclose: test_case.assertTrue(check_equality(x, rtol=rtol, atol=atol), x) if verbose: print(f\"{f.__name__} test eager passed.\") n -= 1 loop += 1 return new_f return deco \u6837\u4f8b import unittest # \u5bfc\u5165\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6unittest\u5b9e\u73b0\u6d4b\u8bd5 import oneflow as flow # \u652f\u6301flow.unittest.TestCase import oneflow.unittest # \u652f\u6301flow.unittest.TestCase from oneflow.test_utils.automated_test_util import * # \u5bfc\u5165autotest class TestConvTranspose(flow.unittest.TestCase): @autotest(n=1) def test_ConvTranspose1d_(test_case): channels = random(1, 6) m = torch.nn.ConvTranspose1d( in_channels=channels, out_channels=random(1, 20), kernel_size=random(1, 4), stride=random() | nothing(), padding=random(1, 3).to(int) | nothing(), dilation=random(1, 5) | nothing(), groups=random(1, 5) | nothing(), padding_mode=constant(\"zeros\") | nothing(), ) m.train(random()) device = random_device() m.to(device) x = random_tensor(ndim=3, dim1=channels).to(device) y = m(x) return y if __name__ == \"__main__\": unittest.main() \u6ce8\u610f\u4e8b\u9879 test \u65b9\u6cd5\u4f53\u4e2d\u7684 torch \u7531 autotest \u5904\u7406\uff0c\u6240\u4ee5\u8c03\u7528 torch.nn.functional.conv1d \u65f6\u4e0d\u53ef\u4ee5\u4f7f\u7528 import torch.nn.functional as F \u8fdb\u884c\u7b80\u5199 torch.randn \u4e0d\u5b9c\u4f7f\u7528\uff0c\u5e94\u5f53\u4f7f\u7528 torch.ones \u6216\u8005 random \u65b9\u6cd5\u66ff\u4ee3\u3002\u56e0\u4e3a\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u91cc\u4f1a\u7528pytorch\u548coneflow\u5206\u522b\u4ea7\u751f\u4e00\u6b21\u968f\u673atensor\uff0c\u90a3\u5f88\u53ef\u80fd\u8f93\u5165\u662f\u4e0d\u76f8\u7b49\u7684\uff0c\u8fd9\u6837\u5f97\u5230\u7684\u7ed3\u679c\u6570\u503c\u68c0\u67e5\u5c31\u4f1a\u5931\u8d25","title":"AutoTest"},{"location":"engineering/20220411-autotest.html#autotest","text":"\u672c\u7bc7\u4e3aAutoTest\u5feb\u901f\u4e0a\u624b\u548c\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879\uff0c\u6e90\u7801\u903b\u8f91\u4e0edebug\u89c1\uff1a \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1","title":"AutoTest"},{"location":"engineering/20220411-autotest.html#_1","text":"AutoTest\u6846\u67b6\u76f8\u5f53\u4e8e\u662f\u4e00\u4e2ahigh level\u7684PyTorch\uff0c\u5b83\u7684\u63a5\u53e3\u548cPyTorch\u4e00\u6837\uff0c\u4f46\u5bf9\u4e8e\u7ed9\u5b9a\u7684\u8f93\u5165\u4f1a\u5206\u522b\u7528OneFlow\u548cPyTorch\u8fd0\u884c\u4e00\u904d\uff0c\u8bb0\u5f55\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7684\u6bcf\u4e2atensor\u4ee5\u53ca\u5bf9\u5e94\u68af\u5ea6tensor\u7684\u503c\uff0c\u518d\u5bf9\u8fd9\u4e9bOneFlow\u548cPyTorch\u5206\u522b\u4ea7\u751f\u7684tensor\u68c0\u67e5\u4e00\u904d\u6570\u503c\u5f62\u72b6\u662f\u5426\u5b8c\u5168\u76f8\u540c\uff0c\u4ee5\u5b8c\u6210\u81ea\u52a8\u6d4b\u8bd5\u5de5\u4f5c\u3002 \u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u4e3b\u8981\u5b8c\u6210\uff1a \u81ea\u52a8\u968f\u673a\u51fa\u5404\u79cd\u5408\u6cd5\u53c2\u6570\u7ec4\u5408\u6210\u7684Op \u57fa\u4e8e\u6570\u503c\u548c\u7c7b\u578b\u5b8c\u5168\u76f8\u540c\u7684\u8f93\u5165Tensor\uff08PyTorch\u548cOneFlow\u5404\u6709\u4e00\u4efd\uff09\u5206\u522b\u8fd0\u884cPyTorch\u548cOneFlow\u7684\u4ee3\u7801 \u68c0\u67e5\u4e24\u4efd\u6570\u503c\u7ed3\u679c\u5f62\u72b6\u662f\u5426\u5b8c\u5168\u76f8\u540c","title":"\u7b80\u4ecb"},{"location":"engineering/20220411-autotest.html#_2","text":"","title":"\u4f7f\u7528"},{"location":"engineering/20220411-autotest.html#random","text":"\u9700\u8981\u5b9a\u4e49 random \u6a21\u5757\u7684\u539f\u56e0\u5728\u4e8e\u9700\u8981\u505a\u5230 Pytorch \u548c OneFlow \u8f93\u5165\u7edf\u4e00\u7684\u524d\u63d0\u4e0b\u968f\u673a\u751f\u6210\u8f93\u5165\u3002 k = random(1, 6) x = random_pytorch_tensor(ndim=2, dim1=k) y = random_pytorch_tensor(ndim=2, dim0=k) print(x.value()) x = random(1, 4).to(int) x.eval() # int \u6307\u5b9a k \u5c06\u4f1a\u5728 [1, 4) \u8fd9\u4e2a\u533a\u95f4\u8fdb\u884c\u53d6\u503c \u57fa\u4e8e random_pytorch_tensor \u65b9\u6cd5\u6784\u9020\u4e86\u4e24\u4e2a2\u7ef4\u968f\u673atensor x \u548c y \uff0c\u5b83\u4eec\u7684\u7ef4\u5ea6\u5206\u522b\u662f [m, k] \u548c [k, n] \uff0c\u8fd9\u4e9b\u7ef4\u5ea6\u7684\u503c\u90fd\u662f\u968f\u673a\u751f\u6210\u7684\u3002 def random_pytorch_tensor( ndim=None, # \u7ef4\u5ea6 dim0=1, # \u4e00\u7ef4\u5927\u5c0f dim1=None, # \u4e8c\u7ef4\u5927\u5c0f dim2=None, # \u2026\u2026 dim3=None, dim4=None, low=0, high=1, dtype=float, requires_grad=True, ): \u53ef\u4ee5\u7c97\u7565\u7406\u89e3 random_pytorch_tensor \u8fd4\u56de\u7684\u662f PyTorch \u4e0e Oneflow \u4e24\u4e2a\u7248\u672c\u7684tensor\uff0c random_tensor \u8fd4\u56de\u7684\u662f Pytorch \u7248\u672c\u7684 tensor\uff0c\u4e8c\u8005\u7684\u53c2\u6570\u662f\u4e00\u6837\u7684","title":"random"},{"location":"engineering/20220411-autotest.html#autotest_1","text":"def autotest( n=20, # \u6d4b\u8bd5\u6b21\u6570 auto_backward=True, # \u662f\u5426\u6d4b\u8bd5\u68af\u5ea6\u56de\u4f20 rtol=0.0001, # \u642d\u914d check_allclose \u4f7f\u7528\uff0c\u5bf9\u5e94 np.allclose atol=1e-05, # \u642d\u914d check_allclose \u4f7f\u7528\uff0c\u5bf9\u5e94 np.allclose check_graph=True, check_allclose=True, ): verbose = os.getenv(\"ONEFLOW_TEST_VERBOSE\") is not None def deco(f): @functools.wraps(f) def new_f(test_case): nonlocal n loop_limit = n * 20 loop = 0 while n > 0: clear_note_fake_program() if loop > loop_limit: raise ValueError(\"autotest stuck in an endless loop!\") dual_modules_to_test.clear() dual_objects_to_test.clear() try: global testing testing = True global testing_graph if check_graph: testing_graph = True res = f(test_case) # \u5728\u7ed9\u5b9a\u8f93\u5165\u7684\u60c5\u51b5\u4e0b\u53bb\u5206\u522b\u8fd0\u884cPyTorch\u548cOneFlow\u7684\u7a0b\u5e8f\u83b7\u5f97\u6240\u6709\u4e2d\u95f4\u7684\u8f93\u51fatensor\uff0c\u5305\u62ectensor\u7684\u68af\u5ea6\uff0c\u5e76\u5c06\u5b83\u4eec\u8bb0\u5f55\u5230dual_modules_to_test\u8fd9\u4e2a\u5217\u8868 testing = False testing_graph = False except (PyTorchDoesNotSupportError, BothDoNotSupportError) as e: if verbose: print(f\"{f.__name__}\") print(e) loop += 1 continue if res is not None: if not isinstance(res, collections.abc.Sequence): res = [res] func_outputs = res for x in res: if auto_backward: if isinstance(x.pytorch, torch_original.Tensor): call_tensor_id.append(id(x.pytorch)) x.sum().backward() dual_objects_to_test.append(x) for x in dual_modules_to_test: for key in x.pytorch.state_dict().keys(): if key not in x.oneflow.state_dict().keys(): warnings.warn(f\"oneflow module don't have `{key}`\") continue vis_parameters[key] = x.pytorch.state_dict()[key] dual_objects_to_test.append( GetDualObject( \"unused\", getattr(x.pytorch, key), getattr(x.oneflow, key), ) ) call_tensor_id.append(id(getattr(x.pytorch, key))) dual_objects_to_test.append( GetDualObject( \"unused\", getattr(x.pytorch, key).grad, getattr(x.oneflow, key).grad, ) ) call_tensor_id.append(id(getattr(x.pytorch, key).grad)) for x in dual_objects_to_test: if ( isinstance(x.pytorch, torch_original.Tensor) and id(x.pytorch) not in call_tensor_id ): vis_tensor.append(x.pytorch) # check eager for x in dual_objects_to_test: if check_allclose: test_case.assertTrue(check_equality(x, rtol=rtol, atol=atol), x) if verbose: print(f\"{f.__name__} test eager passed.\") n -= 1 loop += 1 return new_f return deco","title":"@ autotest"},{"location":"engineering/20220411-autotest.html#_3","text":"import unittest # \u5bfc\u5165\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6unittest\u5b9e\u73b0\u6d4b\u8bd5 import oneflow as flow # \u652f\u6301flow.unittest.TestCase import oneflow.unittest # \u652f\u6301flow.unittest.TestCase from oneflow.test_utils.automated_test_util import * # \u5bfc\u5165autotest class TestConvTranspose(flow.unittest.TestCase): @autotest(n=1) def test_ConvTranspose1d_(test_case): channels = random(1, 6) m = torch.nn.ConvTranspose1d( in_channels=channels, out_channels=random(1, 20), kernel_size=random(1, 4), stride=random() | nothing(), padding=random(1, 3).to(int) | nothing(), dilation=random(1, 5) | nothing(), groups=random(1, 5) | nothing(), padding_mode=constant(\"zeros\") | nothing(), ) m.train(random()) device = random_device() m.to(device) x = random_tensor(ndim=3, dim1=channels).to(device) y = m(x) return y if __name__ == \"__main__\": unittest.main()","title":"\u6837\u4f8b"},{"location":"engineering/20220411-autotest.html#_4","text":"test \u65b9\u6cd5\u4f53\u4e2d\u7684 torch \u7531 autotest \u5904\u7406\uff0c\u6240\u4ee5\u8c03\u7528 torch.nn.functional.conv1d \u65f6\u4e0d\u53ef\u4ee5\u4f7f\u7528 import torch.nn.functional as F \u8fdb\u884c\u7b80\u5199 torch.randn \u4e0d\u5b9c\u4f7f\u7528\uff0c\u5e94\u5f53\u4f7f\u7528 torch.ones \u6216\u8005 random \u65b9\u6cd5\u66ff\u4ee3\u3002\u56e0\u4e3a\u81ea\u52a8\u6d4b\u8bd5\u6846\u67b6\u91cc\u4f1a\u7528pytorch\u548coneflow\u5206\u522b\u4ea7\u751f\u4e00\u6b21\u968f\u673atensor\uff0c\u90a3\u5f88\u53ef\u80fd\u8f93\u5165\u662f\u4e0d\u76f8\u7b49\u7684\uff0c\u8fd9\u6837\u5f97\u5230\u7684\u7ed3\u679c\u6570\u503c\u68c0\u67e5\u5c31\u4f1a\u5931\u8d25","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"engineering/20220412-orthogonal_.html","text":"\u6dfb\u52a0 nn init orthogonal \u53c2\u8003\uff1a PyTorch mxnet \u5de5\u4f5c\u6d41\u7a0b \u901a\u8fc7 VSCode \u6587\u4ef6\u5939\u67e5\u627e\u8fdb\u884c\u6587\u4ef6\u6eaf\u6e90\uff0c\u6eaf\u6e90\u6d41\u7a0b\u5982\u4e0b\uff1a ./python/oneflow/nn/init.py ./python/oneflow/framework/tensor.py ./python/oneflow/__init__.py ./python/oneflow/ops/initializer_util.py \u95ee\u9898 \u7b97\u5b50\u6dfb\u52a0\u4f4d\u7f6e \u6eaf\u6e90\u5230 initializer_util.py\uff0c\u53d1\u73b0\u5982\u4e0b\u6587\u4ef6\uff1a ./python/oneflow/core/job/initializer_conf_pb2.py ./oneflow/core/job/initializer_conf.proto initializer \u8fd4\u56de\u7684\u662f initializer_conf_util.InitializerConf\uff0c\u8be5\u7c7b\u6765\u6e90\u4e8e initializer_conf_pb2\uff0cinitializer_conf_pb2 \u5f15\u7528\u4e86 initializer_conf.proto\uff0cinitializer_conf.proto \u5df2\u7ecf\u5230\u4e86 C++ \u5c42\uff0c\u901a\u8fc7\u68c0\u7d22\u5df2\u7ecf\u4e0d\u80fd\u51c6\u786e\u5728 C++ \u4e2d\u8fdb\u884c\u5b9a\u4f4d\u3002 \u5f00\u59cb\u5206\u6790 C++ \u7b97\u5b50\u4f5c\u7528\u3002\u8fd9\u4e2a initializer_conf \u901a\u8fc7 _init_by_initializer_conf( ./python/oneflow/framework/tensor.py) \u53d1\u6325\u4f5c\u7528\uff0c\u5185\u90e8\u903b\u8f91\u4e0d\u662f\u5f88\u6e05\u6670 def _init_by_initializer_conf(tensor, initializer_conf, random_seed=None): if random_seed is None: random_seed = flow.default_generator.seed() shape = tuple(tensor.shape) initializer = initializer_util.GetInitializer(initializer_conf, random_seed, shape) np_arr = initializer_util.generate_values_by_initializer( initializer, shape, tensor.dtype ) if tensor.is_global: src_tensor = flow.tensor(np_arr) src_tensor = src_tensor.to_global( placement=tensor.placement, sbp=tuple(flow.sbp.broadcast for _ in range(len(tensor.sbp))), ) tensor.copy_(src_tensor) else: _copy_from_numpy_to_eager_local_tensor( tensor, np_arr, ) return tensor \u901a\u8fc7\u68c0\u7d22\u76f8\u5173\u7b97\u5b50 PR\uff0c\u603b\u7ed3 initializer \u7b97\u5b50\u7684\u5b9e\u73b0\u8def\u5f84\uff1a Dev kaiming uniform and normal initializer \uff0c\u662f\u5728 C++ \u8fdb\u884c\u4fee\u6539 \u4e5f\u53ef\u4ee5\u5728 . ./python/oneflow/framework/tensor.py \u4fee\u6539 \u6700\u7ec8\u901a\u8fc7\u8be2\u95ee \u6653\u96e8 \u786e\u5b9a\u5728 tensor \u6dfb\u52a0\uff0c\u4f46\u662f\u4ecd\u7136\u5bf9 C++ \u5185\u90e8\u903b\u8f91\u5f88\u832b\u7136\u3002 \u6587\u6863\u7edf\u4e00\u95ee\u9898 \u9700\u4e0d\u9700\u8981\u5199\u5bfc\u5305\u5462\uff1f \u6709\u4e9b\u6587\u6863\u5199\u793a\u4f8b\u4ee3\u7801\u7684\u65f6\u5019 \u52a0\u4e86 .. code-block:: python \uff0c\u6709\u4e9b\u6ca1\u6709\uff0c\u5b83\u4eec\u7684\u533a\u522b\u4e5f\u8bb8\u662f\u5728\u662f\u5426\u80fd\u8bc6\u522b\u7a7a\u767d\u5206\u884c\uff0c\u662f\u5426\u9700\u8981\u7edf\u4e00\uff1f \u5f53\u524d\u5bf9\u9f50\u4e86\u540c\u4e00\u7f51\u9875\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u505a\u5230\u6574\u4e2a\u6587\u6863\u5bf9\u9f50\u3002 \u7b97\u5b50\u5bf9\u9f50\u95ee\u9898 \u6d4b\u8bd5\u7528\u4e0d\u4e86 AutoTest\uff0c\u56e0\u4e3a init \u6a21\u5757\u7684\u7b97\u5b50\u5185\u5d4c\u4e86\u901a\u8fc7\u5206\u5e03\u51fd\u6570\u751f\u6210\u6743\u503c\u7684\u6a21\u5757\uff0c\u672c\u8eab\u5c31\u5177\u6709\u968f\u673a\u6027\u3002\u56e0\u6b64\u5bf9\u7b97\u5b50\u662f\u5426\u5bf9\u9f50\u8fdb\u884c\u4e86\u5206\u6790\u3002 \u6d4b\u8bd5 PyTorch \u7248\u672c\u7684\u4ee3\u7801 \uff0c\u53d1\u73b0\u586b\u5145\u77e9\u9635\u5e76\u4e0d\u662f\u4e25\u683c\u7684\uff08\u534a\uff09\u6b63\u5b9a\u77e9\u9635\uff0c\u77e9\u9635\u4e0e\u77e9\u9635\u8f6c\u7f6e\u7684\u4e58\u79ef\u7684\u5bf9\u89d2\u7ebf\u503c\u4e3a 1\uff0c\u4f46\u4e58\u79ef\u5176\u4ed6\u5143\u7d20\u4e0d\u4e00\u5b9a\u4e3a 0\uff0c\u800c\u4e14\u4e58\u79ef\u662f\u5bf9\u79f0\u77e9\u9635\u3002\u8bf4\u660e\u77e9\u9635\u5411\u91cf\u662f\u5355\u4f4d\u5411\u91cf\uff0c\u4f46\u662f\u4e0d\u4e00\u5b9a\u6b63\u4ea4\u3002\u6d4b\u8bd5\u4ee3\u7801\u5982\u4e0b\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) gain = 1 if tensor.ndimension() < 2: raise ValueError(\"Only tensors with 2 or more dimensions are supported\") rows = tensor.size(0) cols = tensor.numel() // rows flattened = tensor.new(rows, cols).normal_(0, 1) if rows < cols: flattened.t_() q, r = torch.linalg.qr(flattened) d = torch.diag(r, 0) ph = d.sign() q *= ph if rows < cols: q.t_() print(torch.matmul(q, q.t())) ''' tensor([[ 1.0000e+00, 2.9802e-08, -1.4901e-08], [ 2.9802e-08, 1.0000e+00, -4.4703e-08], [-1.4901e-08, -4.4703e-08, 1.0000e+00]]) ''' \u6d4b\u8bd5 mxnet \u7248\u672c\u7684\u4ee3\u7801 \uff0c\u7ed3\u679c\u4e5f\u4e0d\u662f\uff08\u534a\uff09\u6b63\u5b9a\u77e9\u9635\u3002\u6d4b\u8bd5\u4ee3\u7801\u5982\u4e0b\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) rows = tensor.shape[0] cols = np.prod(tensor.shape[1:]) flattened = np.random.normal(0.0, 1.0, size=(rows, cols)) if rows < cols: flattened = flattened.T u, _, v = np.linalg.svd(flattened, full_matrices=False) if u.shape == flattened.shape: res = u else: res = v print(np.matmul(res, res.T)) ''' [[ 0.62967606 0.14242194 0.02739397 -0.45696218 0.05775161] [ 0.14242194 0.93914954 -0.0648611 0.1776109 0.03333284] [ 0.02739397 -0.0648611 0.51230715 0.05051142 0.49228014] [-0.45696218 0.1776109 0.05051142 0.43555551 0.05417968] [ 0.05775161 0.03333284 0.49228014 0.05417968 0.48331174]] ''' \u6700\u7ec8\u4f7f\u7528\u4e0e PyTorch \u5bf9\u9f50\u7684\u7248\u672c\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) rows = tensor.shape[0] cols = np.prod(tensor.shape[1:]) flattened = np.random.normal(0.0, 1.0, size=(rows, cols)) if rows < cols: flattened = flattened.T q, r = np.linalg.qr(flattened) d = np.diag(r, 0) d = np.where(d < 0, -1, d) d = np.where(d > 0, 1, d) q *= d if rows < cols: q = q.T print(np.matmul(q, q.T))","title":"\u6dfb\u52a0 nn.init.orthogonal"},{"location":"engineering/20220412-orthogonal_.html#nn-init-orthogonal","text":"\u53c2\u8003\uff1a PyTorch mxnet","title":"\u6dfb\u52a0 nn init orthogonal"},{"location":"engineering/20220412-orthogonal_.html#_1","text":"\u901a\u8fc7 VSCode \u6587\u4ef6\u5939\u67e5\u627e\u8fdb\u884c\u6587\u4ef6\u6eaf\u6e90\uff0c\u6eaf\u6e90\u6d41\u7a0b\u5982\u4e0b\uff1a ./python/oneflow/nn/init.py ./python/oneflow/framework/tensor.py ./python/oneflow/__init__.py ./python/oneflow/ops/initializer_util.py","title":"\u5de5\u4f5c\u6d41\u7a0b"},{"location":"engineering/20220412-orthogonal_.html#_2","text":"","title":"\u95ee\u9898"},{"location":"engineering/20220412-orthogonal_.html#_3","text":"\u6eaf\u6e90\u5230 initializer_util.py\uff0c\u53d1\u73b0\u5982\u4e0b\u6587\u4ef6\uff1a ./python/oneflow/core/job/initializer_conf_pb2.py ./oneflow/core/job/initializer_conf.proto initializer \u8fd4\u56de\u7684\u662f initializer_conf_util.InitializerConf\uff0c\u8be5\u7c7b\u6765\u6e90\u4e8e initializer_conf_pb2\uff0cinitializer_conf_pb2 \u5f15\u7528\u4e86 initializer_conf.proto\uff0cinitializer_conf.proto \u5df2\u7ecf\u5230\u4e86 C++ \u5c42\uff0c\u901a\u8fc7\u68c0\u7d22\u5df2\u7ecf\u4e0d\u80fd\u51c6\u786e\u5728 C++ \u4e2d\u8fdb\u884c\u5b9a\u4f4d\u3002 \u5f00\u59cb\u5206\u6790 C++ \u7b97\u5b50\u4f5c\u7528\u3002\u8fd9\u4e2a initializer_conf \u901a\u8fc7 _init_by_initializer_conf( ./python/oneflow/framework/tensor.py) \u53d1\u6325\u4f5c\u7528\uff0c\u5185\u90e8\u903b\u8f91\u4e0d\u662f\u5f88\u6e05\u6670 def _init_by_initializer_conf(tensor, initializer_conf, random_seed=None): if random_seed is None: random_seed = flow.default_generator.seed() shape = tuple(tensor.shape) initializer = initializer_util.GetInitializer(initializer_conf, random_seed, shape) np_arr = initializer_util.generate_values_by_initializer( initializer, shape, tensor.dtype ) if tensor.is_global: src_tensor = flow.tensor(np_arr) src_tensor = src_tensor.to_global( placement=tensor.placement, sbp=tuple(flow.sbp.broadcast for _ in range(len(tensor.sbp))), ) tensor.copy_(src_tensor) else: _copy_from_numpy_to_eager_local_tensor( tensor, np_arr, ) return tensor \u901a\u8fc7\u68c0\u7d22\u76f8\u5173\u7b97\u5b50 PR\uff0c\u603b\u7ed3 initializer \u7b97\u5b50\u7684\u5b9e\u73b0\u8def\u5f84\uff1a Dev kaiming uniform and normal initializer \uff0c\u662f\u5728 C++ \u8fdb\u884c\u4fee\u6539 \u4e5f\u53ef\u4ee5\u5728 . ./python/oneflow/framework/tensor.py \u4fee\u6539 \u6700\u7ec8\u901a\u8fc7\u8be2\u95ee \u6653\u96e8 \u786e\u5b9a\u5728 tensor \u6dfb\u52a0\uff0c\u4f46\u662f\u4ecd\u7136\u5bf9 C++ \u5185\u90e8\u903b\u8f91\u5f88\u832b\u7136\u3002","title":"\u7b97\u5b50\u6dfb\u52a0\u4f4d\u7f6e"},{"location":"engineering/20220412-orthogonal_.html#_4","text":"\u9700\u4e0d\u9700\u8981\u5199\u5bfc\u5305\u5462\uff1f \u6709\u4e9b\u6587\u6863\u5199\u793a\u4f8b\u4ee3\u7801\u7684\u65f6\u5019 \u52a0\u4e86 .. code-block:: python \uff0c\u6709\u4e9b\u6ca1\u6709\uff0c\u5b83\u4eec\u7684\u533a\u522b\u4e5f\u8bb8\u662f\u5728\u662f\u5426\u80fd\u8bc6\u522b\u7a7a\u767d\u5206\u884c\uff0c\u662f\u5426\u9700\u8981\u7edf\u4e00\uff1f \u5f53\u524d\u5bf9\u9f50\u4e86\u540c\u4e00\u7f51\u9875\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u505a\u5230\u6574\u4e2a\u6587\u6863\u5bf9\u9f50\u3002","title":"\u6587\u6863\u7edf\u4e00\u95ee\u9898"},{"location":"engineering/20220412-orthogonal_.html#_5","text":"\u6d4b\u8bd5\u7528\u4e0d\u4e86 AutoTest\uff0c\u56e0\u4e3a init \u6a21\u5757\u7684\u7b97\u5b50\u5185\u5d4c\u4e86\u901a\u8fc7\u5206\u5e03\u51fd\u6570\u751f\u6210\u6743\u503c\u7684\u6a21\u5757\uff0c\u672c\u8eab\u5c31\u5177\u6709\u968f\u673a\u6027\u3002\u56e0\u6b64\u5bf9\u7b97\u5b50\u662f\u5426\u5bf9\u9f50\u8fdb\u884c\u4e86\u5206\u6790\u3002 \u6d4b\u8bd5 PyTorch \u7248\u672c\u7684\u4ee3\u7801 \uff0c\u53d1\u73b0\u586b\u5145\u77e9\u9635\u5e76\u4e0d\u662f\u4e25\u683c\u7684\uff08\u534a\uff09\u6b63\u5b9a\u77e9\u9635\uff0c\u77e9\u9635\u4e0e\u77e9\u9635\u8f6c\u7f6e\u7684\u4e58\u79ef\u7684\u5bf9\u89d2\u7ebf\u503c\u4e3a 1\uff0c\u4f46\u4e58\u79ef\u5176\u4ed6\u5143\u7d20\u4e0d\u4e00\u5b9a\u4e3a 0\uff0c\u800c\u4e14\u4e58\u79ef\u662f\u5bf9\u79f0\u77e9\u9635\u3002\u8bf4\u660e\u77e9\u9635\u5411\u91cf\u662f\u5355\u4f4d\u5411\u91cf\uff0c\u4f46\u662f\u4e0d\u4e00\u5b9a\u6b63\u4ea4\u3002\u6d4b\u8bd5\u4ee3\u7801\u5982\u4e0b\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) gain = 1 if tensor.ndimension() < 2: raise ValueError(\"Only tensors with 2 or more dimensions are supported\") rows = tensor.size(0) cols = tensor.numel() // rows flattened = tensor.new(rows, cols).normal_(0, 1) if rows < cols: flattened.t_() q, r = torch.linalg.qr(flattened) d = torch.diag(r, 0) ph = d.sign() q *= ph if rows < cols: q.t_() print(torch.matmul(q, q.t())) ''' tensor([[ 1.0000e+00, 2.9802e-08, -1.4901e-08], [ 2.9802e-08, 1.0000e+00, -4.4703e-08], [-1.4901e-08, -4.4703e-08, 1.0000e+00]]) ''' \u6d4b\u8bd5 mxnet \u7248\u672c\u7684\u4ee3\u7801 \uff0c\u7ed3\u679c\u4e5f\u4e0d\u662f\uff08\u534a\uff09\u6b63\u5b9a\u77e9\u9635\u3002\u6d4b\u8bd5\u4ee3\u7801\u5982\u4e0b\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) rows = tensor.shape[0] cols = np.prod(tensor.shape[1:]) flattened = np.random.normal(0.0, 1.0, size=(rows, cols)) if rows < cols: flattened = flattened.T u, _, v = np.linalg.svd(flattened, full_matrices=False) if u.shape == flattened.shape: res = u else: res = v print(np.matmul(res, res.T)) ''' [[ 0.62967606 0.14242194 0.02739397 -0.45696218 0.05775161] [ 0.14242194 0.93914954 -0.0648611 0.1776109 0.03333284] [ 0.02739397 -0.0648611 0.51230715 0.05051142 0.49228014] [-0.45696218 0.1776109 0.05051142 0.43555551 0.05417968] [ 0.05775161 0.03333284 0.49228014 0.05417968 0.48331174]] ''' \u6700\u7ec8\u4f7f\u7528\u4e0e PyTorch \u5bf9\u9f50\u7684\u7248\u672c\uff1a import torch import numpy as np tensor = torch.Tensor(3, 5) rows = tensor.shape[0] cols = np.prod(tensor.shape[1:]) flattened = np.random.normal(0.0, 1.0, size=(rows, cols)) if rows < cols: flattened = flattened.T q, r = np.linalg.qr(flattened) d = np.diag(r, 0) d = np.where(d < 0, -1, d) d = np.where(d > 0, 1, d) q *= d if rows < cols: q = q.T print(np.matmul(q, q.T))","title":"\u7b97\u5b50\u5bf9\u9f50\u95ee\u9898"},{"location":"engineering/20220413-docstring.html","text":"docString+Sphinx \u751f\u6210\u63a5\u53e3\u6587\u6863 docString \u7f16\u5199\u53ef\u53c2\u8003\u4e3b\u6d41\u6807\u51c6\u3002 \u95ee\u9898 \u5728\u9879\u76ee\u7684doc\u8bbe\u7f6e\u4e0b\uff0c def test(): \"\"\" Parameters: input (oneflow.Tensor): the input Tensor. dim (int or tuple of python:ints): the dimension or dimensions to reduce. keepdim (bool): whether the output tensor has `dim` retained or not. \u89e3\u51b3\u65b9\u6848 Parameters: input (oneflow.Tensor): the input Tensor. dim (int, Tuple[int]): the dimension or dimensions to reduce. keepdim (bool): whether the output tensor has `dim` retained or not. \"\"\" return Demo \u73af\u5883\u51c6\u5907 pip install sphinx # Sphinx \u4e3b\u8981\u529f\u80fd\u662f\u4f7f\u7528 reStructuredText, \u628a\u8bb8\u591a\u6587\u4ef6\u7ec4\u7ec7\u6210\u4e00\u4efd\u7ed3\u6784\u5408\u7406\u7684\u6587\u6863 pip install sphinx_rtd_theme # Sphinx \u7b2c\u4e09\u65b9\u4e3b\u9898 \u65b0\u5efa Sphinx \u9879\u76ee \u521b\u5efa\u6587\u4ef6\u5939 docTest \uff0c\u8fdb\u5165 docTest \uff0c\u521b\u5efa python \u6587\u4ef6\u653e\u7f6e\u7684\u76ee\u5f55 python \u3001\u6587\u6863\u76ee\u5f55 doc \uff0c\u8fdb\u5165 doc \u8fd0\u884c\u6307\u4ee4 sphinx-quickstart mkdir docTest cd docTest mkdir python mkdir doc cd doc sphinx-quickstart \u63a5\u4e0b\u6765\u4f1a\u51fa\u73b0\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f \u2026\u2026 You have two options for placing the build directory for Sphinx output. Either, you use a directory \"_build\" within the root path, or you separate \"source\" and \"build\" directories within the root path. > Separate source and build directories (y/n) [n]: y # \u662f\u5426\u4f7f\u7528 source \u548c build \u6587\u4ef6\u5939\u5206\u79bb\u7684\u65b9\u5f0f\u5b58\u50a8 Sphinx \u8f93\u51fa The project name will occur in several places in the built documentation. > Project name: docTest # \u9879\u76ee\u540d\u79f0 > Author name(s): shan # \u4f5c\u8005\u540d\u79f0 > Project release []: 0.0.1 # \u9879\u76ee\u7248\u672c\u53f7 If the documents are to be written in a language other than English, you can select a language here by its language code. Sphinx will then translate text that it generates into that language. For a list of supported codes, see https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language. > Project language [en]: # \u6587\u6863\u8bed\u8a00\uff0c\u56de\u8f66\u9ed8\u8ba4\u5373\u53ef \u2026\u2026 \u6210\u529f\u8fd0\u884c\u4e4b\u540e\u5728 docTest/doc/ \u4e0b\u751f\u6210\u5982\u4e0b\u5185\u5bb9 . \u251c\u2500\u2500 build # \u7528\u6765\u5b58\u653e\u901a\u8fc7make html\u751f\u6210\u6587\u6863\u7f51\u9875\u6587\u4ef6\u7684\u76ee\u5f55 \u251c\u2500\u2500 make.bat \u251c\u2500\u2500 Makefile \u2514\u2500\u2500 source # \u5b58\u653e\u7528\u4e8e\u751f\u6210\u6587\u6863\u7684\u6e90\u6587\u4ef6 \u251c\u2500\u2500 conf.py # \u5728\u6b64\u6587\u4ef6\u4fee\u6539\u9879\u76ee\u7684\u914d\u7f6e\u4fe1\u606f \u251c\u2500\u2500 index.rst # \u4e3b\u6587\u6863 \u251c\u2500\u2500 _static \u2514\u2500\u2500 _templates \u5728 docTest/doc/source/conf.py \u4e2d\u4fee\u6539\u914d\u7f6e\uff1a import os import sys sys.path.insert(0, os.path.abspath('../../python/')) # python \u6587\u4ef6\u4f4d\u7f6e\uff0c\u786e\u4fddpython\u6e90\u4ee3\u7801\u6240\u5728\u7684\u5305\u5728\u7cfb\u7edf\u8def\u5f84\u4e2d\u53ef\u4ee5\u627e\u5230 html_theme = 'sphinx_rtd_theme' # html \u98ce\u683c extensions = ['sphinx.ext.autodoc'] \u65b0\u5efa Python \u6587\u4ef6 \u4e3a\u4e86\u5c55\u793a\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u7684\u94fe\u63a5\u65b9\u5f0f\uff0c\u5728 docTest/python \u5206\u522b\u65b0\u5efa\u6587\u4ef6\u548c\u6587\u4ef6\u5939 \u65b0\u5efa\u6587\u4ef6\u5939 docTest/python/util/ \uff0c\u5728\u91cc\u9762\u653e\u4e0a\u4e00\u4e2a\u6587\u4ef6 initializers.py \u65b0\u5efa\u6587\u4ef6 docTest/python/orthogonal.py \u5173\u8054 Sphnix \u4e0e Python \u6587\u4ef6 \u4e3b\u8981\u4f7f\u7528 rst\u6587\u4ef6 \u3002\u5728 Sphnix \u4e2d\uff0c\u6bcf\u4e00\u4e2a rst \u4ee3\u8868\u4e00\u4e2a\u5355\u72ec\u7684 html \u9875\u9762\uff0c\u4e00\u822c\u4ee5 index.rst \u4f5c\u4e3a\u4e3b\u6587\u4ef6 util.rst\uff1a\u94fe\u63a5\u5230 util \u6587\u4ef6\u5939\u3002\u7531\u4e8e initializer.py \u4e2d calculate_gain \u662f\u65b9\u6cd5\uff0c\u6240\u4ee5\u6b64\u5904\u7528 automodule \u8fdb\u884c\u5bfb\u5740\u3002\u5982\u679c\u6dfb\u52a0\u7684\u662f class\uff0c\u4f7f\u7528 autoclass Util ============================================================ .. currentmodule:: util.initializers .. automodule:: util.initializers :members: calculate_gain :member-order: bysource index.rst\uff1a\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u6dfb\u52a0\u7f51\u9875\u548c\u5185\u5bb9 Welcome to demo's API Documentation =================================== .. toctree:: :maxdepth: 2 :caption: Contents: Folder in Python ====================== .. toctree:: :maxdepth: 4 util File in Python ======================= .. automodule:: orthogonal :members: \u7f16\u8bd1 \u5728 docTest/doc \u6587\u4ef6\u4e0b\u6267\u884c\u5982\u4e0b\u4ee3\u7801\uff0c\u5373\u80fd\u5728 `docTest/doc/build/html \u6587\u4ef6\u5939\u4e0b\u83b7\u5f97\u7f16\u8bd1\u597d\u7684\u7f51\u9875 make html","title":"docString+Sphinx \u751f\u6210\u63a5\u53e3\u6587\u6863"},{"location":"engineering/20220413-docstring.html#docstringsphinx","text":"docString \u7f16\u5199\u53ef\u53c2\u8003\u4e3b\u6d41\u6807\u51c6\u3002","title":"docString+Sphinx \u751f\u6210\u63a5\u53e3\u6587\u6863"},{"location":"engineering/20220413-docstring.html#_1","text":"\u5728\u9879\u76ee\u7684doc\u8bbe\u7f6e\u4e0b\uff0c def test(): \"\"\" Parameters: input (oneflow.Tensor): the input Tensor. dim (int or tuple of python:ints): the dimension or dimensions to reduce. keepdim (bool): whether the output tensor has `dim` retained or not. \u89e3\u51b3\u65b9\u6848 Parameters: input (oneflow.Tensor): the input Tensor. dim (int, Tuple[int]): the dimension or dimensions to reduce. keepdim (bool): whether the output tensor has `dim` retained or not. \"\"\" return","title":"\u95ee\u9898"},{"location":"engineering/20220413-docstring.html#demo","text":"","title":"Demo"},{"location":"engineering/20220413-docstring.html#_2","text":"pip install sphinx # Sphinx \u4e3b\u8981\u529f\u80fd\u662f\u4f7f\u7528 reStructuredText, \u628a\u8bb8\u591a\u6587\u4ef6\u7ec4\u7ec7\u6210\u4e00\u4efd\u7ed3\u6784\u5408\u7406\u7684\u6587\u6863 pip install sphinx_rtd_theme # Sphinx \u7b2c\u4e09\u65b9\u4e3b\u9898","title":"\u73af\u5883\u51c6\u5907"},{"location":"engineering/20220413-docstring.html#sphinx","text":"\u521b\u5efa\u6587\u4ef6\u5939 docTest \uff0c\u8fdb\u5165 docTest \uff0c\u521b\u5efa python \u6587\u4ef6\u653e\u7f6e\u7684\u76ee\u5f55 python \u3001\u6587\u6863\u76ee\u5f55 doc \uff0c\u8fdb\u5165 doc \u8fd0\u884c\u6307\u4ee4 sphinx-quickstart mkdir docTest cd docTest mkdir python mkdir doc cd doc sphinx-quickstart \u63a5\u4e0b\u6765\u4f1a\u51fa\u73b0\u4e00\u4e9b\u914d\u7f6e\u4fe1\u606f \u2026\u2026 You have two options for placing the build directory for Sphinx output. Either, you use a directory \"_build\" within the root path, or you separate \"source\" and \"build\" directories within the root path. > Separate source and build directories (y/n) [n]: y # \u662f\u5426\u4f7f\u7528 source \u548c build \u6587\u4ef6\u5939\u5206\u79bb\u7684\u65b9\u5f0f\u5b58\u50a8 Sphinx \u8f93\u51fa The project name will occur in several places in the built documentation. > Project name: docTest # \u9879\u76ee\u540d\u79f0 > Author name(s): shan # \u4f5c\u8005\u540d\u79f0 > Project release []: 0.0.1 # \u9879\u76ee\u7248\u672c\u53f7 If the documents are to be written in a language other than English, you can select a language here by its language code. Sphinx will then translate text that it generates into that language. For a list of supported codes, see https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language. > Project language [en]: # \u6587\u6863\u8bed\u8a00\uff0c\u56de\u8f66\u9ed8\u8ba4\u5373\u53ef \u2026\u2026 \u6210\u529f\u8fd0\u884c\u4e4b\u540e\u5728 docTest/doc/ \u4e0b\u751f\u6210\u5982\u4e0b\u5185\u5bb9 . \u251c\u2500\u2500 build # \u7528\u6765\u5b58\u653e\u901a\u8fc7make html\u751f\u6210\u6587\u6863\u7f51\u9875\u6587\u4ef6\u7684\u76ee\u5f55 \u251c\u2500\u2500 make.bat \u251c\u2500\u2500 Makefile \u2514\u2500\u2500 source # \u5b58\u653e\u7528\u4e8e\u751f\u6210\u6587\u6863\u7684\u6e90\u6587\u4ef6 \u251c\u2500\u2500 conf.py # \u5728\u6b64\u6587\u4ef6\u4fee\u6539\u9879\u76ee\u7684\u914d\u7f6e\u4fe1\u606f \u251c\u2500\u2500 index.rst # \u4e3b\u6587\u6863 \u251c\u2500\u2500 _static \u2514\u2500\u2500 _templates \u5728 docTest/doc/source/conf.py \u4e2d\u4fee\u6539\u914d\u7f6e\uff1a import os import sys sys.path.insert(0, os.path.abspath('../../python/')) # python \u6587\u4ef6\u4f4d\u7f6e\uff0c\u786e\u4fddpython\u6e90\u4ee3\u7801\u6240\u5728\u7684\u5305\u5728\u7cfb\u7edf\u8def\u5f84\u4e2d\u53ef\u4ee5\u627e\u5230 html_theme = 'sphinx_rtd_theme' # html \u98ce\u683c extensions = ['sphinx.ext.autodoc']","title":"\u65b0\u5efa Sphinx \u9879\u76ee"},{"location":"engineering/20220413-docstring.html#python","text":"\u4e3a\u4e86\u5c55\u793a\u6587\u4ef6\u548c\u6587\u4ef6\u5939\u7684\u94fe\u63a5\u65b9\u5f0f\uff0c\u5728 docTest/python \u5206\u522b\u65b0\u5efa\u6587\u4ef6\u548c\u6587\u4ef6\u5939 \u65b0\u5efa\u6587\u4ef6\u5939 docTest/python/util/ \uff0c\u5728\u91cc\u9762\u653e\u4e0a\u4e00\u4e2a\u6587\u4ef6 initializers.py \u65b0\u5efa\u6587\u4ef6 docTest/python/orthogonal.py","title":"\u65b0\u5efa Python \u6587\u4ef6"},{"location":"engineering/20220413-docstring.html#sphnix-python","text":"\u4e3b\u8981\u4f7f\u7528 rst\u6587\u4ef6 \u3002\u5728 Sphnix \u4e2d\uff0c\u6bcf\u4e00\u4e2a rst \u4ee3\u8868\u4e00\u4e2a\u5355\u72ec\u7684 html \u9875\u9762\uff0c\u4e00\u822c\u4ee5 index.rst \u4f5c\u4e3a\u4e3b\u6587\u4ef6 util.rst\uff1a\u94fe\u63a5\u5230 util \u6587\u4ef6\u5939\u3002\u7531\u4e8e initializer.py \u4e2d calculate_gain \u662f\u65b9\u6cd5\uff0c\u6240\u4ee5\u6b64\u5904\u7528 automodule \u8fdb\u884c\u5bfb\u5740\u3002\u5982\u679c\u6dfb\u52a0\u7684\u662f class\uff0c\u4f7f\u7528 autoclass Util ============================================================ .. currentmodule:: util.initializers .. automodule:: util.initializers :members: calculate_gain :member-order: bysource index.rst\uff1a\u901a\u8fc7\u4e0d\u540c\u7684\u65b9\u5f0f\u6dfb\u52a0\u7f51\u9875\u548c\u5185\u5bb9 Welcome to demo's API Documentation =================================== .. toctree:: :maxdepth: 2 :caption: Contents: Folder in Python ====================== .. toctree:: :maxdepth: 4 util File in Python ======================= .. automodule:: orthogonal :members:","title":"\u5173\u8054 Sphnix \u4e0e Python \u6587\u4ef6"},{"location":"engineering/20220413-docstring.html#_3","text":"\u5728 docTest/doc \u6587\u4ef6\u4e0b\u6267\u884c\u5982\u4e0b\u4ee3\u7801\uff0c\u5373\u80fd\u5728 `docTest/doc/build/html \u6587\u4ef6\u5939\u4e0b\u83b7\u5f97\u7f16\u8bd1\u597d\u7684\u7f51\u9875 make html","title":"\u7f16\u8bd1"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html","text":"\u4fee\u6539 reduce ops reduce_ops.py \u91cc\u7684max\u3001min\u3001sum\u7b49\u64cd\u4f5c\u6539\u6210Functor\u76f4\u63a5\u5bfc\u51fa\u3002 \u95ee\u98981 ninja \u7a81\u7136\u51fa\u73b0\u7f16\u8bd1\u9519\u8bef\u95ee\u9898\uff0c\u91cd\u65b0clone\u4e4b\u540e\u5207\u6362\u5230\u5f53\u524d\u5206\u652f\u4e5f\u4f1a\u7f16\u8bd1\u62a5\u9519\uff0c\u6700\u7ec8\u5220\u9664\u5206\u652f\u91cd\u5efa\u3002 /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(275): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclS2SKernel<oneflow::float16>\" detected during: instantiation of class \"oneflow::EagerNcclS2SKernel<T> [with T=oneflow::float16]\" /home/zhongshanshan/workspace/f/oneflow/core/framework/op_kernel.h(332): here instantiation of \"oneflow::user_op::OpKernel *oneflow::user_op::NewOpKernel<T,Args...>(Args &&...) [with T=oneflow::EagerNcclS2SKernel<oneflow::float16>, Args=<>]\" /home/zhongshanshan/workspace/f/oneflow/core/framework/user_op_kernel_registry.h(84): here instantiation of \"oneflow::user_op::OpKernelRegistry &oneflow::user_op::OpKernelRegistry::SetCreateFn<T>() [with T=oneflow::EagerNcclS2SKernel<oneflow::float16>]\" (400): here /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(75): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclAllReduceKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(108): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclBroadcastKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(147): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclTouchKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(164): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclReduceKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(202): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclReduceScatterKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(244): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclAllGatherKernel\" [188/407] Building CUDA object CMakeFiles/oneflow.dir...core/ndarray/ndarray_apply_broadcast_binary_core.cu.o ninja: build stopped: subcommand failed. \u95ee\u98982 \u5982\u4f55\u8ba9\u540c\u4e00\u4e2a\u63a5\u53e3\u4f20\u5165int \u548c list\uff1f \u5728\u63a5\u53e3\u6587\u4ef6 yaml \u4e2d\u7528 Int32List[1] axis \u5373\u53ef\u540c\u65f6\u63a5\u6536 int \u548c list\u3002 \u5982\u4f55\u521d\u59cb\u5316\u4e00\u4e2a\u540c\u65f6\u63a5\u53d7int\u548clist\u7684\u63a5\u53e3\uff1f \u4f7f\u7528 Int32List[1] axis\uff0c\u5219\u65e0\u6cd5\u5728\u7f3a\u5931 axis \u7684\u60c5\u51b5\u4e0b\u76f4\u63a5\u8ba1\u7b97\u7ed3\u679c\u3002\u6211\u770b\u5230\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a Int32List[1] axis=None \u5199\u4e24\u4e2a\u63a5\u53e3\uff0c\u4f8b\u5982 signature: [ \"TensorTuple (Tensor input, Int32 indices_or_sections) => HsplitInt\", \"TensorTuple (Tensor input, Int32List indices_or_sections) => HsplitVec\", ] \u9009\u62e9 Int32List[1] axis=None\u65f6\uff0c /oneflow/core/functional/impl/nn_functor.cpp \u4f1a\u62a5\u9519\uff0c\u663e\u793a\u53c2\u6570\u4e0d\u5339\u914d\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8c03\u7528\u548c\u521d\u59cb\u5316\u4e86 ReduceSum\u3002\u5373\u4f7f\u5c06 nn_functor.cpp \u7684 axis \u4ece\u5f00\u59cb\u7684 {} \u5199\u6210 {NULL}\uff0c\u4ecd\u7136\u4f1a\u51fa\u73b0\u5947\u602a\u7684\u5176\u4ed6\u6587\u4ef6\u62a5\u9519\u3002\u4f46\u770b\u5230\u5176\u4ed6\u63a5\u53e3\u6709\u8fd9\u79cd\u7528\u6cd5\u3002\u4e3a\u4e86\u907f\u514d\u4fee\u6539\u5176\u4ed6\u6587\u4ef6\u5bfc\u81f4\u5176\u4ed6\u95ee\u9898\uff0c\u6700\u7ec8\u9009\u62e9\u5199\u4e24\u4e2a\u63a5\u53e3\u3002\u5199\u4e24\u4e2a\u63a5\u53e3\u540c\u6837\u5b58\u5728\u7455\u75b5\uff0c\u5373\u5728python tensor sum \u63a5\u53e3\u4e2d\u4e0d\u53ef\u4ee5\u4f7f\u7528 axis=None\uff0c\u5e94\u5f53\u4f7f\u7528 axis=[]\u3002 review \u7684\u65f6\u5019\u6709\u540c\u5b66\u5efa\u8bae\u540c\u7c7b\u4e2d\u5b9e\u73b0\u4e24\u6b21\u4e0d\u540c\u53c2\u6570\u7684 operator \uff0c\u4f46\u662f\u9605\u8bfb \u529f\u80fd\u63a5\u53e3 \u53d1\u73b0\u63a5\u53e3\u5fc5\u987b\u662f\u6b63\u4ea4\u7684\u3002 \u95ee\u98983 \u4f7f\u7528\u533f\u540d\u7a7a\u95f4\u5c01\u88c5\uff1a namespace { std::string exception_check(int32_t base, int32_t value, bool check_ge = true, bool check_le = true) { printf(\"%d, %d, %d, %d\\n\", base, value, check_ge, check_le); if (check_ge) { printf(\"ttt: %d, %d, %d, %d\\n\", base, value, check_ge, check_le); CHECK_GE_OR_RETURN(base, value) << \"Dimension out of range, expected to be in range of [\" << -base << \", \" << base - 1 << \"], but got \" << value; } if (check_le) { CHECK_LE_OR_RETURN(-base, value) << \"Dimension out of range, expected to be in range of [\" << -base << \", \" << base - 1 << \"], but got \" << value; } return \"\"; } } // namespace exception_check(naxis, axis[i]); \u62a5\u9519\u4fe1\u606f\u4e0d\u663e\u793a\u3002\u901a\u8fc7\u4e86\u89e3 OneFlow\u4e2d\u7684\u9519\u8bef\u5904\u7406\uff1aMaybe \u89e3\u51b3\u95ee\u9898\u3002","title":"\u4fee\u6539 reduce ops"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#reduce-ops","text":"reduce_ops.py \u91cc\u7684max\u3001min\u3001sum\u7b49\u64cd\u4f5c\u6539\u6210Functor\u76f4\u63a5\u5bfc\u51fa\u3002","title":"\u4fee\u6539 reduce ops"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#1","text":"ninja \u7a81\u7136\u51fa\u73b0\u7f16\u8bd1\u9519\u8bef\u95ee\u9898\uff0c\u91cd\u65b0clone\u4e4b\u540e\u5207\u6362\u5230\u5f53\u524d\u5206\u652f\u4e5f\u4f1a\u7f16\u8bd1\u62a5\u9519\uff0c\u6700\u7ec8\u5220\u9664\u5206\u652f\u91cd\u5efa\u3002 /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(275): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclS2SKernel<oneflow::float16>\" detected during: instantiation of class \"oneflow::EagerNcclS2SKernel<T> [with T=oneflow::float16]\" /home/zhongshanshan/workspace/f/oneflow/core/framework/op_kernel.h(332): here instantiation of \"oneflow::user_op::OpKernel *oneflow::user_op::NewOpKernel<T,Args...>(Args &&...) [with T=oneflow::EagerNcclS2SKernel<oneflow::float16>, Args=<>]\" /home/zhongshanshan/workspace/f/oneflow/core/framework/user_op_kernel_registry.h(84): here instantiation of \"oneflow::user_op::OpKernelRegistry &oneflow::user_op::OpKernelRegistry::SetCreateFn<T>() [with T=oneflow::EagerNcclS2SKernel<oneflow::float16>]\" (400): here /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(75): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclAllReduceKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(108): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclBroadcastKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(147): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclTouchKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(164): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclReduceKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(202): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclReduceScatterKernel\" /home/zhongshanshan/workspace/f/oneflow/user/kernels/eager_nccl_kernels.cu(244): warning: overloaded virtual function \"oneflow::user_op::OpKernel::Compute\" is only partially overridden in class \"oneflow::EagerNcclAllGatherKernel\" [188/407] Building CUDA object CMakeFiles/oneflow.dir...core/ndarray/ndarray_apply_broadcast_binary_core.cu.o ninja: build stopped: subcommand failed.","title":"\u95ee\u98981"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#2","text":"","title":"\u95ee\u98982"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#int-list","text":"\u5728\u63a5\u53e3\u6587\u4ef6 yaml \u4e2d\u7528 Int32List[1] axis \u5373\u53ef\u540c\u65f6\u63a5\u6536 int \u548c list\u3002","title":"\u5982\u4f55\u8ba9\u540c\u4e00\u4e2a\u63a5\u53e3\u4f20\u5165int \u548c list\uff1f"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#intlist","text":"\u4f7f\u7528 Int32List[1] axis\uff0c\u5219\u65e0\u6cd5\u5728\u7f3a\u5931 axis \u7684\u60c5\u51b5\u4e0b\u76f4\u63a5\u8ba1\u7b97\u7ed3\u679c\u3002\u6211\u770b\u5230\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a Int32List[1] axis=None \u5199\u4e24\u4e2a\u63a5\u53e3\uff0c\u4f8b\u5982 signature: [ \"TensorTuple (Tensor input, Int32 indices_or_sections) => HsplitInt\", \"TensorTuple (Tensor input, Int32List indices_or_sections) => HsplitVec\", ] \u9009\u62e9 Int32List[1] axis=None\u65f6\uff0c /oneflow/core/functional/impl/nn_functor.cpp \u4f1a\u62a5\u9519\uff0c\u663e\u793a\u53c2\u6570\u4e0d\u5339\u914d\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8c03\u7528\u548c\u521d\u59cb\u5316\u4e86 ReduceSum\u3002\u5373\u4f7f\u5c06 nn_functor.cpp \u7684 axis \u4ece\u5f00\u59cb\u7684 {} \u5199\u6210 {NULL}\uff0c\u4ecd\u7136\u4f1a\u51fa\u73b0\u5947\u602a\u7684\u5176\u4ed6\u6587\u4ef6\u62a5\u9519\u3002\u4f46\u770b\u5230\u5176\u4ed6\u63a5\u53e3\u6709\u8fd9\u79cd\u7528\u6cd5\u3002\u4e3a\u4e86\u907f\u514d\u4fee\u6539\u5176\u4ed6\u6587\u4ef6\u5bfc\u81f4\u5176\u4ed6\u95ee\u9898\uff0c\u6700\u7ec8\u9009\u62e9\u5199\u4e24\u4e2a\u63a5\u53e3\u3002\u5199\u4e24\u4e2a\u63a5\u53e3\u540c\u6837\u5b58\u5728\u7455\u75b5\uff0c\u5373\u5728python tensor sum \u63a5\u53e3\u4e2d\u4e0d\u53ef\u4ee5\u4f7f\u7528 axis=None\uff0c\u5e94\u5f53\u4f7f\u7528 axis=[]\u3002 review \u7684\u65f6\u5019\u6709\u540c\u5b66\u5efa\u8bae\u540c\u7c7b\u4e2d\u5b9e\u73b0\u4e24\u6b21\u4e0d\u540c\u53c2\u6570\u7684 operator \uff0c\u4f46\u662f\u9605\u8bfb \u529f\u80fd\u63a5\u53e3 \u53d1\u73b0\u63a5\u53e3\u5fc5\u987b\u662f\u6b63\u4ea4\u7684\u3002","title":"\u5982\u4f55\u521d\u59cb\u5316\u4e00\u4e2a\u540c\u65f6\u63a5\u53d7int\u548clist\u7684\u63a5\u53e3\uff1f"},{"location":"engineering/20220422-%E4%BF%AE%E6%94%B9reduce%20ops.html#3","text":"\u4f7f\u7528\u533f\u540d\u7a7a\u95f4\u5c01\u88c5\uff1a namespace { std::string exception_check(int32_t base, int32_t value, bool check_ge = true, bool check_le = true) { printf(\"%d, %d, %d, %d\\n\", base, value, check_ge, check_le); if (check_ge) { printf(\"ttt: %d, %d, %d, %d\\n\", base, value, check_ge, check_le); CHECK_GE_OR_RETURN(base, value) << \"Dimension out of range, expected to be in range of [\" << -base << \", \" << base - 1 << \"], but got \" << value; } if (check_le) { CHECK_LE_OR_RETURN(-base, value) << \"Dimension out of range, expected to be in range of [\" << -base << \", \" << base - 1 << \"], but got \" << value; } return \"\"; } } // namespace exception_check(naxis, axis[i]); \u62a5\u9519\u4fe1\u606f\u4e0d\u663e\u793a\u3002\u901a\u8fc7\u4e86\u89e3 OneFlow\u4e2d\u7684\u9519\u8bef\u5904\u7406\uff1aMaybe \u89e3\u51b3\u95ee\u9898\u3002","title":"\u95ee\u98983"},{"location":"engineering/20220429-magic%20method.html","text":"oneflow \u4e2d\u7684\u9b54\u672f\u65b9\u6cd5\u2014\u2014\u4ee5 __setitem__\u4e3a\u4f8b \u9b54\u672f\u65b9\u6cd5\uff0cpython\u4e2d\u6240\u6709\u4ee5\u201d__\u201d(\u53cc\u4e0b\u5212\u7ebf)\u4f5c\u4e3a\u540d\u5b57\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u65b9\u6cd5\u3002\u5177\u4f53\u4ecb\u7ecd\u89c1 Python \u9b54\u672f\u65b9\u6cd5\u6307\u5357 \u2014 PyCoder's Weelky CN \u3002 c++ class TensorSetItemFunctor { public: TensorSetItemFunctor() {} Maybe<void> operator()(const std::shared_ptr<one::Tensor>& x, const TensorIndex& index, const std::shared_ptr<one::Tensor>& value) const { std::vector<detail::Slice> slice_indices; TensorTuple tensor_indices; std::vector<int64_t> expand_dims; std::vector<int64_t> target_dims; JUST(PrepareSliceIndices(index, *(x->shape()), &slice_indices, &tensor_indices, &expand_dims, &target_dims)); if (expand_dims.size()) { slice_indices = *JUST(RemoveExpandDimSlice(slice_indices, expand_dims)); } int64_t ndims = x->shape()->NumAxes(); CHECK_EQ_OR_RETURN(slice_indices.size(), ndims) << Error::RuntimeError() << \"Failed to prepare slice indices.\"; // Not support combined indexing now if (!tensor_indices.empty()) { CHECK_OR_RETURN(tensor_indices.size() == ndims && std::all_of(tensor_indices.begin(), tensor_indices.end(), [](const std::shared_ptr<Tensor>& index) { return index; })) << Error::RuntimeError() << \"Combining indexing is not support for tensor setitem currently\"; } Shape target_shape(DimVector(target_dims.begin(), target_dims.end())); if (target_shape.Count(0) == 0) { return Maybe<void>::Ok(); } const auto& value_shape = value->shape(); bool matched = [&]() { for (int i = 0; i < value_shape->NumAxes() - target_shape.NumAxes(); ++i) { if (value_shape->At(i) != 1) { return false; } } return true; }(); CHECK_OR_RETURN(matched) << Error::RuntimeError() << \"The tensor size mismatch. Target sizes: \" << target_shape.ToString() << \", value sizes: \" << value_shape->ToString(); std::shared_ptr<one::Tensor> value_tensor(value); // TODO: replace reshape by unsqueeze with view mechanism. // after here, each scalar tensor will be one with one dimension. for (auto& tensor : tensor_indices) { if (tensor->ndim() == 0) { tensor = JUST(functional::Reshape(tensor, Shape({1}))); } } if (tensor_indices.size() == ndims) { // advance indexing std::shared_ptr<Tensor> indices = JUST(functional::Stack(tensor_indices, 0)); if (indices->shape()->elem_cnt() == 0) { return Maybe<void>::Ok(); } indices = JUST(functional::Transpose(indices, {1, 0})); value_tensor = JUST(functional::Expand(value_tensor, {indices->shape()->At(0)})); JUST(functional::TensorScatterNdUpdate(x, indices, value_tensor, /*inplace=*/true)); } else { // slice update if (target_shape.NumAxes() != 0 && // NOLINT /*need_expand=*/value_shape->Count(0) != target_shape.Count(0)) { // Remove the beginning redundant 1-dimensions. if (value_shape->NumAxes() > target_shape.NumAxes()) { int64_t start_axis = value_shape->NumAxes() - target_shape.NumAxes(); const auto& shape = JUST(value_shape->Slice(start_axis, value_shape->NumAxes())); value_tensor = JUST(Reshape(value, *shape)); } value_tensor = JUST(Expand(value_tensor, target_shape)); } std::vector<int64_t> start(ndims), end(ndims), step(ndims); DimVector slice_dims(ndims); for (int i = 0; i < ndims; ++i) { const auto& slice = slice_indices.at(i); start[i] = slice.start(); end[i] = slice.end(); step[i] = slice.step(); slice_dims[i] = (end[i] - start[i] + step[i] - 1) / step[i]; } Shape slice_shape(slice_dims); if (slice_shape != *(value_tensor->shape())) { value_tensor = JUST(Reshape(value_tensor, slice_shape)); } if (x->is_local()) { JUST(SliceUpdate(x, value_tensor, start, end, step, /*inplace=*/true)); } else { if (x->requires_grad() && autograd::GradMode::is_enabled()) { return Error::RuntimeError() << \"Backward is not support for consistent tensor setitem,\" \"please use oneflow.no_grad() to disable autograd \" \"currently. We will fix this problem soon.\"; } JUST(LogicalSliceAssign(x, value_tensor, start, end, step)); } } return Maybe<void>::Ok(); } }; ONEFLOW_FUNCTION_LIBRARY(m) { m.add_functor<impl::TensorSetItemFunctor>(\"TensorSetItem\"); } yaml - name: \"tensor_setitem\" signature: \"Void (Tensor x, TensorIndex index, Tensor value) => TensorSetItem\" bind_python: True python def _setitem(self, key, value): if self.is_global: if isinstance(value, (int, float)): value = flow._C.global_constant( [1], value, dtype=self.dtype, placement=self.placement, sbp=flow.sbp.broadcast, ) else: if value.is_global: value = value.to_global(sbp=flow.sbp.broadcast) # TODO: remove these lines after asymmetric boxing is ready local_tensor = value.to_local() if local_tensor.nelement() == 0: local_tensor = flow.zeros(*value.shape) value = local_tensor.to_global(self.placement, sbp=flow.sbp.broadcast) else: value = value.to_global(self.placement, sbp=flow.sbp.broadcast) else: if isinstance(value, (int, float)): value = flow._C.constant([1], value, dtype=self.dtype, device=self.device) else: value = value.to(device=self.device) flow._C.tensor_setitem(self, key, value) return self def RegisterMethods(): Tensor.__setitem__ = _setitem","title":"oneflow \u4e2d\u7684\u9b54\u672f\u65b9\u6cd5"},{"location":"engineering/20220429-magic%20method.html#oneflow-__setitem__","text":"\u9b54\u672f\u65b9\u6cd5\uff0cpython\u4e2d\u6240\u6709\u4ee5\u201d__\u201d(\u53cc\u4e0b\u5212\u7ebf)\u4f5c\u4e3a\u540d\u5b57\u5f00\u5934\u548c\u7ed3\u5c3e\u7684\u65b9\u6cd5\u3002\u5177\u4f53\u4ecb\u7ecd\u89c1 Python \u9b54\u672f\u65b9\u6cd5\u6307\u5357 \u2014 PyCoder's Weelky CN \u3002","title":"oneflow \u4e2d\u7684\u9b54\u672f\u65b9\u6cd5\u2014\u2014\u4ee5 \u000295\u0003_setitem__\u4e3a\u4f8b"},{"location":"engineering/20220429-magic%20method.html#c","text":"class TensorSetItemFunctor { public: TensorSetItemFunctor() {} Maybe<void> operator()(const std::shared_ptr<one::Tensor>& x, const TensorIndex& index, const std::shared_ptr<one::Tensor>& value) const { std::vector<detail::Slice> slice_indices; TensorTuple tensor_indices; std::vector<int64_t> expand_dims; std::vector<int64_t> target_dims; JUST(PrepareSliceIndices(index, *(x->shape()), &slice_indices, &tensor_indices, &expand_dims, &target_dims)); if (expand_dims.size()) { slice_indices = *JUST(RemoveExpandDimSlice(slice_indices, expand_dims)); } int64_t ndims = x->shape()->NumAxes(); CHECK_EQ_OR_RETURN(slice_indices.size(), ndims) << Error::RuntimeError() << \"Failed to prepare slice indices.\"; // Not support combined indexing now if (!tensor_indices.empty()) { CHECK_OR_RETURN(tensor_indices.size() == ndims && std::all_of(tensor_indices.begin(), tensor_indices.end(), [](const std::shared_ptr<Tensor>& index) { return index; })) << Error::RuntimeError() << \"Combining indexing is not support for tensor setitem currently\"; } Shape target_shape(DimVector(target_dims.begin(), target_dims.end())); if (target_shape.Count(0) == 0) { return Maybe<void>::Ok(); } const auto& value_shape = value->shape(); bool matched = [&]() { for (int i = 0; i < value_shape->NumAxes() - target_shape.NumAxes(); ++i) { if (value_shape->At(i) != 1) { return false; } } return true; }(); CHECK_OR_RETURN(matched) << Error::RuntimeError() << \"The tensor size mismatch. Target sizes: \" << target_shape.ToString() << \", value sizes: \" << value_shape->ToString(); std::shared_ptr<one::Tensor> value_tensor(value); // TODO: replace reshape by unsqueeze with view mechanism. // after here, each scalar tensor will be one with one dimension. for (auto& tensor : tensor_indices) { if (tensor->ndim() == 0) { tensor = JUST(functional::Reshape(tensor, Shape({1}))); } } if (tensor_indices.size() == ndims) { // advance indexing std::shared_ptr<Tensor> indices = JUST(functional::Stack(tensor_indices, 0)); if (indices->shape()->elem_cnt() == 0) { return Maybe<void>::Ok(); } indices = JUST(functional::Transpose(indices, {1, 0})); value_tensor = JUST(functional::Expand(value_tensor, {indices->shape()->At(0)})); JUST(functional::TensorScatterNdUpdate(x, indices, value_tensor, /*inplace=*/true)); } else { // slice update if (target_shape.NumAxes() != 0 && // NOLINT /*need_expand=*/value_shape->Count(0) != target_shape.Count(0)) { // Remove the beginning redundant 1-dimensions. if (value_shape->NumAxes() > target_shape.NumAxes()) { int64_t start_axis = value_shape->NumAxes() - target_shape.NumAxes(); const auto& shape = JUST(value_shape->Slice(start_axis, value_shape->NumAxes())); value_tensor = JUST(Reshape(value, *shape)); } value_tensor = JUST(Expand(value_tensor, target_shape)); } std::vector<int64_t> start(ndims), end(ndims), step(ndims); DimVector slice_dims(ndims); for (int i = 0; i < ndims; ++i) { const auto& slice = slice_indices.at(i); start[i] = slice.start(); end[i] = slice.end(); step[i] = slice.step(); slice_dims[i] = (end[i] - start[i] + step[i] - 1) / step[i]; } Shape slice_shape(slice_dims); if (slice_shape != *(value_tensor->shape())) { value_tensor = JUST(Reshape(value_tensor, slice_shape)); } if (x->is_local()) { JUST(SliceUpdate(x, value_tensor, start, end, step, /*inplace=*/true)); } else { if (x->requires_grad() && autograd::GradMode::is_enabled()) { return Error::RuntimeError() << \"Backward is not support for consistent tensor setitem,\" \"please use oneflow.no_grad() to disable autograd \" \"currently. We will fix this problem soon.\"; } JUST(LogicalSliceAssign(x, value_tensor, start, end, step)); } } return Maybe<void>::Ok(); } }; ONEFLOW_FUNCTION_LIBRARY(m) { m.add_functor<impl::TensorSetItemFunctor>(\"TensorSetItem\"); }","title":"c++"},{"location":"engineering/20220429-magic%20method.html#yaml","text":"- name: \"tensor_setitem\" signature: \"Void (Tensor x, TensorIndex index, Tensor value) => TensorSetItem\" bind_python: True","title":"yaml"},{"location":"engineering/20220429-magic%20method.html#python","text":"def _setitem(self, key, value): if self.is_global: if isinstance(value, (int, float)): value = flow._C.global_constant( [1], value, dtype=self.dtype, placement=self.placement, sbp=flow.sbp.broadcast, ) else: if value.is_global: value = value.to_global(sbp=flow.sbp.broadcast) # TODO: remove these lines after asymmetric boxing is ready local_tensor = value.to_local() if local_tensor.nelement() == 0: local_tensor = flow.zeros(*value.shape) value = local_tensor.to_global(self.placement, sbp=flow.sbp.broadcast) else: value = value.to_global(self.placement, sbp=flow.sbp.broadcast) else: if isinstance(value, (int, float)): value = flow._C.constant([1], value, dtype=self.dtype, device=self.device) else: value = value.to(device=self.device) flow._C.tensor_setitem(self, key, value) return self def RegisterMethods(): Tensor.__setitem__ = _setitem","title":"python"},{"location":"engineering/20220507-Fix%20upsample%20shape%20infer%20bug.html","text":"Fix upsample shape infer bug \u901a\u8fc7\u8fd9\u4e2aPR\u7406\u89e3 \u5982\u4f55\u5728OneFlow\u4e2d\u65b0\u589eUser Op \u3002 \u6d41\u7a0b \u5b9a\u4e49op\uff1aoneflow/ir/include/OneFlow/OneFlowUserOps.td \u5b9e\u73b0op\uff1aoneflow/user/ops/upsample_op.cpp \u5b9e\u73b0\u652f\u6301op\u8ba1\u7b97\u7684CPU\u548cGPU\u903b\u8f91\uff1a CPU: oneflow/user/kernels/*.cpp GPU: oneflow/user/kernels/*.cu \u6ce8\u518cFunctional\u63a5\u53e3\uff1a oneflow/core/functional/impl/array_functor.cpp oneflow/core/functional/functional_api.yaml \u5b9e\u73b0\u6c42\u5bfc\u903b\u8f91\uff1aoneflow/core/autograd/gradient_funcs/upsample.cpp \u5b9e\u73b0python\u63a5\u53e3\uff1apython/oneflow/nn/modules/interpolate.py \u5b8c\u6210\u6d4b\u8bd5\uff1apython/oneflow/test/modules/test_upsample.py \u95ee\u9898\u603b\u7ed3 \u6ca1\u6709\u68b3\u7406\u903b\u8f91\u5bfc\u81f4\u6709\u4e9b\u6587\u4ef6\u6ca1\u6709\u6539\u5168\uff0c\u4f8b\u5982td\u6587\u4ef6\u6ca1\u6709\u589e\u52a0\u53c2\u6570\u4f1a\u5bfc\u81f4core dump\u95ee\u9898 scale\u539f\u59cb\u7c7b\u578b\u4e3afloat\uff0c\u7531\u4e8e\u90e8\u5206upsample\u5bf9\u53c2\u6570\u7cbe\u5ea6\u654f\u611f\uff0c\u9700\u8981\u5c06scale\u6539\u4e3adouble","title":"Fix upsample shape infer bug"},{"location":"engineering/20220507-Fix%20upsample%20shape%20infer%20bug.html#fix-upsample-shape-infer-bug","text":"\u901a\u8fc7\u8fd9\u4e2aPR\u7406\u89e3 \u5982\u4f55\u5728OneFlow\u4e2d\u65b0\u589eUser Op \u3002","title":"Fix upsample shape infer bug"},{"location":"engineering/20220507-Fix%20upsample%20shape%20infer%20bug.html#_1","text":"\u5b9a\u4e49op\uff1aoneflow/ir/include/OneFlow/OneFlowUserOps.td \u5b9e\u73b0op\uff1aoneflow/user/ops/upsample_op.cpp \u5b9e\u73b0\u652f\u6301op\u8ba1\u7b97\u7684CPU\u548cGPU\u903b\u8f91\uff1a CPU: oneflow/user/kernels/*.cpp GPU: oneflow/user/kernels/*.cu \u6ce8\u518cFunctional\u63a5\u53e3\uff1a oneflow/core/functional/impl/array_functor.cpp oneflow/core/functional/functional_api.yaml \u5b9e\u73b0\u6c42\u5bfc\u903b\u8f91\uff1aoneflow/core/autograd/gradient_funcs/upsample.cpp \u5b9e\u73b0python\u63a5\u53e3\uff1apython/oneflow/nn/modules/interpolate.py \u5b8c\u6210\u6d4b\u8bd5\uff1apython/oneflow/test/modules/test_upsample.py","title":"\u6d41\u7a0b"},{"location":"engineering/20220507-Fix%20upsample%20shape%20infer%20bug.html#_2","text":"\u6ca1\u6709\u68b3\u7406\u903b\u8f91\u5bfc\u81f4\u6709\u4e9b\u6587\u4ef6\u6ca1\u6709\u6539\u5168\uff0c\u4f8b\u5982td\u6587\u4ef6\u6ca1\u6709\u589e\u52a0\u53c2\u6570\u4f1a\u5bfc\u81f4core dump\u95ee\u9898 scale\u539f\u59cb\u7c7b\u578b\u4e3afloat\uff0c\u7531\u4e8e\u90e8\u5206upsample\u5bf9\u53c2\u6570\u7cbe\u5ea6\u654f\u611f\uff0c\u9700\u8981\u5c06scale\u6539\u4e3adouble","title":"\u95ee\u9898\u603b\u7ed3"},{"location":"engineering/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html","text":"\u6280\u5de7\u603b\u7ed3 \u5f00\u53d1\u5fc5\u770b \u4f7f\u7528 VS Code \u5f00\u53d1\u548c\u8c03\u8bd5 OneFlow \uff0c\u53ef\u642d\u914d VSCode debug \u5de5\u5177 \u4e00\u8d77\u98df\u7528 howto_write_api_doc \uff0c\u5f3a\u8c03\uff1amake html \u524d pip requirements Functional Interface \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1 \u5982\u4f55\u5728OneFlow\u4e2d\u65b0\u589eUser Op \u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u5e76\u884c\u7b56\u7565 \u7cfb\u5217 \u9519\u8bef\u5904\u7406\uff1aMaybe OneFlow \u73af\u5883\u53d8\u91cf OneFlow inplace \u7b97\u5b50\u5f00\u53d1\u6307\u5357 \u5de5\u5177\u6587\u6863 OneFlow Document Index \u6280\u5de7 \u67e5\u770b\u6587\u6863\uff0c\u5982\u67e5\u770b nn.functional.conv2d \u7684\u6587\u6863\uff0c\u53ef\u4ee5\u901a\u8fc7 nn.functional.conv2d.__doc__ \u6d4b\u8bd5\u6837\u4f8b\u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3aci\u4f1a\u591a\u8fdb\u7a0b\u8dd1\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u6837\u4f8b\u7684\u5185\u5b58\u4e0d\u80fd\u592a\u5927\uff0c\u4e0d\u7136\u53ef\u80fd\u5c31oom\u4e86 yaml \u4e2d list \u7684\u521d\u59cb\u5316\u9700\u8981\u6839\u636e \u7ef4\u5ea6 \u800c\u5b9a\uff0c\u5982 Int32List[3] dilation=1 \u5bf9\u4e8e 3d\uff0c Int32List[2] dilation=1 \u5bf9\u4e8e 2d \u5982\u679c\u5728\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u4f7f\u7528\u4efb\u4f55\u53cd\u659c\u6760\u8f6c\u4e49\uff0c\u90a3\u4e48\u9700\u8981\u7528 r\"\"\"your raw docstring\"\"\" doc \u89c4\u5b9a\u6587\u6863\u5b57\u7b26\u4e32\u7684\u4ee3\u7801\u8981\u6709\u4e2a\u53d8\u91cf\u63a5\u6536\u7ed3\u679c outputs = F.conv1d(inputs, filters) \u6216\u8005\u76f4\u63a5 F.conv1d(inputs, filters) \u5e76\u9644\u5e26\u4e0a\u8fd0\u884c\u7ed3\u679c\u3002\u53ef\u4ee5\u8fd0\u884c ./python/oneflow/test/modules/test_functional_docstr.py \u6765\u68c0\u67e5\u6587\u6863\u662f\u5426\u6709\u95ee\u9898 \u901a\u8fc7 import oneflow as flow; flow; \u67e5\u770b\u5305\u4f4d\u7f6e","title":"\u6280\u5de7\u603b\u7ed3"},{"location":"engineering/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html#_1","text":"","title":"\u6280\u5de7\u603b\u7ed3"},{"location":"engineering/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html#_2","text":"\u4f7f\u7528 VS Code \u5f00\u53d1\u548c\u8c03\u8bd5 OneFlow \uff0c\u53ef\u642d\u914d VSCode debug \u5de5\u5177 \u4e00\u8d77\u98df\u7528 howto_write_api_doc \uff0c\u5f3a\u8c03\uff1amake html \u524d pip requirements Functional Interface \u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u5982\u4f55\u4f18\u96c5\u7684\u505a\u7b97\u5b50\u5bf9\u9f50\u4efb\u52a1 \u5982\u4f55\u5728OneFlow\u4e2d\u65b0\u589eUser Op \u5e38\u89c1\u7684\u5206\u5e03\u5f0f\u5e76\u884c\u7b56\u7565 \u7cfb\u5217 \u9519\u8bef\u5904\u7406\uff1aMaybe OneFlow \u73af\u5883\u53d8\u91cf OneFlow inplace \u7b97\u5b50\u5f00\u53d1\u6307\u5357","title":"\u5f00\u53d1\u5fc5\u770b"},{"location":"engineering/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html#_3","text":"OneFlow Document Index","title":"\u5de5\u5177\u6587\u6863"},{"location":"engineering/%E6%8A%80%E5%B7%A7%E6%80%BB%E7%BB%93.html#_4","text":"\u67e5\u770b\u6587\u6863\uff0c\u5982\u67e5\u770b nn.functional.conv2d \u7684\u6587\u6863\uff0c\u53ef\u4ee5\u901a\u8fc7 nn.functional.conv2d.__doc__ \u6d4b\u8bd5\u6837\u4f8b\u4e0d\u5b9c\u8fc7\u5927\uff0c\u56e0\u4e3aci\u4f1a\u591a\u8fdb\u7a0b\u8dd1\u6d4b\u8bd5\uff0c\u6bcf\u4e2a\u6837\u4f8b\u7684\u5185\u5b58\u4e0d\u80fd\u592a\u5927\uff0c\u4e0d\u7136\u53ef\u80fd\u5c31oom\u4e86 yaml \u4e2d list \u7684\u521d\u59cb\u5316\u9700\u8981\u6839\u636e \u7ef4\u5ea6 \u800c\u5b9a\uff0c\u5982 Int32List[3] dilation=1 \u5bf9\u4e8e 3d\uff0c Int32List[2] dilation=1 \u5bf9\u4e8e 2d \u5982\u679c\u5728\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u4f7f\u7528\u4efb\u4f55\u53cd\u659c\u6760\u8f6c\u4e49\uff0c\u90a3\u4e48\u9700\u8981\u7528 r\"\"\"your raw docstring\"\"\" doc \u89c4\u5b9a\u6587\u6863\u5b57\u7b26\u4e32\u7684\u4ee3\u7801\u8981\u6709\u4e2a\u53d8\u91cf\u63a5\u6536\u7ed3\u679c outputs = F.conv1d(inputs, filters) \u6216\u8005\u76f4\u63a5 F.conv1d(inputs, filters) \u5e76\u9644\u5e26\u4e0a\u8fd0\u884c\u7ed3\u679c\u3002\u53ef\u4ee5\u8fd0\u884c ./python/oneflow/test/modules/test_functional_docstr.py \u6765\u68c0\u67e5\u6587\u6863\u662f\u5426\u6709\u95ee\u9898 \u901a\u8fc7 import oneflow as flow; flow; \u67e5\u770b\u5305\u4f4d\u7f6e","title":"\u6280\u5de7"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html","text":"Flask \u52a0\u8f7d\u4e0d\u51fa js \u7b49\u9759\u6001\u6587\u4ef6 \u8fd9\u4e2a\u95ee\u9898\u4e00\u5171\u51fa\u73b0\u4e86\u4e24\u6b21\uff1a \u6d4b\u8bd5\uff1a\u5728\u4e91\u5e73\u53f0\u670d\u52a1\u5668\u4e0a\u7684 localhost \u7aef\u53e3\u6d4b\u8bd5\u7684\u65f6\u5019 \u90e8\u7f72\uff1a\u90e8\u7f72\u5230\u4e91\u5e73\u53f0\u4e0a\u7684 API \u7684\u65f6\u5019 \u6d4b\u8bd5 \u95ee\u9898\u63cf\u8ff0 \u5f53\u524d\u6587\u4ef6\u5939\u76ee\u5f55\u5982\u4e0b\uff1a . |-- templates |-- index.css `-- index.html `-- server.py \u8fd0\u884c server.py \u8fd9\u4e2a\u6587\u4ef6\uff0c\u4f7f\u7528 Flask \u7684 render_template(\"index.html\", base_dir=base_dir) \u5c06 index.html \u52a0\u8f7d\u51fa\u6765\uff0c\u4f1a\u53d1\u73b0\u5728 index.html \u4e2d\u5f15\u7528\u7684 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u52a0\u8f7d\u4e0d\u51fa\u6765\uff0c\u5373\u62a5 404 \u9519\u8bef\uff0c\u627e\u4e0d\u5230\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1 - - [17/Mar/2022 09:34:53] \"GET /index.css HTTP/1.1\" 404 - \u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u76f4\u63a5\u6253\u5f00 index.html \u662f\u6b63\u5e38\u7684\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u6d4f\u89c8\u5668\u6253\u5f00 index.html \u65f6\uff0c\u5e76\u6ca1\u6709\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\uff0c\u6d4f\u89c8\u5668\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u5177\u4f1a\u6839\u636e\u672c\u5730\u6587\u4ef6\u4e2d\u7684\u201c\u76f8\u5bf9\u94fe\u63a5\u201d\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u8fdb\u884c\u641c\u7d22\u3002\u800c\u5f53\u4f7f\u7528 Flask \u542f\u52a8\u9879\u76ee\u4e4b\u540e\uff0c\u7a0b\u5e8f\u662f\u4e00\u4e2a Browser/Server \u7684\u67b6\u6784\u3002\u7528\u6237\u8bbf\u95ee\u67d0\u4e2a\u9875\u9762\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u62ff\u5230\u6240\u6709\u7684\u4fe1\u606f\uff0c\u800c\u662f\u901a\u8fc7\u82e5\u5e72\u6b21\u53d1\u5305\u548c\u5f97\u5230\u56de\u590d\u5305\uff0c\u518d\u5c06\u7ed3\u679c\u6e32\u67d3\u5230\u672c\u5730\u6d4f\u89c8\u5668\u4e0a\u3002\u4ee5\u672c\u6b21\u62a5\u9519\u4e3a\u4f8b\uff0c\u6d4f\u89c8\u5668\u901a\u8fc7\u5730\u5740\u8bf7\u6c42\u5230 index.html \uff0c\u968f\u540e\u901a\u8fc7\u89e3\u6790 index.html \uff0c\u53d1\u73b0\u7f3a\u5c11 index.css \u6587\u4ef6\uff0c\u6d4f\u89c8\u5668\u7ee7\u7eed\u53d1\u9001\u8bf7\u6c42\uff0c\u83b7\u53d6 index.css \u6587\u4ef6\uff0c\u6b64\u65f6\u6d4f\u89c8\u5668\u7684\u8bf7\u6c42\u8def\u5f84\u4ece index.html \u4e2d\u83b7\u5f97\uff0c\u6240\u4ee5\u5982\u679c index.html \u4e2d\u5199\u7684\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u5373 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \uff0c\u90a3\u4e48\u6d4f\u89c8\u5668\u5c06\u4f1a\u5728\u670d\u52a1\u5668\u7684 home \u76ee\u5f55\u4e0b\u627e index.css \u6587\u4ef6\uff0c\u663e\u7136\u662f\u627e\u4e0d\u5230\u7684\uff0c\u56e0\u4e3a\u76f8\u5bf9\u4e8e home \u76ee\u5f55\uff0c\u6b64\u65f6 index.css \u7684\u8def\u5f84\u662f /templates/index.css \u800c\u4e0d\u662f /index.css \u3002 \u89e3\u51b3\u65b9\u6cd5 \u66b4\u529b\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u5c06 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u4fee\u6539\u6210 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/templates/index.css\"> \uff0c\u4f46\u662f\u8003\u8651\u5230\u6587\u4ef6\u5939\u7684\u6709\u5e8f\u6027\uff0c\u66f4\u63a8\u8350\u5982\u4e0b\u505a\u6cd5\u3002 \u521b\u5efa\u9759\u6001\u6587\u4ef6\u5939 static \uff0c\u5c06 index.css \u79fb\u5230 static \u4e0b\uff0c\u5373 . |-- static `-- index.css |-- templates `-- index.html `-- server.py \u5e76\u5c06 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u66ff\u6362\u6210 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/static/index.css\"> \u3002 \u66f4\u591a\uff1a\u5173\u4e8e Flask \u9ed8\u8ba4\u9759\u6001\u6587\u4ef6\u5939\uff0c\u53ef\u53c2\u8003 Flask \u4e2d\u6587\u6587\u6863 (2.0.2) \u3002 \u90e8\u7f72 \u5f53\u5c06\u9879\u76ee\u90e8\u7f72\u5230\u4e91\u5e73\u53f0\u65f6\uff0c\u5373 Fork \u9879\u76ee\u4e4b\u540e\u90e8\u7f72\u5728\u7ebf\u63a8\u7406\uff0c\u8fd0\u884c\u90e8\u7f72\u597d\u7684\u9879\u76ee\uff0c\u6211\u4eec\u4f1a\u83b7\u5f97\u5230\u4e00\u4e2a\u5916\u7f51\u53ef\u4ee5\u8bbf\u95ee\u7684 API \u5730\u5740\uff0c\u4ee5\u5b9e\u73b0\u5feb\u901f\u90e8\u7f72\u548c\u8bbf\u95ee\u6211\u4eec\u5728\u4e91\u670d\u52a1\u5668\u4e0a\u6d4b\u8bd5\u7684\u6a21\u578b\u3002\u8fd9\u4e2a API \u5730\u5740\u9ed8\u8ba4\u683c\u5f0f\u4e3a https://gateway.platform.oneflow.cloud/serving/{id}/v1/index \u3002 \u9996\u5148\u6ce8\u610f\u5230 serving/{id}/ \u8fd9\u90e8\u5206\uff0c\u53ef\u4ee5\u79f0\u4e4b\u4e3a \u54c8\u5e0c\u503c \uff0c\u5b83\u7684\u5b58\u5728\u662f\u56e0\u4e3a\u4e91\u5e73\u53f0\u90e8\u7f72\u7684\u8def\u7531\u5206\u4e24\u5c42\uff1a \u7528\u6237\u8bf7\u6c42\u53d1\u9001\u5230 flow \u7684\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u7b2c\u4e00\u5c42\u7f51\u5173\u901a\u8fc7\u5206\u6790 url \u7684\u54c8\u5e0c\u503c\u6765\u786e\u5b9a\u9879\u76ee\u6765\u6e90\uff0c\u4e5f\u5373\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u5668\uff1b \u786e\u5b9a\u9879\u76ee\u6765\u6e90\u4e4b\u540e\uff0c\u6839\u636e\u5176\u540e\u7684\u540e\u7f00 v1/index \u5230\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u5bf9\u5e94\u7684\u670d\u52a1 \u54c8\u5e0c\u503c\u7684\u5b58\u5728\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\uff1a \u95ee\u9898\u4e00\uff1a\u8be5 API \u5730\u5740\u5230\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u670d\u52a1\u65f6\uff0c @app.route \u662f serving/{id}/v1/index \uff1b \u95ee\u9898\u4e8c\uff1a\u8bf7\u6c42\u9759\u6001\u6587\u4ef6\u65f6\uff0c\u76f8\u5bf9\u4e8e\u5177\u4f53\u670d\u52a1\u5668\u800c\u8a00\uff0c Flask(__name__) \u9ed8\u8ba4\u9759\u6001\u6587\u4ef6\u5939\u76ee\u5f55\u4e3a /static \uff0c\u5f53\u8bf7\u6c42 /static/index.css \u65f6\u5e94\u5f53\u53d1\u9001 /static/index.css \uff0c\u4f46\u662f\u4e91\u5e73\u53f0\u53d1\u9001\u9759\u6001\u6587\u4ef6\u8bf7\u6c42\u65f6\u7684 url \u4e3a /serving/{id}/static/index.css \u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf BASE_DIR \u7684\u5f62\u5f0f\u628a\u54c8\u5e0c\u524d\u7f00\u4f20\u5230\u670d\u52a1\u7aef\u4ee3\u7801\u4ee5\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u4ee3\u7801\u793a\u4f8b\uff1a import os from flask import Flask, render_template base_dir = os.environ.get(\"BASE_DIR\", \"\") app = Flask(__name__, static_url_path=base_dir+'/static') # \u89e3\u51b3\u95ee\u9898\u4e8c @app.route(f\"{base_dir}/v1/index\", methods=[\"GET\"]) # \u89e3\u51b3\u95ee\u9898\u4e00 def home(): return render_template(\"index.html\", base_dir=base_dir) # \u89e3\u51b3\u95ee\u9898\u4e8c if __name__ == \"__main__\": app.run(\"0.0.0.0\") \u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u53c2\u6570 base_dir \uff0cFlask \u5c06 base_dir \u4f20\u5230 @app.route \u3001 static_url_path \u3001 html \u6587\u4ef6 \u4e2d\u3002\u8fd9\u4e2a\u53c2\u6570\u7684\u5b9a\u4e49\u4e3a\uff1a \u5f53\u5b58\u5728 BASE_DIR \u65f6\uff0c\u5373\u5728\u4e91\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u65f6\uff0c\u83b7\u53d6\u5230 BASE_DIR \u5373\u4e0a\u6587\u6240\u8bf4\u7684 serving/{id}/ \u5426\u5219 base_dir \u8bbe\u7f6e\u4e3a\u7a7a base_dir \u5728 html \u6587\u4ef6\u7684\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/static/css/index.css\"> \u6b64\u5904\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u9488\u5bf9\u95ee\u9898\u4e8c\uff0c\u6211\u4eec\u4e0d\u4ec5\u5c06 static_url_path \u503c\u66f4\u6539\u4e86\uff0c\u8fd8\u5c06 html \u4e2d\u7684\u8bf7\u6c42\u8def\u5f84\uff08\u5982 href \uff09\u66f4\u6539\u4e86\uff0c\u90a3\u4e0d\u540c\u65f6\u66f4\u6539\u8fd9\u4e24\u4e2a\u8def\u5f84\u4e0d\u4e5f\u80fd\u5bf9\u5e94\u4e0a\u9759\u6001\u6587\u4ef6\u5417\uff1f\u5176\u5b9e\u662f\u4e0d\u53ef\u4ee5\u7684\u3002\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u901a\u8fc7\u54c8\u5e0c\u503c\u5b9a\u4f4d\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u5668\uff0c\u5373\u5b9e\u73b0\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u6240\u4ee5\u54c8\u5e0c\u503c\u662f\u5fc5\u987b\u5b58\u5728\u7684\uff0c href \u5fc5\u987b\u5e26\u4e0a\u54c8\u5e0c\u524d\u7f00\u624d\u80fd\u5b9e\u73b0\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u800c\u6b63\u662f\u7531\u4e8e href \u5e26\u6709\u54c8\u5e0c\u524d\u7f00\uff0c\u56e0\u6b64\u9700\u8981\u66f4\u6539 static_url_path \u3002 \u6700\u540e\uff0c\u6ce8\u610f\u8fd9\u4e2a API \u9ed8\u8ba4\u683c\u5f0f\u4e3a https://gateway.platform.oneflow.cloud/serving/{id}/v1/index \uff0c\u8fd9\u610f\u5473\u7740\u5728 Flask \u6a21\u5757\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6211\u4eec\u60f3\u88ab\u8bbf\u95ee\u5230\u7684\u9875\u9762\u8bbe\u7f6e\u4e3a @app.route(f\"{base_dir}/v1/index\", \u2026\u2026) \uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bf9\u7528\u6237\u4ea7\u751f\u56f0\u6270\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49 url\u3002\u4f8b\u5982\u5982\u679c\u4f60\u6dfb\u52a0\u4e86\u9875\u9762 A \u5230 @app.route(f\"{base_dir}/\", \u2026\u2026) \uff0c\u76f4\u63a5\u8bbf\u95ee https://gateway.platform.oneflow.cloud/serving/{id} \u53ef\u4ee5\u5f97\u5230\u9875\u9762 A\u3002 \u66f4\u591a\uff1a\u5173\u4e8e static_url_path \uff0c\u53ef\u53c2\u8003 Flask \u521b\u5efaapp \u65f6\u5019\u4f20\u5165\u7684 static_folder \u548c static_url_path\u53c2\u6570\u7406\u89e3","title":"Flask \u52a0\u8f7d\u4e0d\u51fa js \u7b49\u9759\u6001\u6587\u4ef6"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html#flask-js","text":"\u8fd9\u4e2a\u95ee\u9898\u4e00\u5171\u51fa\u73b0\u4e86\u4e24\u6b21\uff1a \u6d4b\u8bd5\uff1a\u5728\u4e91\u5e73\u53f0\u670d\u52a1\u5668\u4e0a\u7684 localhost \u7aef\u53e3\u6d4b\u8bd5\u7684\u65f6\u5019 \u90e8\u7f72\uff1a\u90e8\u7f72\u5230\u4e91\u5e73\u53f0\u4e0a\u7684 API \u7684\u65f6\u5019","title":"Flask \u52a0\u8f7d\u4e0d\u51fa js \u7b49\u9759\u6001\u6587\u4ef6"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html#_1","text":"","title":"\u6d4b\u8bd5"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html#_2","text":"\u5f53\u524d\u6587\u4ef6\u5939\u76ee\u5f55\u5982\u4e0b\uff1a . |-- templates |-- index.css `-- index.html `-- server.py \u8fd0\u884c server.py \u8fd9\u4e2a\u6587\u4ef6\uff0c\u4f7f\u7528 Flask \u7684 render_template(\"index.html\", base_dir=base_dir) \u5c06 index.html \u52a0\u8f7d\u51fa\u6765\uff0c\u4f1a\u53d1\u73b0\u5728 index.html \u4e2d\u5f15\u7528\u7684 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u52a0\u8f7d\u4e0d\u51fa\u6765\uff0c\u5373\u62a5 404 \u9519\u8bef\uff0c\u627e\u4e0d\u5230\u6587\u4ef6\uff0c\u5982\u4e0b\u6240\u793a\uff1a 127.0.0.1 - - [17/Mar/2022 09:34:53] \"GET /index.css HTTP/1.1\" 404 - \u4f46\u662f\u4f7f\u7528\u6d4f\u89c8\u5668\u76f4\u63a5\u6253\u5f00 index.html \u662f\u6b63\u5e38\u7684\u3002\u8fd9\u662f\u56e0\u4e3a\u5f53\u6211\u4eec\u76f4\u63a5\u4f7f\u7528\u6d4f\u89c8\u5668\u6253\u5f00 index.html \u65f6\uff0c\u5e76\u6ca1\u6709\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\uff0c\u6d4f\u89c8\u5668\u4f5c\u4e3a\u4e00\u4e2a\u5de5\u5177\u4f1a\u6839\u636e\u672c\u5730\u6587\u4ef6\u4e2d\u7684\u201c\u76f8\u5bf9\u94fe\u63a5\u201d\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u8fdb\u884c\u641c\u7d22\u3002\u800c\u5f53\u4f7f\u7528 Flask \u542f\u52a8\u9879\u76ee\u4e4b\u540e\uff0c\u7a0b\u5e8f\u662f\u4e00\u4e2a Browser/Server \u7684\u67b6\u6784\u3002\u7528\u6237\u8bbf\u95ee\u67d0\u4e2a\u9875\u9762\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u62ff\u5230\u6240\u6709\u7684\u4fe1\u606f\uff0c\u800c\u662f\u901a\u8fc7\u82e5\u5e72\u6b21\u53d1\u5305\u548c\u5f97\u5230\u56de\u590d\u5305\uff0c\u518d\u5c06\u7ed3\u679c\u6e32\u67d3\u5230\u672c\u5730\u6d4f\u89c8\u5668\u4e0a\u3002\u4ee5\u672c\u6b21\u62a5\u9519\u4e3a\u4f8b\uff0c\u6d4f\u89c8\u5668\u901a\u8fc7\u5730\u5740\u8bf7\u6c42\u5230 index.html \uff0c\u968f\u540e\u901a\u8fc7\u89e3\u6790 index.html \uff0c\u53d1\u73b0\u7f3a\u5c11 index.css \u6587\u4ef6\uff0c\u6d4f\u89c8\u5668\u7ee7\u7eed\u53d1\u9001\u8bf7\u6c42\uff0c\u83b7\u53d6 index.css \u6587\u4ef6\uff0c\u6b64\u65f6\u6d4f\u89c8\u5668\u7684\u8bf7\u6c42\u8def\u5f84\u4ece index.html \u4e2d\u83b7\u5f97\uff0c\u6240\u4ee5\u5982\u679c index.html \u4e2d\u5199\u7684\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u5373 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \uff0c\u90a3\u4e48\u6d4f\u89c8\u5668\u5c06\u4f1a\u5728\u670d\u52a1\u5668\u7684 home \u76ee\u5f55\u4e0b\u627e index.css \u6587\u4ef6\uff0c\u663e\u7136\u662f\u627e\u4e0d\u5230\u7684\uff0c\u56e0\u4e3a\u76f8\u5bf9\u4e8e home \u76ee\u5f55\uff0c\u6b64\u65f6 index.css \u7684\u8def\u5f84\u662f /templates/index.css \u800c\u4e0d\u662f /index.css \u3002","title":"\u95ee\u9898\u63cf\u8ff0"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html#_3","text":"\u66b4\u529b\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u5c06 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u4fee\u6539\u6210 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/templates/index.css\"> \uff0c\u4f46\u662f\u8003\u8651\u5230\u6587\u4ef6\u5939\u7684\u6709\u5e8f\u6027\uff0c\u66f4\u63a8\u8350\u5982\u4e0b\u505a\u6cd5\u3002 \u521b\u5efa\u9759\u6001\u6587\u4ef6\u5939 static \uff0c\u5c06 index.css \u79fb\u5230 static \u4e0b\uff0c\u5373 . |-- static `-- index.css |-- templates `-- index.html `-- server.py \u5e76\u5c06 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/index.css\"> \u66ff\u6362\u6210 <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/static/index.css\"> \u3002 \u66f4\u591a\uff1a\u5173\u4e8e Flask \u9ed8\u8ba4\u9759\u6001\u6587\u4ef6\u5939\uff0c\u53ef\u53c2\u8003 Flask \u4e2d\u6587\u6587\u6863 (2.0.2) \u3002","title":"\u89e3\u51b3\u65b9\u6cd5"},{"location":"onecloud/20220322-Flask%20%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%87%BA%20js%20%E7%AD%89%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6.html#_4","text":"\u5f53\u5c06\u9879\u76ee\u90e8\u7f72\u5230\u4e91\u5e73\u53f0\u65f6\uff0c\u5373 Fork \u9879\u76ee\u4e4b\u540e\u90e8\u7f72\u5728\u7ebf\u63a8\u7406\uff0c\u8fd0\u884c\u90e8\u7f72\u597d\u7684\u9879\u76ee\uff0c\u6211\u4eec\u4f1a\u83b7\u5f97\u5230\u4e00\u4e2a\u5916\u7f51\u53ef\u4ee5\u8bbf\u95ee\u7684 API \u5730\u5740\uff0c\u4ee5\u5b9e\u73b0\u5feb\u901f\u90e8\u7f72\u548c\u8bbf\u95ee\u6211\u4eec\u5728\u4e91\u670d\u52a1\u5668\u4e0a\u6d4b\u8bd5\u7684\u6a21\u578b\u3002\u8fd9\u4e2a API \u5730\u5740\u9ed8\u8ba4\u683c\u5f0f\u4e3a https://gateway.platform.oneflow.cloud/serving/{id}/v1/index \u3002 \u9996\u5148\u6ce8\u610f\u5230 serving/{id}/ \u8fd9\u90e8\u5206\uff0c\u53ef\u4ee5\u79f0\u4e4b\u4e3a \u54c8\u5e0c\u503c \uff0c\u5b83\u7684\u5b58\u5728\u662f\u56e0\u4e3a\u4e91\u5e73\u53f0\u90e8\u7f72\u7684\u8def\u7531\u5206\u4e24\u5c42\uff1a \u7528\u6237\u8bf7\u6c42\u53d1\u9001\u5230 flow \u7684\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u7b2c\u4e00\u5c42\u7f51\u5173\u901a\u8fc7\u5206\u6790 url \u7684\u54c8\u5e0c\u503c\u6765\u786e\u5b9a\u9879\u76ee\u6765\u6e90\uff0c\u4e5f\u5373\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u5668\uff1b \u786e\u5b9a\u9879\u76ee\u6765\u6e90\u4e4b\u540e\uff0c\u6839\u636e\u5176\u540e\u7684\u540e\u7f00 v1/index \u5230\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u5bf9\u5e94\u7684\u670d\u52a1 \u54c8\u5e0c\u503c\u7684\u5b58\u5728\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\uff1a \u95ee\u9898\u4e00\uff1a\u8be5 API \u5730\u5740\u5230\u670d\u52a1\u5668\u4e0a\u8bf7\u6c42\u670d\u52a1\u65f6\uff0c @app.route \u662f serving/{id}/v1/index \uff1b \u95ee\u9898\u4e8c\uff1a\u8bf7\u6c42\u9759\u6001\u6587\u4ef6\u65f6\uff0c\u76f8\u5bf9\u4e8e\u5177\u4f53\u670d\u52a1\u5668\u800c\u8a00\uff0c Flask(__name__) \u9ed8\u8ba4\u9759\u6001\u6587\u4ef6\u5939\u76ee\u5f55\u4e3a /static \uff0c\u5f53\u8bf7\u6c42 /static/index.css \u65f6\u5e94\u5f53\u53d1\u9001 /static/index.css \uff0c\u4f46\u662f\u4e91\u5e73\u53f0\u53d1\u9001\u9759\u6001\u6587\u4ef6\u8bf7\u6c42\u65f6\u7684 url \u4e3a /serving/{id}/static/index.css \u53ef\u4ee5\u901a\u8fc7\u73af\u5883\u53d8\u91cf BASE_DIR \u7684\u5f62\u5f0f\u628a\u54c8\u5e0c\u524d\u7f00\u4f20\u5230\u670d\u52a1\u7aef\u4ee3\u7801\u4ee5\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\u3002\u4ee3\u7801\u793a\u4f8b\uff1a import os from flask import Flask, render_template base_dir = os.environ.get(\"BASE_DIR\", \"\") app = Flask(__name__, static_url_path=base_dir+'/static') # \u89e3\u51b3\u95ee\u9898\u4e8c @app.route(f\"{base_dir}/v1/index\", methods=[\"GET\"]) # \u89e3\u51b3\u95ee\u9898\u4e00 def home(): return render_template(\"index.html\", base_dir=base_dir) # \u89e3\u51b3\u95ee\u9898\u4e8c if __name__ == \"__main__\": app.run(\"0.0.0.0\") \u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c\u6211\u4eec\u589e\u52a0\u4e86\u53c2\u6570 base_dir \uff0cFlask \u5c06 base_dir \u4f20\u5230 @app.route \u3001 static_url_path \u3001 html \u6587\u4ef6 \u4e2d\u3002\u8fd9\u4e2a\u53c2\u6570\u7684\u5b9a\u4e49\u4e3a\uff1a \u5f53\u5b58\u5728 BASE_DIR \u65f6\uff0c\u5373\u5728\u4e91\u670d\u52a1\u5668\u4e0a\u90e8\u7f72\u65f6\uff0c\u83b7\u53d6\u5230 BASE_DIR \u5373\u4e0a\u6587\u6240\u8bf4\u7684 serving/{id}/ \u5426\u5219 base_dir \u8bbe\u7f6e\u4e3a\u7a7a base_dir \u5728 html \u6587\u4ef6\u7684\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a <link rel=\"stylesheet\" type='text/css' href=\"{{base_dir}}/static/css/index.css\"> \u6b64\u5904\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u9488\u5bf9\u95ee\u9898\u4e8c\uff0c\u6211\u4eec\u4e0d\u4ec5\u5c06 static_url_path \u503c\u66f4\u6539\u4e86\uff0c\u8fd8\u5c06 html \u4e2d\u7684\u8bf7\u6c42\u8def\u5f84\uff08\u5982 href \uff09\u66f4\u6539\u4e86\uff0c\u90a3\u4e0d\u540c\u65f6\u66f4\u6539\u8fd9\u4e24\u4e2a\u8def\u5f84\u4e0d\u4e5f\u80fd\u5bf9\u5e94\u4e0a\u9759\u6001\u6587\u4ef6\u5417\uff1f\u5176\u5b9e\u662f\u4e0d\u53ef\u4ee5\u7684\u3002\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u901a\u8fc7\u54c8\u5e0c\u503c\u5b9a\u4f4d\u63d0\u4f9b\u670d\u52a1\u7684\u670d\u52a1\u5668\uff0c\u5373\u5b9e\u73b0\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u6240\u4ee5\u54c8\u5e0c\u503c\u662f\u5fc5\u987b\u5b58\u5728\u7684\uff0c href \u5fc5\u987b\u5e26\u4e0a\u54c8\u5e0c\u524d\u7f00\u624d\u80fd\u5b9e\u73b0\u7b2c\u4e00\u5c42\u7f51\u5173\uff0c\u800c\u6b63\u662f\u7531\u4e8e href \u5e26\u6709\u54c8\u5e0c\u524d\u7f00\uff0c\u56e0\u6b64\u9700\u8981\u66f4\u6539 static_url_path \u3002 \u6700\u540e\uff0c\u6ce8\u610f\u8fd9\u4e2a API \u9ed8\u8ba4\u683c\u5f0f\u4e3a https://gateway.platform.oneflow.cloud/serving/{id}/v1/index \uff0c\u8fd9\u610f\u5473\u7740\u5728 Flask \u6a21\u5757\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6211\u4eec\u60f3\u88ab\u8bbf\u95ee\u5230\u7684\u9875\u9762\u8bbe\u7f6e\u4e3a @app.route(f\"{base_dir}/v1/index\", \u2026\u2026) \uff0c\u5426\u5219\u53ef\u80fd\u4f1a\u5bf9\u7528\u6237\u4ea7\u751f\u56f0\u6270\u3002\u5f53\u7136\uff0c\u4e5f\u53ef\u4ee5\u81ea\u5b9a\u4e49 url\u3002\u4f8b\u5982\u5982\u679c\u4f60\u6dfb\u52a0\u4e86\u9875\u9762 A \u5230 @app.route(f\"{base_dir}/\", \u2026\u2026) \uff0c\u76f4\u63a5\u8bbf\u95ee https://gateway.platform.oneflow.cloud/serving/{id} \u53ef\u4ee5\u5f97\u5230\u9875\u9762 A\u3002 \u66f4\u591a\uff1a\u5173\u4e8e static_url_path \uff0c\u53ef\u53c2\u8003 Flask \u521b\u5efaapp \u65f6\u5019\u4f20\u5165\u7684 static_folder \u548c static_url_path\u53c2\u6570\u7406\u89e3","title":"\u90e8\u7f72"},{"location":"onecloud/20220322-%E4%BA%91%E5%B9%B3%E5%8F%B0%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.html","text":"\u4e00\u4e9b\u5173\u4e8e \u4e91\u5e73\u53f0\u4f7f\u7528 \u7684\u6ce8\u610f\u4e8b\u9879\u3002 \u542f\u52a8\u9879\u76ee\u9700\u8981\u8f93\u5165\u547d\u4ee4\u884c\uff0c\u8fd9\u4e2a\u547d\u4ee4\u4e0d\u8981\u8f93\u5165\u5982 ls \u8fd9\u6837\u5373\u65f6\u7684\u6307\u4ee4\uff0c\u56e0\u4e3a\u547d\u4ee4\u884c\u7684\u8fd0\u884c\u65f6\u95f4\u5c31\u662f\u9879\u76ee\u6240\u5728\u670d\u52a1\u5668\u7684\u8fd0\u884c\u65f6\u95f4\uff0c\u4e00\u822c\u7528 sleep 365d \u5373\u53ef Windows \u7cfb\u7edf ssh \u8fde\u63a5\u4e91\u5e73\u53f0\u65f6\uff0c\u5d4c\u5165\u4e86 nc \u6307\u4ee4\uff0c\u8fd9\u4e2a nc.exe \u6587\u4ef6\u53ef\u4ee5\u5728 MobaXterm \u7684\u6587\u4ef6\u5939\u4e0b\u627e\u5230\uff0c\u4f8b\u5982\u6211\u7684\u5728 D:\\Documents\\MobaXterm\\slash\\bin \uff0c\u53ea\u8981\u5b89\u88c5\u4e86 MobaXterm \u5373\u6709\uff0c\u627e\u4e0d\u5230\u7684\u8bdd\u53ef\u4ee5\u4f7f\u7528\u5feb\u901f\u68c0\u7d22\u6587\u4ef6\u8f6f\u4ef6\u5982 Everything \u627e\u627e\u3002\u9700\u8981\u5c06\u8fd9\u4e00\u8def\u5f84\u6dfb\u52a0\u5230\u73af\u5883\u53d8\u91cf Path \u624d\u53ef\u4ee5\u4f7f\u7528 Vscode \u8fde\u63a5\u4e91\u670d\u52a1\u5668\uff0c\u6216\u8005\u76f4\u63a5\u5728 config \u6587\u4ef6\u4e0b\u7684 ProxyCommand nc \u6307\u4ee4\u524d\u6dfb\u52a0 nc \u7684\u7edd\u5bf9\u8def\u5f84 \u53ea\u6709\u6839\u76ee\u5f55\u7684 workspace \u4e0b\u7684\u6587\u4ef6\u662f\u6c38\u4e45\u4fdd\u5b58 \u5927\u6587\u4ef6\u4f20\u8f93\u53ef\u4ee5\u7528 scp \u6307\u4ee4\uff0c\u793a\u4f8b scp -o ProxyCommand=\"ncat --proxy-type http --proxy sshproxy.platform.oneflow.cloud:32321 %h %p\" \u6587\u4ef6\u540d root@10.7.48.251:/workspace/ \u90e8\u7f72\u7684\u542f\u52a8\u547d\u4ee4\u884c\u5fc5\u987b\u80fd\u4e00\u76f4\u8fd0\u884c\uff0c\u5426\u5219\u4f1a\u663e\u793a\u542f\u52a8\u5931\u8d25\u3002\u8fd9\u79cd\u8981\u6c42\u4e0b\u5c31\u4e0d\u9002\u5408\u4f7f\u7528 nohup \u6307\u4ee4\u8fdb\u884c\u9879\u76ee\u542f\u52a8\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528 python run.py \u5373\u53ef \u90e8\u7f72 \u5728\u7ebf\u63a8\u7406 \u9879\u76ee A \u540e\uff0c\u4fee\u6539\u9879\u76ee\u4ee3\u7801\uff0cA \u7684\u5185\u5bb9\u5e76\u4e0d\u4f1a\u540c\u6b65\u6539\u52a8\u3002\u4e14\u53ea\u8981\u505c\u6b62 A\uff0c\u73af\u5883\u5168\u90e8\u91cd\u7f6e\uff0c\u6240\u4ee5\u505c\u6b62 A \u4e4b\u540e\u542f\u52a8\u9879\u76ee \u4e0e \u91cd\u65b0\u90e8\u7f72 \u5728\u7ebf\u63a8\u7406 \u9879\u76ee B \u7684\u8017\u65f6\u662f\u4e00\u6837\u7684 \u6700\u597d\u4e0d\u8981\u7528\u81ea\u5b9a\u4e49\u955c\u50cf\uff0c\u4e0d\u65b9\u4fbf\u5171\u4eab\uff0c\u5728\u516c\u5f00\u9879\u76ee\u7684\u65f6\u5019\u516c\u5f00\u4e0d\u4e86","title":"\u4e91\u5e73\u53f0\u4f7f\u7528\u6ce8\u610f\u4e8b\u9879"},{"location":"onecloud/20220408-%E5%AF%B9%E9%BD%90%E8%BF%87%E7%A8%8B%E7%BB%8F%E9%AA%8C%E6%B2%89%E6%B7%80.html","text":"\u603b\u7ed3\u8fc1\u79fb\u6a21\u578b\uff08\u4e0d\u987a\u5229\u65f6\uff09\u7684\u7ecf\u9a8c\uff1a \u5148\u5c1d\u8bd5 import oneflow as torch \u770b\u80fd\u5426\u8dd1\u901a\uff0c\u5982\u679c\u80fd\u5426\u8dd1\u901a\uff0c\u90a3\u5c31\u4efb\u52a1\u7ed3\u675f\u4e86\u3002 \u5982\u679c\u4e0a\u4e00\u6b65\u4e0d\u987a\u5229\u7684\u8bdd\uff0c \u4e00\u5b9a\u4e0d\u8981 \u5728 import oneflow as torch \u7684\u524d\u63d0\u4e0b\u53bb\u8c03\u6574\u3001\u8c03\u8bd5\u4ee3\u7801\u3002\u800c\u662f\u76f4\u63a5\u4f7f\u7528 import oneflow as flow \uff0c\u7136\u540e\u5229\u7528\u89e3\u91ca\u5668\u7684\u62a5\u9519\u6216\u8005\u8089\u773c\u68c0\u67e5\uff0c\u628a\u6240\u6709\u5173\u4e8e torch \u7684\u4f9d\u8d56\uff0c\u6539\u4e3a\u5bf9 flow \u7684\u4f9d\u8d56\u3002 torch \u548c oneflow \u6a21\u578b\u5b58\u50a8\u65b9\u5f0f\u4e0d\u540c\uff0c\u5982\u679c\u6709\u52a0\u8f7d pth \u5b58\u50a8\u7684\u6a21\u578b\u7684\u9700\u8981\uff0c\u5efa\u8bae\u5148\u5c06\u6a21\u578b\u683c\u5f0f\u6362\u6210 oneflow \u683c\u5f0f\uff0c\u8f6c\u6362\u53c2\u8003 \u4ee3\u7801 \u3002 \u5b89\u88c5\u6700\u65b0\u7248 oneflow \u9700\u8981\u4f7f\u7528 pip install --pre oneflow -f https://staging.oneflow.info/branch/master/cu112 \uff0c\u56e0\u4e3a oneflow \u5176\u5b9e\u4e0d\u5728 pypi \u4e0a\uff0c\u5728\u81ea\u5df1\u7684\u670d\u52a1\u5668\u4e0a\u3002 \u9047\u5230\u6ca1\u6709\u67d0\u4e9b\u6a21\u5757\u7684\u95ee\u9898\uff0c\u89e3\u51b3\u65b9\u6cd5\u4e00\u822c\u662f \uff081\uff09\u67e5\u770b API\u6587\u6863 \uff0c\u786e\u5b9a\u6a21\u5757\u662f\u5426\u7f3a\u5931\uff1b\uff082\uff09\u5982\u679c\u6a21\u5757\u786e\u5b9e\u7f3a\u5931\uff0c\u601d\u8003\u80fd\u5426\u4f7f\u7528\u5176\u4ed6\u65b9\u5f0f\u62fc\u51fa\uff1b\uff083\uff09\u5982\u679c\u601d\u8003\u4e0d\u51fa\u89e3\u51b3\u65b9\u6848\uff0c\u53ef\u4ee5\u8be2\u95ee yaochi \u6216\u8005 \u7fa4\u4e0a\u8be2\u95ee zhangxiaoyu\u3002 \u51fa\u73b0\u7b97\u5b50\u4e0d\u517c\u5bb9\u6216\u8005\u7b97\u5b50\u7f3a\u5931\u7b49\u95ee\u9898\uff0c\u5148\u81ea\u5df1\u7684 issue \u4e0a\u8bb0\u5f55\uff0c\u518d\u5728 slack \u4e0a\u627e yaochi \u786e\u8ba4\uff0c\u786e\u8ba4\u540e\u518d\u53bb https://github.com/Oneflow-Inc/OneTeam/issues/1207#issuecomment-1073432125 \u8fd9\u4e2a comment \u53cd\u9988\u3002 Flask \u548c\u4e91\u5e73\u53f0\u7684\u4e00\u4e9b\u95ee\u9898\u548c\u6ce8\u610f\u4e8b\u9879\u89c1 https://github.com/Oneflow-Inc/OneCloud/issues/73 \u3002 oneflow \u5bf9\u63a5\u7684\u662f torch \u6700\u65b0\u7248\u63a5\u53e3\u3002\u56e0\u6b64\u6709\u65f6\u5019\u7f3a\u5c11\u5bf9\u5e94\u7b97\u5b50\u5e76\u4e0d\u662f\u7f3a\u5c11\u7b97\u5b50\uff0c\u800c\u662f\u65b0\u7248 torch \u66f4\u6362\u4e86\u63a5\u53e3\u540d\u79f0\uff0c\u4f8b\u5982 torch \u4e2d nn.DataParallel \u5f03\u7528\uff0c\u6539\u7528 nn.parallel.DistributedDataParallel\uff0c\u6392\u67e5\u8fd9\u79cd\u95ee\u9898\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2 torch \u6587\u6863\uff0c\u4f1a\u6709\u5bf9\u5e94\u7684 Warning \u4fe1\u606f\uff0c\u5982 torch.nn.DataParallel \u3002","title":"\u5bf9\u9f50\u8fc7\u7a0b\u7ecf\u9a8c\u6c89\u6dc0"},{"location":"util/20220307-mkdocs.html","text":"mkdocs + GitHub \u642d\u5efa\u6587\u6863\u7f51\u7ad9 \u57fa\u7840\u6d41\u7a0b \u5b89\u88c5 Python \u4f9d\u8d56\u5305 mkdocs==1.2.2 mkdocs-material==7.1.11 mkdocs-material-extensions==1.0.1 mike==1.0.1 \u65b0\u5efa\u672c\u5730\u9879\u76ee myblog mkdocs new myblog \u65b0\u5efaGitHub\u9879\u76ee myblog \u5e76 clone \u5230\u672c\u5730 \u5728 clone \u4e0b\u6765\u7684 myblog \u4e2d\u79fb\u5165\u672c\u5730\u6587\u4ef6\u5939 myblog \u7684\u5185\u5bb9\uff0c\u5e76 push \u5230\u8fdc\u7a0b\u4ed3\u5e93 \u65b0\u5efa gh-pages \u5206\u652f git checkout -b gh-pages \u5728 GitHub \u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u7f16\u8bd1\u6587\u4ef6 mkdocs build \u5220\u9664\u9664site\u4e4b\u5916\u7684\u6587\u4ef6\u5e76\u5c06site\u6587\u4ef6\u5939\u7684\u6587\u4ef6\u66f4\u65b0\u5230root\u4e2d \u5c06\u9879\u76ee\u6587\u4ef6\u5939\u66f4\u65b0\u5230 gh-pages \u5206\u652f\uff0c\u6b64\u65f6\u67e5\u770b GitHub myblog \u9879\u76ee\u7684 setting Pages \u5373\u53ef\u4ee5\u770b\u5230\u5bf9\u5e94\u7f51\u9875\u5730\u5740 \u5229\u7528 GitHub Action \u5b8c\u6210\u81ea\u52a8\u5316 mkdocs \u7f16\u8bd1 \u70b9\u51fb GitHub myblog \u7684 Action\uff0c\u65b0\u5efa\u4e00\u4e2a simple workflow \u4fee\u6539 yaml \u6587\u4ef6 # This is a basic workflow to help you get started with Actions name: public site # Controls when the workflow will run on: # Triggers the workflow on push or pull request events but only for the main branch push: branches: [ main ] pull_request: branches: [ main ] # Allows you to run this workflow manually from the Actions tab workflow_dispatch: # A workflow run is made up of one or more jobs that can run sequentially or in parallel jobs: # This workflow contains a single job called \"build\" build: # The type of runner that the job will run on runs-on: ubuntu-latest # Steps represent a sequence of tasks that will be executed as part of the job steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - uses: actions/checkout@v3 - name: Install mkdocs run: | python -m pip install mkdocs==1.2.2 python -m pip install mkdocs-material==7.1.11 python -m pip install mkdocs-material-extensions==1.0.1 python -m pip install mike==1.0.1 - name: Create html run: mkdocs build - name: Public uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./site","title":"mkdocs + GitHub \u642d\u5efa\u6587\u6863\u7f51\u7ad9"},{"location":"util/20220307-mkdocs.html#mkdocs-github","text":"","title":"mkdocs + GitHub \u642d\u5efa\u6587\u6863\u7f51\u7ad9"},{"location":"util/20220307-mkdocs.html#_1","text":"\u5b89\u88c5 Python \u4f9d\u8d56\u5305 mkdocs==1.2.2 mkdocs-material==7.1.11 mkdocs-material-extensions==1.0.1 mike==1.0.1 \u65b0\u5efa\u672c\u5730\u9879\u76ee myblog mkdocs new myblog \u65b0\u5efaGitHub\u9879\u76ee myblog \u5e76 clone \u5230\u672c\u5730 \u5728 clone \u4e0b\u6765\u7684 myblog \u4e2d\u79fb\u5165\u672c\u5730\u6587\u4ef6\u5939 myblog \u7684\u5185\u5bb9\uff0c\u5e76 push \u5230\u8fdc\u7a0b\u4ed3\u5e93 \u65b0\u5efa gh-pages \u5206\u652f git checkout -b gh-pages \u5728 GitHub \u9879\u76ee\u6587\u4ef6\u5939\u4e0b\u7f16\u8bd1\u6587\u4ef6 mkdocs build \u5220\u9664\u9664site\u4e4b\u5916\u7684\u6587\u4ef6\u5e76\u5c06site\u6587\u4ef6\u5939\u7684\u6587\u4ef6\u66f4\u65b0\u5230root\u4e2d \u5c06\u9879\u76ee\u6587\u4ef6\u5939\u66f4\u65b0\u5230 gh-pages \u5206\u652f\uff0c\u6b64\u65f6\u67e5\u770b GitHub myblog \u9879\u76ee\u7684 setting Pages \u5373\u53ef\u4ee5\u770b\u5230\u5bf9\u5e94\u7f51\u9875\u5730\u5740","title":"\u57fa\u7840\u6d41\u7a0b"},{"location":"util/20220307-mkdocs.html#github-action-mkdocs","text":"\u70b9\u51fb GitHub myblog \u7684 Action\uff0c\u65b0\u5efa\u4e00\u4e2a simple workflow \u4fee\u6539 yaml \u6587\u4ef6 # This is a basic workflow to help you get started with Actions name: public site # Controls when the workflow will run on: # Triggers the workflow on push or pull request events but only for the main branch push: branches: [ main ] pull_request: branches: [ main ] # Allows you to run this workflow manually from the Actions tab workflow_dispatch: # A workflow run is made up of one or more jobs that can run sequentially or in parallel jobs: # This workflow contains a single job called \"build\" build: # The type of runner that the job will run on runs-on: ubuntu-latest # Steps represent a sequence of tasks that will be executed as part of the job steps: # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it - uses: actions/checkout@v3 - name: Install mkdocs run: | python -m pip install mkdocs==1.2.2 python -m pip install mkdocs-material==7.1.11 python -m pip install mkdocs-material-extensions==1.0.1 python -m pip install mike==1.0.1 - name: Create html run: mkdocs build - name: Public uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_dir: ./site","title":"\u5229\u7528 GitHub Action \u5b8c\u6210\u81ea\u52a8\u5316 mkdocs \u7f16\u8bd1"},{"location":"util/20220312-git.html","text":"git \u5e38\u7528\u6307\u4ee4 \u63d0\u4ea4PR \u4e00\u5171\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u65b0\u5efa\u9879\u76ee\uff1aFork \u65b0\u5efa\u5206\u652f\uff1acheckout -b \u4f7f\u7528 \u65b0\u5efa\u9879\u76ee \u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5728\u81ea\u5df1\u9879\u76ee\u4e0b\u8fdb\u884c\u4ee3\u7801\u5bf9\u6bd4\u548c\u591a\u6b21\u6539\u52a8\uff0c\u6743\u9650\u548c\u81ea\u7531\u5ea6\u8f83\u5927\uff0c\u4f46\u662f\u6d41\u7a0b\u76f8\u5bf9\u7e41\u7410\uff1b\u4f7f\u7528 \u65b0\u5efa\u5206\u652f \u8fd9\u4e2a\u65b9\u6cd5\u76f8\u5bf9\u76f4\u63a5\u3002 \u65b0\u5efa\u9879\u76ee Fork \u4ed3\u5e93 \u62c9\u53d6 Fork \u5230\u81ea\u5df1\u8d26\u6237\u4e0b\u7684\u4ee3\u7801\u5230\u672c\u5730\uff1agit clone \u521b\u5efa\u65b0\u5206\u652f git init git pull git checkout master git checkout -b brach_name # \u521b\u5efa\u5206\u652f \u4fee\u6539\u6587\u4ef6\uff0c\u63d0\u4ea4\u4fee\u6539\u5230\u8fdc\u7a0b\u4ed3\u5e93 git add . git commit -m \"comment\" # \u6216\u8005 git commit -a git push git_name brach_name \u590d\u5236\u6307\u4ee4\u4e2d\u7684\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u8fdb\u5165\u4e00\u4e2aPR\u521b\u5efa\u9875\u9762\uff08\u4e5f\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684pull requests\u4e2d\u627e\u5230\u8fd9\u4e2a\u9875\u9762\uff09\u4fee\u6539\u597d\u547d\u540d\u548c\u63cf\u8ff0\u4e4b\u540e\u5c31\u53ef\u4ee5\u63d0\u4ea4\u5230\u516c\u5f00\u9879\u76ee\u4e0b \u76f4\u63a5\u65b0\u5efa\u5206\u652f \u62c9\u53d6\u516c\u5f00\u9879\u76ee\u7684\u4ee3\u7801\u5230\u672c\u5730\uff1agit clone \u521b\u5efa\u65b0\u5206\u652f git init git pull git checkout master git checkout -b brach_name # \u521b\u5efa\u5206\u652f \u4fee\u6539\u6587\u4ef6\uff0c\u63d0\u4ea4\u4fee\u6539\u5230\u8fdc\u7a0b\u4ed3\u5e93 git add . git commit -m \"comment\" # \u6216\u8005 git commit -a git push git_name brach_name # git_name \u4e00\u822c\u4e3a origin \u590d\u5236\u6307\u4ee4\u4e2d\u7684\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u8fdb\u5165\u4e00\u4e2aPR\u521b\u5efa\u9875\u9762\uff08\u4e5f\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684pull requests\u4e2d\u627e\u5230\u8fd9\u4e2a\u9875\u9762\uff09\u4fee\u6539\u597d\u547d\u540d\u548c\u63cf\u8ff0\u4e4b\u540e\u5c31\u53ef\u4ee5\u63d0\u4ea4\u5230\u516c\u5f00\u9879\u76ee\u4e0b \u5e38\u7528\u6307\u4ee4 # https://www.cnblogs.com/wdyaoyao/p/10820181.html git remote -v # \u67e5\u770b\u8fdc\u7a0b\u4ed3\u5e93 git branch -a # \u67e5\u770b\u6240\u6709\u5206\u652f git remove -v # \u67e5\u770b\u4ed3\u5e93 git push -f functor:master git checkout branch_name # \u5207\u6362\u5206\u652f git checkout -b branch_name # \u521b\u5efa\u5206\u652f \u670d\u52a1\u5668\u767b\u5f55GitHub\u5e76\u63a8\u9001\u4ee3\u7801\u5230\u81ea\u5df1\u8d26\u6237\u4e0b git config --global user.email zhongshsh5@mail2.sysu.edu.cn git config --global user.name zhongshsh git init git remote rm origin git remote add origin https://github.com/Oneflow-Inc/OneCloud \u64a4\u9500 add \u548c commit Git\u64a4\u9500add\u3001commit # \u64a4\u9500 add git status \u67e5\u770b\u5f53\u4e0b\u66f4\u65b0\u7684\u6587\u4ef6 git reset HEAD \u8868\u793a\u64a4\u9500\u4e0a\u6b21add\u7684\u6240\u6709\u6587\u4ef6 git reset HEAD dir/dir/test.php \u64a4\u9500\u6307\u5b9a\u6587\u4ef6 # \u64a4\u9500 commit git reset --soft HEAD^/HEAD~1 //\u8fd9\u6837\u5c31\u6210\u529f\u7684\u64a4\u9500\u4e86\u4f60\u4e0a\u6b21\u7684commit\uff08\u4ec5\u4ec5\u662f\u64a4\u56decommit\u64cd\u4f5c\uff0c\u4ee3\u7801\u4ecd\u7136\u4fdd\u7559\uff09 # \u5982\u679ccommit\u6ce8\u91ca\u5199\u9519\u4e86 git commit --amend //\u6b64\u65f6\u4f1a\u8fdb\u5165\u9ed8\u8ba4vim\u7f16\u8f91\u5668\uff0c\u4fee\u6539\u6ce8\u91ca\u5b8c\u6bd5\u540e\u4fdd\u5b58\u5c31\u597d\u4e86\u3002 \u64a4\u9500\u672c\u5730\u4fee\u6539 git checkout . \u7248\u672c\u56de\u9000 git log \u67e5\u770b\u60f3\u8981\u56de\u9000\u7684\u7248\u672c\u7684\u7248\u672c\u53f7\uff0cgit reset \u5728\u672c\u5730\u56de\u9000\u5230\u5bf9\u5e94\u7684\u7248\u672c\uff0cgit push \u5c06\u56de\u9000\u7684\u7248\u672c\u5f3a\u5236\u63a8\u9001\u5230\u5bf9\u5e94\u5206\u652f\u3002\u4e00\u822c\u5728 GitHub pr \u7684 commit \u4e2d\u67e5\u627e\u7248\u672c\u53f7\u66f4\u76f4\u89c2\u4e00\u4e9b\u3002 git log --pretty=oneline git reset --hard fae6966548e3ae76cfa7f38a461c438cf75ba965 git push -f -u origin master \u5176\u4ed6 Using keywords in issues and pull requests - GitHub Docs \u6ce8\u610f\u4e8b\u9879 \u4e0d\u8981\u4f20\u8f93\u8d85\u8fc7 100M \u7684\u6587\u4ef6 \u5173\u4e8e GitHub \u4e0a\u7684\u5927\u6587\u4ef6 \u5148\u5207\u6362\u5230\u5df2\u6709\u5206\u652f\u518d\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c \u4e0d\u8981\u968f\u610f\u5173\u95ed\u548c\u521b\u5efa issue\uff0cissue \u53ea\u80fd close\uff0c\u5220\u4e0d\u4e86\u7684 \u4fee\u6539 PR \u7684\u540d\u79f0\u4f1a\u5bf9\u5df2\u63d0\u4ea4\u7684 PR \u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\uff1f","title":"git \u5e38\u7528\u6307\u4ee4"},{"location":"util/20220312-git.html#git","text":"","title":"git \u5e38\u7528\u6307\u4ee4"},{"location":"util/20220312-git.html#pr","text":"\u4e00\u5171\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a \u65b0\u5efa\u9879\u76ee\uff1aFork \u65b0\u5efa\u5206\u652f\uff1acheckout -b \u4f7f\u7528 \u65b0\u5efa\u9879\u76ee \u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5728\u81ea\u5df1\u9879\u76ee\u4e0b\u8fdb\u884c\u4ee3\u7801\u5bf9\u6bd4\u548c\u591a\u6b21\u6539\u52a8\uff0c\u6743\u9650\u548c\u81ea\u7531\u5ea6\u8f83\u5927\uff0c\u4f46\u662f\u6d41\u7a0b\u76f8\u5bf9\u7e41\u7410\uff1b\u4f7f\u7528 \u65b0\u5efa\u5206\u652f \u8fd9\u4e2a\u65b9\u6cd5\u76f8\u5bf9\u76f4\u63a5\u3002","title":"\u63d0\u4ea4PR"},{"location":"util/20220312-git.html#_1","text":"Fork \u4ed3\u5e93 \u62c9\u53d6 Fork \u5230\u81ea\u5df1\u8d26\u6237\u4e0b\u7684\u4ee3\u7801\u5230\u672c\u5730\uff1agit clone \u521b\u5efa\u65b0\u5206\u652f git init git pull git checkout master git checkout -b brach_name # \u521b\u5efa\u5206\u652f \u4fee\u6539\u6587\u4ef6\uff0c\u63d0\u4ea4\u4fee\u6539\u5230\u8fdc\u7a0b\u4ed3\u5e93 git add . git commit -m \"comment\" # \u6216\u8005 git commit -a git push git_name brach_name \u590d\u5236\u6307\u4ee4\u4e2d\u7684\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u8fdb\u5165\u4e00\u4e2aPR\u521b\u5efa\u9875\u9762\uff08\u4e5f\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684pull requests\u4e2d\u627e\u5230\u8fd9\u4e2a\u9875\u9762\uff09\u4fee\u6539\u597d\u547d\u540d\u548c\u63cf\u8ff0\u4e4b\u540e\u5c31\u53ef\u4ee5\u63d0\u4ea4\u5230\u516c\u5f00\u9879\u76ee\u4e0b","title":"\u65b0\u5efa\u9879\u76ee"},{"location":"util/20220312-git.html#_2","text":"\u62c9\u53d6\u516c\u5f00\u9879\u76ee\u7684\u4ee3\u7801\u5230\u672c\u5730\uff1agit clone \u521b\u5efa\u65b0\u5206\u652f git init git pull git checkout master git checkout -b brach_name # \u521b\u5efa\u5206\u652f \u4fee\u6539\u6587\u4ef6\uff0c\u63d0\u4ea4\u4fee\u6539\u5230\u8fdc\u7a0b\u4ed3\u5e93 git add . git commit -m \"comment\" # \u6216\u8005 git commit -a git push git_name brach_name # git_name \u4e00\u822c\u4e3a origin \u590d\u5236\u6307\u4ee4\u4e2d\u7684\u94fe\u63a5\u5230\u6d4f\u89c8\u5668\u6253\u5f00\uff0c\u8fdb\u5165\u4e00\u4e2aPR\u521b\u5efa\u9875\u9762\uff08\u4e5f\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684pull requests\u4e2d\u627e\u5230\u8fd9\u4e2a\u9875\u9762\uff09\u4fee\u6539\u597d\u547d\u540d\u548c\u63cf\u8ff0\u4e4b\u540e\u5c31\u53ef\u4ee5\u63d0\u4ea4\u5230\u516c\u5f00\u9879\u76ee\u4e0b","title":"\u76f4\u63a5\u65b0\u5efa\u5206\u652f"},{"location":"util/20220312-git.html#_3","text":"# https://www.cnblogs.com/wdyaoyao/p/10820181.html git remote -v # \u67e5\u770b\u8fdc\u7a0b\u4ed3\u5e93 git branch -a # \u67e5\u770b\u6240\u6709\u5206\u652f git remove -v # \u67e5\u770b\u4ed3\u5e93 git push -f functor:master git checkout branch_name # \u5207\u6362\u5206\u652f git checkout -b branch_name # \u521b\u5efa\u5206\u652f","title":"\u5e38\u7528\u6307\u4ee4"},{"location":"util/20220312-git.html#github","text":"git config --global user.email zhongshsh5@mail2.sysu.edu.cn git config --global user.name zhongshsh git init git remote rm origin git remote add origin https://github.com/Oneflow-Inc/OneCloud","title":"\u670d\u52a1\u5668\u767b\u5f55GitHub\u5e76\u63a8\u9001\u4ee3\u7801\u5230\u81ea\u5df1\u8d26\u6237\u4e0b"},{"location":"util/20220312-git.html#add-commit","text":"Git\u64a4\u9500add\u3001commit # \u64a4\u9500 add git status \u67e5\u770b\u5f53\u4e0b\u66f4\u65b0\u7684\u6587\u4ef6 git reset HEAD \u8868\u793a\u64a4\u9500\u4e0a\u6b21add\u7684\u6240\u6709\u6587\u4ef6 git reset HEAD dir/dir/test.php \u64a4\u9500\u6307\u5b9a\u6587\u4ef6 # \u64a4\u9500 commit git reset --soft HEAD^/HEAD~1 //\u8fd9\u6837\u5c31\u6210\u529f\u7684\u64a4\u9500\u4e86\u4f60\u4e0a\u6b21\u7684commit\uff08\u4ec5\u4ec5\u662f\u64a4\u56decommit\u64cd\u4f5c\uff0c\u4ee3\u7801\u4ecd\u7136\u4fdd\u7559\uff09 # \u5982\u679ccommit\u6ce8\u91ca\u5199\u9519\u4e86 git commit --amend //\u6b64\u65f6\u4f1a\u8fdb\u5165\u9ed8\u8ba4vim\u7f16\u8f91\u5668\uff0c\u4fee\u6539\u6ce8\u91ca\u5b8c\u6bd5\u540e\u4fdd\u5b58\u5c31\u597d\u4e86\u3002","title":"\u64a4\u9500 add \u548c commit"},{"location":"util/20220312-git.html#_4","text":"git checkout .","title":"\u64a4\u9500\u672c\u5730\u4fee\u6539"},{"location":"util/20220312-git.html#_5","text":"git log \u67e5\u770b\u60f3\u8981\u56de\u9000\u7684\u7248\u672c\u7684\u7248\u672c\u53f7\uff0cgit reset \u5728\u672c\u5730\u56de\u9000\u5230\u5bf9\u5e94\u7684\u7248\u672c\uff0cgit push \u5c06\u56de\u9000\u7684\u7248\u672c\u5f3a\u5236\u63a8\u9001\u5230\u5bf9\u5e94\u5206\u652f\u3002\u4e00\u822c\u5728 GitHub pr \u7684 commit \u4e2d\u67e5\u627e\u7248\u672c\u53f7\u66f4\u76f4\u89c2\u4e00\u4e9b\u3002 git log --pretty=oneline git reset --hard fae6966548e3ae76cfa7f38a461c438cf75ba965 git push -f -u origin master","title":"\u7248\u672c\u56de\u9000"},{"location":"util/20220312-git.html#_6","text":"Using keywords in issues and pull requests - GitHub Docs","title":"\u5176\u4ed6"},{"location":"util/20220312-git.html#_7","text":"\u4e0d\u8981\u4f20\u8f93\u8d85\u8fc7 100M \u7684\u6587\u4ef6 \u5173\u4e8e GitHub \u4e0a\u7684\u5927\u6587\u4ef6 \u5148\u5207\u6362\u5230\u5df2\u6709\u5206\u652f\u518d\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c \u4e0d\u8981\u968f\u610f\u5173\u95ed\u548c\u521b\u5efa issue\uff0cissue \u53ea\u80fd close\uff0c\u5220\u4e0d\u4e86\u7684 \u4fee\u6539 PR \u7684\u540d\u79f0\u4f1a\u5bf9\u5df2\u63d0\u4ea4\u7684 PR \u4ea7\u751f\u4ec0\u4e48\u5f71\u54cd\uff1f","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html","text":"\u9879\u76ee\u6536\u5de5\u5c0f\u6280\u5de7 pip \u6e05\u534e\u6e90 pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple conda \u6e90 Conda \u66ff\u6362\u955c\u50cf\u6e90\u65b9\u6cd5\u5c3d\u5934 \u4ee3\u7801\u7f8e\u5316 python pip install black python -m black fileName python -m black folderName C \u548c Java clang-format ./main.cpp clang-format -i ./main.cpp \u4f9d\u8d56\u5305\u5bfc\u51fa # https://pypi.org/project/pipreqs/ pip install pipreqs pipreqs ./ --force","title":"\u9879\u76ee\u6536\u5de5\u5c0f\u6280\u5de7"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#_1","text":"","title":"\u9879\u76ee\u6536\u5de5\u5c0f\u6280\u5de7"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#pip","text":"pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple","title":"pip \u6e05\u534e\u6e90"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#conda","text":"Conda \u66ff\u6362\u955c\u50cf\u6e90\u65b9\u6cd5\u5c3d\u5934","title":"conda \u6e90"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#_2","text":"","title":"\u4ee3\u7801\u7f8e\u5316"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#python","text":"pip install black python -m black fileName python -m black folderName","title":"python"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#c-java","text":"clang-format ./main.cpp clang-format -i ./main.cpp","title":"C \u548c Java"},{"location":"util/20220322-%E9%A1%B9%E7%9B%AE%E6%94%B6%E5%B7%A5%E5%B0%8F%E6%8A%80%E5%B7%A7.html#_3","text":"# https://pypi.org/project/pipreqs/ pip install pipreqs pipreqs ./ --force","title":"\u4f9d\u8d56\u5305\u5bfc\u51fa"},{"location":"util/20220406-ssh.html","text":"SSH \u52a0\u901f\u4e0b\u8f7d GitHub \u9879\u76ee \u4f7f\u7528 SSH \u65b9\u5f0f\u4e0b\u8f7d GitHub \u9879\u76ee\u901f\u5ea6\u76f8\u5bf9\u66f4\u7a33\u5b9a\uff08\u4e3a\u5565\uff1f\uff09 \u65b0\u589e ssh keys \u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u5982\u4e0b\u6307\u4ee4\uff0c\u751f\u6210\u5bc6\u94a5\uff08\u4e00\u8def\u56de\u8f66\u5373\u53ef\uff09 ssh-keygen -t rsa # \u6216\u8005\u4f7f\u7528 ssh-keygen -t dsa \u5c06 /home/.ssh/*.pub \u6587\u4ef6\u5185\u5bb9\u9ecf\u8d34\u5230 GitHub setting \u7684 SSH AND GPG keys \uff08 Add new SSH keys \uff09\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u4e0a\u4f7f\u7528 SSH \u4e0b\u8f7d GitHub \u9879\u76ee\u4e86\u3002 \u8bbe\u7f6eLinux\u514d\u5bc6\u767b\u5f55 \u4f7f\u7528 \u4ee5 OneFlow \u4e3a\u4f8b\uff0c\u4f7f\u7528 SSH \u65b9\u5f0f\u8fdb\u884c\u9879\u76ee\u514b\u9686\u3002 git clone git@github.com:Oneflow-Inc/oneflow.git","title":"SSH \u52a0\u901f\u4e0b\u8f7d GitHub \u9879\u76ee"},{"location":"util/20220406-ssh.html#ssh-github","text":"\u4f7f\u7528 SSH \u65b9\u5f0f\u4e0b\u8f7d GitHub \u9879\u76ee\u901f\u5ea6\u76f8\u5bf9\u66f4\u7a33\u5b9a\uff08\u4e3a\u5565\uff1f\uff09","title":"SSH \u52a0\u901f\u4e0b\u8f7d GitHub \u9879\u76ee"},{"location":"util/20220406-ssh.html#ssh-keys","text":"\u5728\u670d\u52a1\u5668\u4e0a\u8fd0\u884c\u5982\u4e0b\u6307\u4ee4\uff0c\u751f\u6210\u5bc6\u94a5\uff08\u4e00\u8def\u56de\u8f66\u5373\u53ef\uff09 ssh-keygen -t rsa # \u6216\u8005\u4f7f\u7528 ssh-keygen -t dsa \u5c06 /home/.ssh/*.pub \u6587\u4ef6\u5185\u5bb9\u9ecf\u8d34\u5230 GitHub setting \u7684 SSH AND GPG keys \uff08 Add new SSH keys \uff09\uff0c\u6b64\u65f6\u5c31\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u4e0a\u4f7f\u7528 SSH \u4e0b\u8f7d GitHub \u9879\u76ee\u4e86\u3002 \u8bbe\u7f6eLinux\u514d\u5bc6\u767b\u5f55","title":"\u65b0\u589e ssh keys"},{"location":"util/20220406-ssh.html#_1","text":"\u4ee5 OneFlow \u4e3a\u4f8b\uff0c\u4f7f\u7528 SSH \u65b9\u5f0f\u8fdb\u884c\u9879\u76ee\u514b\u9686\u3002 git clone git@github.com:Oneflow-Inc/oneflow.git","title":"\u4f7f\u7528"},{"location":"util/20220411-CI.html","text":"\u5173\u4e8e PR CI \u6301\u7eed\u96c6\u6210 (Con\u00adtin\u00adu\u00adous in\u00adte\u00adgra\u00adtion\uff0c\u7b80\u79f0 CI) \u63d0\u4f9b\u4e86\u914d\u7f6e\u975e\u5e38\u4e0d\u9519\u7684\u865a\u62df\u670d\u52a1\u5668\u73af\u5883\uff0c\u57fa\u4e8e\u5b83\u53ef\u4ee5\u8fdb\u884c\u6784\u5efa\u3001\u6d4b\u8bd5\u3001\u6253\u5305\u3001\u90e8\u7f72\u9879\u76ee\u3002 \u6d41\u7a0b \u83b7\u53d6\u4e24\u4e2a approve\uff1b \u5728 reviewer \u4e2d\u6dfb\u52a0 bot\uff1a \u6839\u636e bot \u7684\u63d0\u793a\u6dfb\u52a0 label\u3002\u6ce8\u610f\u8981\u9009\u4e00\u4e0b automerge\uff0c\u8868\u660e bot \u5728\u6d4b\u8bd5\u901a\u8fc7\u65f6\u4f1a\u81ea\u52a8\u5408\u5e76 pr \u5230 master\u3002\u6b64\u5916\uff0c\u63d0\u793a\u4fe1\u606f\u4e2d\u7684 label \u9009\u4e00\u4e2a\u5c31\u884c\u4e86\uff0c\u800c\u4e0d\u662f\u5168\u9009\uff0c\u8fd9\u91cc\u6709\u4e2a\u50bb\u5b50\u7b2c\u4e00\u6b21\u6dfb\u52a0 label \u5168\u9009\u4e86 :sweat: \u7b49\u5f85 CI \u7ed3\u675f\u2026\u2026 \u6ce8\u610f\u4e8b\u9879 \u5982\u679c\u662f bot \u6765 format \u4ee3\u7801\uff0c\u90a3\u4e48\u51fa\u73b0\u5982\u4e0b\u63d0\u793a\u4e4b\u540e\u9700\u8981\u91cd\u65b0\u6dfb\u52a0 bot \u4e4b\u540e\u624d\u4f1a\u7ee7\u7eed\u8dd1 CI \u6d41\u7a0b \u5f53 CI \u663e\u793a queued \u65f6\uff0c\u7b49\u5f85\u5176\u6267\u884c\u7ed3\u675f\u5373\u53ef\uff0c\u4f46\u662f\u5982\u679c\u597d\u51e0\u4e2a\u5c0f\u65f6\u8fd8\u6ca1\u6709\u8c03\u5ea6\u5230 ci\uff0c\u5219\u5e94\u8be5\u91cd\u65b0\u6dfb\u52a0 bot \u5982\u679c CI \u663e\u793a cancelled\uff0c\u67e5\u770b cancel \u539f\u56e0\uff0c\u5e38\u89c1\u7684\u95ee\u9898\u662f\u957f\u65f6\u95f4\u7b49\u5f85\u4e0d\u5230 GPU \u8d44\u6e90\u800c\u81ea\u52a8\u53d6\u6d88\uff0c\u6b64\u65f6\u9700\u8981\u91cd\u65b0\u6dfb\u52a0 bot \u6216\u8005 Rerun \u5982\u679c CI \u9519\u8bef\u5e76\u4e14\u62a5\u9519\u4fe1\u606f\u4e0e\u81ea\u5df1\u7684 pr \u65e0\u5173\uff0c\u5c1d\u8bd5\u91cd\u65b0\u6dfb\u52a0 bot\u3002\u5982\u679c\u91cd\u65b0\u6dfb\u52a0 bot \u4ecd\u7136\u51fa\u73b0\u540c\u6837\u9519\u8bef\uff0c\u53ef\u4ee5\u6839\u636e\u9519\u8bef\u63d0\u793a\u6ce8\u91ca\u8be5\u90e8\u5206\u4ee3\u7801\u3002\u4f8b\u5982\u5982\u4e0b\u9519\u8bef\u5e76\u4e0d\u662f\u81ea\u5df1 pr \u5bfc\u81f4\u7684\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5728\u670d\u52a1\u5668\u590d\u73b0\uff0c\u590d\u73b0\u4e0d\u4e86\u7684\u8bdd\u53ef\u4ee5\u5148\u6ce8\u91ca test_crossformer_compatibility \u6700\u8fd1\u63d0\u4ea4 CI \u603b\u662f canceled \u8bf7\u6c42\u4e0d\u5230\u8d44\u6e90\uff0c\u6653\u96e8\u7684\u7ecf\u9a8c\u662f \u522b\u4eba\u5408\u4e86 pr \u4e4b\u540e\u4f60\u8981\u7b2c\u4e00\u4e2a\u70b9 update\uff0c\u5373\u6536\u5230 master \u6709 pr \u5408\u5e76\u4e86\u7684\u90ae\u4ef6\u6216\u8005\u4ece github \u7684 channel \u770b\u5230\u6709 pr \u5408\u5e76\uff0c \u91cd\u65b0\u5728\u81ea\u5df1 pr \u6dfb\u52a0 bot \u5982\u679c pr \u4e2d\u6709\u6dfb\u52a0\u6216\u8005\u4fee\u6539 docString\uff0c\u53ef\u4ee5\u5728\u5408\u5e76 pr \u524d\u8fd0\u884c ./python/oneflow/test/modules/test_functional_docstr.py \u6765\u68c0\u67e5\u6587\u6863\u662f\u5426\u6709\u95ee\u9898","title":"\u5173\u4e8e PR CI"},{"location":"util/20220411-CI.html#pr-ci","text":"\u6301\u7eed\u96c6\u6210 (Con\u00adtin\u00adu\u00adous in\u00adte\u00adgra\u00adtion\uff0c\u7b80\u79f0 CI) \u63d0\u4f9b\u4e86\u914d\u7f6e\u975e\u5e38\u4e0d\u9519\u7684\u865a\u62df\u670d\u52a1\u5668\u73af\u5883\uff0c\u57fa\u4e8e\u5b83\u53ef\u4ee5\u8fdb\u884c\u6784\u5efa\u3001\u6d4b\u8bd5\u3001\u6253\u5305\u3001\u90e8\u7f72\u9879\u76ee\u3002","title":"\u5173\u4e8e PR CI"},{"location":"util/20220411-CI.html#_1","text":"\u83b7\u53d6\u4e24\u4e2a approve\uff1b \u5728 reviewer \u4e2d\u6dfb\u52a0 bot\uff1a \u6839\u636e bot \u7684\u63d0\u793a\u6dfb\u52a0 label\u3002\u6ce8\u610f\u8981\u9009\u4e00\u4e0b automerge\uff0c\u8868\u660e bot \u5728\u6d4b\u8bd5\u901a\u8fc7\u65f6\u4f1a\u81ea\u52a8\u5408\u5e76 pr \u5230 master\u3002\u6b64\u5916\uff0c\u63d0\u793a\u4fe1\u606f\u4e2d\u7684 label \u9009\u4e00\u4e2a\u5c31\u884c\u4e86\uff0c\u800c\u4e0d\u662f\u5168\u9009\uff0c\u8fd9\u91cc\u6709\u4e2a\u50bb\u5b50\u7b2c\u4e00\u6b21\u6dfb\u52a0 label \u5168\u9009\u4e86 :sweat: \u7b49\u5f85 CI \u7ed3\u675f\u2026\u2026","title":"\u6d41\u7a0b"},{"location":"util/20220411-CI.html#_2","text":"\u5982\u679c\u662f bot \u6765 format \u4ee3\u7801\uff0c\u90a3\u4e48\u51fa\u73b0\u5982\u4e0b\u63d0\u793a\u4e4b\u540e\u9700\u8981\u91cd\u65b0\u6dfb\u52a0 bot \u4e4b\u540e\u624d\u4f1a\u7ee7\u7eed\u8dd1 CI \u6d41\u7a0b \u5f53 CI \u663e\u793a queued \u65f6\uff0c\u7b49\u5f85\u5176\u6267\u884c\u7ed3\u675f\u5373\u53ef\uff0c\u4f46\u662f\u5982\u679c\u597d\u51e0\u4e2a\u5c0f\u65f6\u8fd8\u6ca1\u6709\u8c03\u5ea6\u5230 ci\uff0c\u5219\u5e94\u8be5\u91cd\u65b0\u6dfb\u52a0 bot \u5982\u679c CI \u663e\u793a cancelled\uff0c\u67e5\u770b cancel \u539f\u56e0\uff0c\u5e38\u89c1\u7684\u95ee\u9898\u662f\u957f\u65f6\u95f4\u7b49\u5f85\u4e0d\u5230 GPU \u8d44\u6e90\u800c\u81ea\u52a8\u53d6\u6d88\uff0c\u6b64\u65f6\u9700\u8981\u91cd\u65b0\u6dfb\u52a0 bot \u6216\u8005 Rerun \u5982\u679c CI \u9519\u8bef\u5e76\u4e14\u62a5\u9519\u4fe1\u606f\u4e0e\u81ea\u5df1\u7684 pr \u65e0\u5173\uff0c\u5c1d\u8bd5\u91cd\u65b0\u6dfb\u52a0 bot\u3002\u5982\u679c\u91cd\u65b0\u6dfb\u52a0 bot \u4ecd\u7136\u51fa\u73b0\u540c\u6837\u9519\u8bef\uff0c\u53ef\u4ee5\u6839\u636e\u9519\u8bef\u63d0\u793a\u6ce8\u91ca\u8be5\u90e8\u5206\u4ee3\u7801\u3002\u4f8b\u5982\u5982\u4e0b\u9519\u8bef\u5e76\u4e0d\u662f\u81ea\u5df1 pr \u5bfc\u81f4\u7684\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5728\u670d\u52a1\u5668\u590d\u73b0\uff0c\u590d\u73b0\u4e0d\u4e86\u7684\u8bdd\u53ef\u4ee5\u5148\u6ce8\u91ca test_crossformer_compatibility \u6700\u8fd1\u63d0\u4ea4 CI \u603b\u662f canceled \u8bf7\u6c42\u4e0d\u5230\u8d44\u6e90\uff0c\u6653\u96e8\u7684\u7ecf\u9a8c\u662f \u522b\u4eba\u5408\u4e86 pr \u4e4b\u540e\u4f60\u8981\u7b2c\u4e00\u4e2a\u70b9 update\uff0c\u5373\u6536\u5230 master \u6709 pr \u5408\u5e76\u4e86\u7684\u90ae\u4ef6\u6216\u8005\u4ece github \u7684 channel \u770b\u5230\u6709 pr \u5408\u5e76\uff0c \u91cd\u65b0\u5728\u81ea\u5df1 pr \u6dfb\u52a0 bot \u5982\u679c pr \u4e2d\u6709\u6dfb\u52a0\u6216\u8005\u4fee\u6539 docString\uff0c\u53ef\u4ee5\u5728\u5408\u5e76 pr \u524d\u8fd0\u884c ./python/oneflow/test/modules/test_functional_docstr.py \u6765\u68c0\u67e5\u6587\u6863\u662f\u5426\u6709\u95ee\u9898","title":"\u6ce8\u610f\u4e8b\u9879"},{"location":"util/20220413-vscode%20tips.html","text":"VSCode \u5de5\u5177 \u5de5\u4f5c\u76ee\u5f55\u6307 VSCode \u8fdc\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u5939\u3002 \u67e5\u770b\u4fee\u6539\u5386\u53f2 VSCode \u5b89\u88c5\u63d2\u4ef6 Git History Diff\uff0c\u63d2\u4ef6\u7684\u4f5c\u7528\u5982\u4e0b\uff1a \u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7684\u4fee\u6539\u6765\u81ea\u54ea\u4e00\u4e2a commit \u67e5\u770b\u6587\u4ef6\u4fee\u6539\u5386\u53f2\uff1a\u6253\u5f00\u6587\u4ef6\uff0c\u6309 ctrl + shift + P\uff0c\u5728\u51fa\u73b0\u7684\u8f93\u5165\u6846\u4e2d\u8f93\u5165 File History\uff0c\u5c31\u53ef\u4ee5\u67e5\u770b\u5230\u6587\u4ef6\u7684\u4fee\u6539\u5386\u53f2\u3002\u5728\u4fee\u6539\u5386\u53f2\u4e2d\u70b9\u51fb commit id\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165 commit \u8be6\u60c5\u9875\u9762 \u67e5\u770b\u5f53\u524d\u5206\u652f\u4e0e\u4efb\u4e00\u5206\u652f\u7684\u4e0d\u540c\uff1a\u6309 ctrl + shift + P\uff0c\u5728\u51fa\u73b0\u7684\u8f93\u5165\u6846\u4e2d\u8f93\u5165 View Branch Diff debug VSCode \u5b89\u88c5\u63d2\u4ef6 Native Debug \u548c C++ \u5728\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\u4e0b\u65b0\u5efa .vscode/launch.json\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a { \"version\": \"0.2.0\", \"configurations\": [ { \"name\": \"GDB\", \"type\": \"gdb\", \"request\": \"launch\", \"target\": \"/home/zhongshanshan/anaconda3/bin/python\", // python \u73af\u5883 \"arguments\": \"/home/zhongshanshan/workspace/test/debug.py\", // debug \u811a\u672c \"cwd\": \"/home/zhongshanshan/workspace/log\", // \u65e5\u5fd7\u6240\u5728\u4f4d\u7f6e \"valuesFormatting\": \"parseText\", \"env\": { //\u8c03 oneflow python \u4ee3\u7801\u8981\u52a0\u8fd9\u4e2a \"PYTHONPATH\": \"/home/zhongshanshan/workspace/f/python\" // oneflow \u8def\u5f84 }, } ] } \u6b64\u65f6\u5728\u8fd0\u884c\u6587\u4ef6\u6309 F5 \u5373\u5f00\u59cb\u8c03\u8bd5\u3002\u53ef\u4ee5\u5728 python \u6216\u8005 C++ \u52a0\u65ad\u70b9\u8fdb\u884c\u8c03\u8bd5\uff0cVSCode \u4f1a\u8f93\u51fa\u8c03\u7528\u6808\u7b49\u4fe1\u606f\uff0c\u6dfb\u52a0\u65ad\u70b9\u8981\u6ce8\u610f\u662f\u5426\u5728 Setting \u4e2d\u8bbe\u7f6e\u5141\u8bb8\u6dfb\u52a0\u65ad\u70b9 \u70b9\u51fb\u8df3\u8f6c \u5207\u6362\u5230 oneflow build \u76ee\u5f55\uff0c\u5728\u4e4b\u524d\u8fd0\u884c cmake \u7684 flag \u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e00\u4e2a cmake \u53c2\u6570 -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \u3002 \u5728\u5de5\u4f5c\u76ee\u5f55\u4e0b\u521b\u5efa\u8f6f\u94fe\u63a5\uff1a ln -s oneflow/build/compile_commands.json ./compile_commands.json \uff0c\u5c06 compile_commands.json \u94fe\u63a5\u5230\u5de5\u4f5c\u76ee\u5f55 \u4e0b\u8f7d\u5e76\u89e3\u538b LLVM \u5728\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\u4e0b\u65b0\u5efa .vscode/settings.json\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a { \"clangd.path\": \"/home/zhongshanshan/clangd_14.0.0/bin/clangd\", // LLWM \u8def\u5f84 \"clangd.arguments\": [ \"-j\", \"48\", \"-clang-tidy\" ] } \u91cd\u65b0\u8fde\u63a5\u670d\u52a1\u5668","title":"VSCode debug \u5de5\u5177"},{"location":"util/20220413-vscode%20tips.html#vscode","text":"\u5de5\u4f5c\u76ee\u5f55\u6307 VSCode \u8fdc\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u5939\u3002","title":"VSCode \u5de5\u5177"},{"location":"util/20220413-vscode%20tips.html#_1","text":"VSCode \u5b89\u88c5\u63d2\u4ef6 Git History Diff\uff0c\u63d2\u4ef6\u7684\u4f5c\u7528\u5982\u4e0b\uff1a \u7528\u4e8e\u67e5\u770b\u6587\u4ef6\u7684\u4fee\u6539\u6765\u81ea\u54ea\u4e00\u4e2a commit \u67e5\u770b\u6587\u4ef6\u4fee\u6539\u5386\u53f2\uff1a\u6253\u5f00\u6587\u4ef6\uff0c\u6309 ctrl + shift + P\uff0c\u5728\u51fa\u73b0\u7684\u8f93\u5165\u6846\u4e2d\u8f93\u5165 File History\uff0c\u5c31\u53ef\u4ee5\u67e5\u770b\u5230\u6587\u4ef6\u7684\u4fee\u6539\u5386\u53f2\u3002\u5728\u4fee\u6539\u5386\u53f2\u4e2d\u70b9\u51fb commit id\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165 commit \u8be6\u60c5\u9875\u9762 \u67e5\u770b\u5f53\u524d\u5206\u652f\u4e0e\u4efb\u4e00\u5206\u652f\u7684\u4e0d\u540c\uff1a\u6309 ctrl + shift + P\uff0c\u5728\u51fa\u73b0\u7684\u8f93\u5165\u6846\u4e2d\u8f93\u5165 View Branch Diff","title":"\u67e5\u770b\u4fee\u6539\u5386\u53f2"},{"location":"util/20220413-vscode%20tips.html#debug","text":"VSCode \u5b89\u88c5\u63d2\u4ef6 Native Debug \u548c C++ \u5728\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\u4e0b\u65b0\u5efa .vscode/launch.json\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a { \"version\": \"0.2.0\", \"configurations\": [ { \"name\": \"GDB\", \"type\": \"gdb\", \"request\": \"launch\", \"target\": \"/home/zhongshanshan/anaconda3/bin/python\", // python \u73af\u5883 \"arguments\": \"/home/zhongshanshan/workspace/test/debug.py\", // debug \u811a\u672c \"cwd\": \"/home/zhongshanshan/workspace/log\", // \u65e5\u5fd7\u6240\u5728\u4f4d\u7f6e \"valuesFormatting\": \"parseText\", \"env\": { //\u8c03 oneflow python \u4ee3\u7801\u8981\u52a0\u8fd9\u4e2a \"PYTHONPATH\": \"/home/zhongshanshan/workspace/f/python\" // oneflow \u8def\u5f84 }, } ] } \u6b64\u65f6\u5728\u8fd0\u884c\u6587\u4ef6\u6309 F5 \u5373\u5f00\u59cb\u8c03\u8bd5\u3002\u53ef\u4ee5\u5728 python \u6216\u8005 C++ \u52a0\u65ad\u70b9\u8fdb\u884c\u8c03\u8bd5\uff0cVSCode \u4f1a\u8f93\u51fa\u8c03\u7528\u6808\u7b49\u4fe1\u606f\uff0c\u6dfb\u52a0\u65ad\u70b9\u8981\u6ce8\u610f\u662f\u5426\u5728 Setting \u4e2d\u8bbe\u7f6e\u5141\u8bb8\u6dfb\u52a0\u65ad\u70b9","title":"debug"},{"location":"util/20220413-vscode%20tips.html#_2","text":"\u5207\u6362\u5230 oneflow build \u76ee\u5f55\uff0c\u5728\u4e4b\u524d\u8fd0\u884c cmake \u7684 flag \u7684\u57fa\u7840\u4e0a\u6dfb\u52a0\u4e00\u4e2a cmake \u53c2\u6570 -DCMAKE_EXPORT_COMPILE_COMMANDS=1 \u3002 \u5728\u5de5\u4f5c\u76ee\u5f55\u4e0b\u521b\u5efa\u8f6f\u94fe\u63a5\uff1a ln -s oneflow/build/compile_commands.json ./compile_commands.json \uff0c\u5c06 compile_commands.json \u94fe\u63a5\u5230\u5de5\u4f5c\u76ee\u5f55 \u4e0b\u8f7d\u5e76\u89e3\u538b LLVM \u5728\u670d\u52a1\u5668\u5de5\u4f5c\u76ee\u5f55\u4e0b\u65b0\u5efa .vscode/settings.json\uff0c\u6587\u4ef6\u5185\u5bb9\u4e3a { \"clangd.path\": \"/home/zhongshanshan/clangd_14.0.0/bin/clangd\", // LLWM \u8def\u5f84 \"clangd.arguments\": [ \"-j\", \"48\", \"-clang-tidy\" ] } \u91cd\u65b0\u8fde\u63a5\u670d\u52a1\u5668","title":"\u70b9\u51fb\u8df3\u8f6c"},{"location":"util/20220422-cmake%2Bgdb.html","text":"CMake \u548c gdb \u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684 Demo \u793a\u4f8b\u3002 CMakeLists cmake_minimum_required(VERSION 3.14) # \u8bbe\u7f6e Cmake \u6700\u5c0f\u7248\u672c project(cmake_example) # \u5de5\u7a0b\u540d add_executable(cmake_example main.cpp ui.cpp logic.cpp) # \u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u540d\u548c\u4f9d\u8d56\u7684 cpp \u540d main.cpp #include <stdio.h> #define MYMAX(x, y) ((x) < (y) ? (y): (x)) int my_add(int a, int b); int main(int argc, char* argv[]){ printf(\"Hello World!\\n\"); printf(\"5 + 9 = %d \\n\", my_add(5, 9)); printf( \"%d\\n\", MYMAX(10, 5)); printf(\"%lf\\n\", MYMAX(3.14, 2.73)); printf(\"%s\\n\", MYMAX(\"short string\", \"very very long string\")); return 0; } my_math.cpp int my_add(int a, int b) { return a+b; } \u7f16\u8bd1 mkdir build cd build cmake .. make ./cmake_example # \u8fd0\u884c\u7f16\u8bd1\u540e\u7684\u6587\u4ef6 debug cmake .. -D CMAKE_BUILD_TYPE=Debug make gdb ./cmake_example break main:6 # \u8bbe\u7f6e\u65ad\u70b9\uff0c\u6216\u8005 break 6 r # \u8dd1\u7a0b\u5e8f\uff0c\u8dd1\u5230\u65ad\u70b9 hexdump byte &x1 # \u67e5\u8be2\u53d8\u91cf x1 \u7684\u4f4d\u7f6e\u548c\u5185\u5bb9 n # \u518d\u8dd1\u4e00\u884c c # \u8f93\u51fa\u7ed3\u679c disassemble /mr # \u67e5\u770b\u6c47\u7f16\u6307\u4ee4 stepi # \u8d70\u6c47\u7f16\u7ea7\u522b\u7684\u5355\u6b65 break *\u6c47\u7f16\u5730\u5740 # \u901a\u8fc7 disassemble /mr \u67e5\u770b\u6c47\u7f16\u8bed\u53e5\u7684\u5730\u5740 i frame 0 # \u67e5\u770b0\u53f7\u6808\u4fe1\u606f","title":"CMake \u548c gdb"},{"location":"util/20220422-cmake%2Bgdb.html#cmake-gdb","text":"\u8fd9\u91cc\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684 Demo \u793a\u4f8b\u3002","title":"CMake \u548c gdb"},{"location":"util/20220422-cmake%2Bgdb.html#cmakelists","text":"cmake_minimum_required(VERSION 3.14) # \u8bbe\u7f6e Cmake \u6700\u5c0f\u7248\u672c project(cmake_example) # \u5de5\u7a0b\u540d add_executable(cmake_example main.cpp ui.cpp logic.cpp) # \u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u540d\u548c\u4f9d\u8d56\u7684 cpp \u540d","title":"CMakeLists"},{"location":"util/20220422-cmake%2Bgdb.html#maincpp","text":"#include <stdio.h> #define MYMAX(x, y) ((x) < (y) ? (y): (x)) int my_add(int a, int b); int main(int argc, char* argv[]){ printf(\"Hello World!\\n\"); printf(\"5 + 9 = %d \\n\", my_add(5, 9)); printf( \"%d\\n\", MYMAX(10, 5)); printf(\"%lf\\n\", MYMAX(3.14, 2.73)); printf(\"%s\\n\", MYMAX(\"short string\", \"very very long string\")); return 0; }","title":"main.cpp"},{"location":"util/20220422-cmake%2Bgdb.html#my_mathcpp","text":"int my_add(int a, int b) { return a+b; }","title":"my_math.cpp"},{"location":"util/20220422-cmake%2Bgdb.html#_1","text":"mkdir build cd build cmake .. make ./cmake_example # \u8fd0\u884c\u7f16\u8bd1\u540e\u7684\u6587\u4ef6","title":"\u7f16\u8bd1"},{"location":"util/20220422-cmake%2Bgdb.html#debug","text":"cmake .. -D CMAKE_BUILD_TYPE=Debug make gdb ./cmake_example break main:6 # \u8bbe\u7f6e\u65ad\u70b9\uff0c\u6216\u8005 break 6 r # \u8dd1\u7a0b\u5e8f\uff0c\u8dd1\u5230\u65ad\u70b9 hexdump byte &x1 # \u67e5\u8be2\u53d8\u91cf x1 \u7684\u4f4d\u7f6e\u548c\u5185\u5bb9 n # \u518d\u8dd1\u4e00\u884c c # \u8f93\u51fa\u7ed3\u679c disassemble /mr # \u67e5\u770b\u6c47\u7f16\u6307\u4ee4 stepi # \u8d70\u6c47\u7f16\u7ea7\u522b\u7684\u5355\u6b65 break *\u6c47\u7f16\u5730\u5740 # \u901a\u8fc7 disassemble /mr \u67e5\u770b\u6c47\u7f16\u8bed\u53e5\u7684\u5730\u5740 i frame 0 # \u67e5\u770b0\u53f7\u6808\u4fe1\u606f","title":"debug"}]}